<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>æ‰‹å†™ä¸€ä¸ªPromiseå¹¶é€šè¿‡Promise A+è§„èŒƒæµ‹è¯•</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-u6mH9xpQ.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-afYcuv6x.css"><link rel="modulepreload" crossorigin="" href="/assets/æ‰‹å†™ä¸€ä¸ªPromiseå¹¶é€šè¿‡Promise-A-è§„èŒƒæµ‹è¯•-Dm39WQKO.js"><meta property="og:title" content="æ‰‹å†™ä¸€ä¸ªPromiseå¹¶é€šè¿‡Promise A+è§„èŒƒæµ‹è¯•"><meta name="twitter:title" content="æ‰‹å†™ä¸€ä¸ªPromiseå¹¶é€šè¿‡Promise A+è§„èŒƒæµ‹è¯•"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="æ‹ã®æ­Œçš„logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="è‡ªåŠ¨" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="æ—¥é—´" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="å¤œé—´" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">æ‰‹å†™ä¸€ä¸ªPromiseå¹¶é€šè¿‡Promise A+è§„èŒƒæµ‹è¯•</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">å‘è¡¨äº</span><span pl-1="">2020-06-12 10:36</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">æ›´æ–°äº</span><span pl-1="">2023-02-13 18:28</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">åˆ†ç±»äº</span><!--[--><a pl-1="" href="/category/ç¼–ç¨‹">ç¼–ç¨‹</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">æ€»å­—æ•°</span><span pl-1="">2.9K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">é˜…è¯»æ—¶é•¿ â‰ˆ</span><span pl-1="">11 åˆ†é’Ÿ</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><p>æ‰‹å†™ä¸€ä¸ª<code>Promise</code>å¹¶é€šè¿‡<code>Promise A+</code>è§„èŒƒæµ‹è¯•ã€‚</p><h1 id="promiseæ„é€ å‡½æ•°" tabindex="-1"><code>Promise</code>æ„é€ å‡½æ•° <a class="header-anchor" href="#promiseæ„é€ å‡½æ•°">ğŸ”—</a></h1><p>åœ¨è§„èŒƒä¸­ï¼Œæœ‰ä¸€æ®µ</p><blockquote><p>the core Promises/A+ specification does not deal with how to create, fulfill, or reject promises, choosing instead to focus on providing an interoperable then method. Future work in companion specifications may touch on these subjects.</p></blockquote><p>å¯ä»¥çœ‹å‡ºï¼Œè§„èŒƒå¹¶æ²¡æœ‰æŒ‡å‡ºå¦‚ä½•åˆ›å»ºä¸€ä¸ª<code>Promise</code>ï¼Œè€Œæ˜¯è§„èŒƒ<code>then</code>æ–¹æ³•çš„è¡Œä¸ºã€‚</p><p>è€Œåœ¨ ES6 ä¸­åˆ›å»ºä¸€ä¸ª<code>Promise</code>æ˜¯é€šè¿‡<code>new Promise(executor)</code>æ¥å®ç°çš„ã€‚å…·ä½“å¯ä»¥çœ‹ MDN ä¸Šå¯¹ Promise çš„è§£é‡Šã€‚</p><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener">Promise - JavaScript | MDN</a></p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬ä¹Ÿä»è¿™ä¸€ä¸ªè§’åº¦å…¥æ‰‹ï¼Œåˆ›å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„<code>Promise</code>æ„é€ å‡½æ•°ï¼Œå‘½åä¸º<code>MyPromise</code>ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p><code>ES6</code>çš„<code>Promise</code>æ„é€ å‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ª<code>executor</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨<code>Promise</code>å†…éƒ¨ä¼šç«‹å³æ‰§è¡Œã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„æ„é€ å‡½æ•°ä¹Ÿä¼ å…¥ä¸€ä¸ª<code>executor</code>å‡½æ•°ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">executor</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>è§„èŒƒä¸­æåˆ°ï¼š</p><blockquote><p>A promise must be in one of three states: pending, fulfilled, or rejected.</p></blockquote><p>ä¹Ÿå°±æ˜¯ä¸€ä¸ª<code>Promise</code>å¿…é¡»ä¸ºä¸‰ä¸ªçŠ¶æ€ä¸­çš„å…¶ä¸­ä¸€ä¸ªã€‚</p><p>OKï¼Œé‚£æˆ‘ä»¬å®šä¹‰ä¸‰ä¸ªçŠ¶æ€çš„å¸¸é‡æ¥è¡¨ç¤ºï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// pendingçŠ¶æ€</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">pending</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// resolvedçŠ¶æ€</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">resolved</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// rejectedçŠ¶æ€</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">rejected</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span></code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬åº”è¯¥åˆå§‹åŒ–ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ä¸Šçš„ä¸€äº›å±æ€§ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">executor</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ä»¥selfæŒ‡å‘thisï¼Œæ–¹ä¾¿ç­‰ä¼šåœ¨å‡½æ•°å†…çš„æ“ä½œã€‚</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> self</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–çŠ¶æ€ä¸ºpending</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–æ•°æ®ä¸ºundefined</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> undefined</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–ä¸€ä¸ªæˆåŠŸçš„å›è°ƒæ•°ç»„</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–ä¸€ä¸ªå¤±è´¥çš„å›è°ƒæ•°ç»„</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>å¯¹äºä¼ å…¥çš„<code>executor</code>å‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li><code>resolve</code> å®Œæˆè¿™ä¸ª<code>Promise</code>çš„å‡½æ•°ï¼›</li><li><code>reject</code> æ‹’ç»è¿™ä¸ª<code>Promise</code>çš„å‡½æ•°ï¼›</li></ul><p>æ‰€ä»¥æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°çš„å†…éƒ¨éœ€è¦å®ç°è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œ<code>executor</code>å‡½æ•°æ—¶ï¼Œä¼ è¿›è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p><p>åœ¨<code>ES6</code>çš„<code>Promise</code>å®ç°ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šè¿™ä¹ˆä½¿ç”¨<code>Promise</code></p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">var</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> Pormise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // æˆåŠŸå°±è°ƒç”¨resolveï¼Œå¹¶ä¼ è¿›ä¸€ä¸ªæˆåŠŸçš„å€¼</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // å¤±è´¥å°±è°ƒç”¨rejectï¼Œä¼ è¿›å¤±è´¥çš„åŸå› </span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">);</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // æ‰“å°1</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>æ‰€ä»¥æˆ‘ä»¬çš„å®ç°ä¹Ÿæ¨¡ä»¿å®ƒã€‚</p><p>è®°ä½ï¼Œ<code>Promise</code>åªèƒ½æ˜¯ä¸‰ä¸ªçŠ¶æ€ä¸­çš„ä¸€ä¸ªï¼Œå¹¶ä¸”åªèƒ½ä»ï¼š</p><ul><li><code>pending</code> -&gt; <code>resolved</code></li><li><code>pending</code> -&gt; <code>rejected</code></li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">executor</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ä»¥selfæŒ‡å‘thisï¼Œæ–¹ä¾¿ç­‰ä¼šåœ¨å‡½æ•°å†…çš„æ“ä½œã€‚</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> self</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–çŠ¶æ€ä¸ºpending</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–æ•°æ®ä¸ºundefined</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> undefined</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–ä¸€ä¸ªæˆåŠŸçš„å›è°ƒæ•°ç»„</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–ä¸€ä¸ªå¤±è´¥çš„å›è°ƒæ•°ç»„</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // è§£å†³æœ¬Promiseçš„å‡½æ•°ï¼Œå‚æ•°ä¸ºè§£å†³çš„å€¼</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">        fn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // æ‹’ç»æœ¬Promiseçš„å‡½æ•°ï¼Œå‚æ•°ä¸ºæ‹’ç»çš„åŸå› </span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reason</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reason</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">        fn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reason</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>ä¸¤ä¸ªå‡½æ•°éƒ½è¢«<code>if</code>åˆ¤å®šçš„è¯­å¥åŒ…è£¹ï¼Œé˜²æ­¢ä¸€ä¸ªå·²ç»<code>resolve</code>çš„<code>Promise</code>å¯¹è±¡è¢«<code>reject</code>ï¼Œæˆ–è€…å·²ç»è¢«<code>reject</code>çš„<code>Promise</code>å¯¹è±¡è¢«<code>resolve</code>ã€‚</p><p>å…¶å®è¿™ä¹ˆå†™è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸è¿‡åé¢å†è¯´ã€‚</p><p>ç°åœ¨æˆ‘ä»¬çš„æ„é€ å‡½æ•°åŸºæœ¬å®Œæˆäº†å¤§éƒ¨åˆ†çš„å·¥ä½œï¼Œæœ€åçš„ä¸€æ­¥å°±æ˜¯æ‰§è¡Œ<code>executor</code>å‡½æ•°ï¼Œå¹¶ä¼ å…¥<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°äº†ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">executor</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ä»¥selfæŒ‡å‘thisï¼Œæ–¹ä¾¿ç­‰ä¼šåœ¨å‡½æ•°å†…çš„æ“ä½œã€‚</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> self</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–çŠ¶æ€ä¸ºpending</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–æ•°æ®ä¸ºundefined</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> undefined</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–ä¸€ä¸ªæˆåŠŸçš„å›è°ƒæ•°ç»„</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // åˆå§‹åŒ–ä¸€ä¸ªå¤±è´¥çš„å›è°ƒæ•°ç»„</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // è§£å†³æœ¬Promiseçš„å‡½æ•°ï¼Œå‚æ•°ä¸ºè§£å†³çš„å€¼</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">        fn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // æ‹’ç»æœ¬promiseçš„å‡½æ•°ï¼Œå‚æ•°ä¸ºæ‹’ç»çš„åŸå› </span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reason</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reason</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">        fn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reason</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    executor</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>ä¸ºä»€ä¹ˆæ‰§è¡Œ<code>executor</code>å‡½æ•°è¦æ”¾åœ¨<code>try-catch</code>ä¸­å‘¢ï¼Ÿ</p><p>å› ä¸ºå¦‚æœ<code>executor</code>æ‰§è¡Œè¿‡ç¨‹å‡ºé”™æˆ‘ä»¬å¸Œæœ›ä»¥å‡ºé”™çš„åŸå› æ¥æ‹’ç»è¿™ä¸ª<code>Promise</code>ã€‚</p><p><code>ES6</code>çš„å®ç°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">var</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#B8A965;--s-light:#998418"> Promise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  throw</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> Error</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">null</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">å‡ºé”™å•¦~</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // æ‰“å°</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><h1 id="promiseå¯¹è±¡çš„thenå‡½æ•°" tabindex="-1"><code>Promise</code>å¯¹è±¡çš„<code>then</code>å‡½æ•° <a class="header-anchor" href="#promiseå¯¹è±¡çš„thenå‡½æ•°">ğŸ”—</a></h1><p>æ¯ä¸€ä¸ª<code>Promise</code>å¯¹è±¡éƒ½å¯ä»¥è°ƒç”¨å®ƒçš„<code>then</code>æ–¹æ³•æ¥æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥<code>then</code>æ–¹æ³•è¦å†™åœ¨æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸Šï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">prototype</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>åœ¨è§„èŒƒ<code>2.2.1</code>ä¸­ï¼Œæåˆ°<code>then</code>æ–¹æ³•éœ€è¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p><blockquote><p>A promiseâ€™s then method accepts two arguments:<br><code>promise.then(onFulfilled, onRejected)</code></p></blockquote><ul><li><code>onFulfilled</code>ï¼š<code>Promise</code>è¢«è§£å†³æ—¶çš„å›è°ƒã€‚ï¼ˆä¸‹æ–‡ç”¨<code>onResolved</code>ä»£æ›¿ï¼Œéƒ½æ˜¯ä¸€ä¸ªæ„æ€çš„ã€‚ï¼‰</li><li><code>onRejected</code>ï¼š<code>promise</code>è¢«æ‹’ç»æ—¶çš„å›è°ƒã€‚</li></ul><p>æ‰€ä»¥æˆ‘ä»¬çš„<code>then</code>æ–¹æ³•ä¹Ÿä¼ è¿›è¿™ä¸¤ä¸ªå‚æ•°ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">prototype</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onResolved</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>ç´§æ¥ç€ï¼Œè§„èŒƒè¯´æ˜è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œå½“ä¸æ˜¯å‡½æ•°çš„æ—¶å€™è¦è¿›è¡Œå¿½ç•¥ã€‚æ‰€ä»¥åœ¨å‡½æ•°çš„å†…éƒ¨è¦è¿›è¡Œåˆ¤æ–­ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">prototype</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onResolved</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onResolved</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onRejected</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          throw</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> err</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>è§„èŒƒ<code>2.2.7</code>è¯´æ˜<code>then</code>æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„<code>Promise</code>å¯¹è±¡ã€‚</p><blockquote><p>then must return a promise.<br><code>promise2 = promise1.then(onFulfilled, onRejected);</code></p></blockquote><p>å› ä¸º<code>Promise</code>æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ä¸ªçŠ¶æ€ç¼–å†™è¿”å›å‡½æ•°ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">prototype</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onResolved</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onResolved</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onRejected</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          throw</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> err</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // PromiseçŠ¶æ€ä¸ºresolvedæ—¶</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // PromiseçŠ¶æ€ä¸ºrejectedæ—¶</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // PromiseçŠ¶æ€ä¸ºpendingæ—¶</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>è§„èŒƒ<code>2.2.7.1 - 2.2.7.4</code> è¯´æ˜äº†<code>then</code>æ–¹æ³•æ”¾å›çš„<code>Promise</code>çš„çŠ¶æ€å¦‚ä½•æ ¹æ®ä¼ å…¥å‡½æ•°ï¼ˆ<code>onFulfilled, onRejected</code>ï¼‰çš„è¿”å›å€¼å†³å®šã€‚</p><blockquote><p>If either <code>onFulfilled</code> or <code>onRejected</code> returns a value <code>x</code>, run the Promise Resolution Procedure <code>[[Resolve]](promise2, x)</code>.<br>If either <code>onFulfilled</code> or <code>onRejected</code> throws an exception <code>e</code>, <code>promise2</code> must be rejected with <code>e</code> as the reason.<br>If <code>onFulfilled</code> is not a function and <code>promise1</code> is fulfilled, <code>promise2</code> must be fulfilled with the same value as <code>promise1</code>.<br>If <code>onRejected</code> is not a function and <code>promise1</code> is rejected, <code>promise2</code> must be rejected with the same reason as <code>promise1</code>.</p></blockquote><p>è¿™é‡Œçš„é‡ç‚¹æ—¶å¦‚ä½•æ ¹æ®è¿”å›å€¼<code>x</code>æ¥å†³å®šè¿”å›çš„<code>Promise</code>çš„çŠ¶æ€ï¼Œè¿™é‡Œéœ€è¦å¼•å‡ºç¬¬ä¸€ç‚¹çš„<code>[[Resolve]](promise2, x)</code>è¿™ä¸ªå‡½æ•°ã€‚</p><p>è¿™ä¸ªå‡½æ•°åœ¨<code>2.3</code>æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä¸å»ç®¡å‡½æ•°çš„å†…éƒ¨å¦‚ä½•å®ç°ï¼Œæˆ‘ä»¬åªè¦æ˜ç™½ï¼Œè¿™ä¸ªå‡½æ•°æ ¹æ®<code>x</code>æ¥å†³å®š<code>promise2</code>çš„çŠ¶æ€ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">/**</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">promise</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> éœ€è¦å†³å®šçš„promise</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">x</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">       å†³å®špromiseçš„x</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">resolve</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> promiseçš„è§£å†³å‡½æ•°</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">reject</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  promiseçš„æ‹’ç»å‡½æ•°</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> */</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> PromiseResolution</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>ç°åœ¨è¿”å›<code>Promise</code>çš„å†…éƒ¨å°±å¯ä»¥å†™äº†ï¼Œå¯¹äºä¸‰ä¸ªçŠ¶æ€ï¼š</p><ul><li><code>resolved</code>çŠ¶æ€ï¼Œç›´æ¥è°ƒç”¨<code>then</code>æ³¨å†Œçš„<code>onResolved</code>å‡½æ•°å³å¯ã€‚</li><li><code>rejected</code>çŠ¶æ€ï¼Œç›´æ¥è°ƒç”¨<code>then</code>æ³¨å†Œçš„<code>onRejected</code>å‡½æ•°å³å¯ã€‚</li><li><code>pending</code>çŠ¶æ€ï¼Œéœ€è¦åœ¨çŠ¶æ€å˜æ›´çš„æ—¶å€™ï¼Œè°ƒç”¨æ³¨å†Œçš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¾€<code>$onResolvedCallbacks</code>å’Œ<code>$onRejectedCallbacks</code>ä¸­å‚¨å­˜ä¸€ä¸ªå‡½æ•°ã€‚</li></ul><p>å¹¶ä¸”è§„èŒƒ<code>2.2.4</code>ä»¥åŠ<code>3.1</code>æŒ‡å‡º<code>onResolved</code>å’Œ<code>onRejected</code>å¿…é¡»å¼‚æ­¥çš„æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŒ…è£¹å‡½æ•°å†…çš„æ“ä½œï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">prototype</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onResolved</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> self</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onResolved</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onRejected</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          throw</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> err</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // PromiseçŠ¶æ€ä¸ºresolvedæ—¶</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          // è¿™é‡Œå’ŒçŠ¶æ€ä¸ºrejectedçš„åŒºåˆ«ä¸ºè°ƒç”¨çš„å›è°ƒå‡½æ•°ä¸åŒã€‚</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onResolved</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolution</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // PromiseçŠ¶æ€ä¸ºrejectedæ—¶</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolution</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // PromiseçŠ¶æ€ä¸ºpendingæ—¶</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">push</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onResolved</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolution</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">push</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolution</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ä¸»ä½“ä»£ç éƒ¨åˆ†åŸºæœ¬å®Œæˆï¼Œæœ€åå°±å·®<code>PromiseResolution</code>è¿™ä¸ªå‡½æ•°çš„å®ç°äº†ã€‚ è¿™ä¸ªå‡½æ•°çš„å®ç°åœ¨è§„èŒƒä¸­å…¶å®è¯´çš„å¾ˆè¯¦ç»†ï¼Œåªè¦æŒ‰ç€è¦æ±‚æ¥åŸºæœ¬å°±æ²¡å•¥å¤§é—®é¢˜äº†ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> PromiseResolution</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // 2.3.1 å¦‚æœpromiseå’Œxä¸ºåŒä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä»¥TypeErroræ¥æ‹’ç»promise</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">new</span><span style="--s-dark:#80A665;--s-light:#59873A"> TypeError</span><span style="--s-dark:#666666;--s-light:#999999">());</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // 2.3.2.1 - 2.3.2.3 å¦‚æœxæ˜¯åŸç”Ÿçš„Promiseï¼Œé‚£ä¹ˆå°±ä»¥xçš„æœ€ç»ˆçš„æƒ…å†µæ¥å†³å®špromise</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> instanceof</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Promise</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    x</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // 2.3.3 å¦‚æœxæ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  else</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> !==</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> null</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> &amp;&amp;</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">object</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ||</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">))</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> then</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // 2.3.3.1 å°è¯•å–xçš„thenå±æ€§</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">then</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // 2.3.3.2 å¦‚æœå–thenå±æ€§å‡ºé”™ï¼Œåˆ™ä»¥è¿™ä¸ªåŸå› æ‹’ç»promise</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // 2.3.3.3 å¦‚æœthenå±æ€§ä¸ºä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> then</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> false</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">        // 2.3.3.3 ä»¥xä¸ºä¸Šä¸‹æ–‡è°ƒç”¨thenï¼Œå¹¶ä»¥å®ƒçš„ç»“æœæ¥å†³å®špromiseï¼ŒwhoCallçš„ä½œç”¨æ˜¯é˜²æ­¢å¤šæ¬¡çš„æ”¹å˜promiseçš„å€¼ï¼Œ</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        then</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">call</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">          x</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">y</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">whoCall</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">              // 2.3.3.3.1 ä»¥yå†æ¬¡æ¥å°è¯•å†³å®špromise</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">              whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">              PromiseResolution</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> y</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">            }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">whoCall</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">              // 2.3.3.3.2 ä»¥errç›´æ¥æ‹’ç»promise</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">              whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">              reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">            }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        );</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">whoCall</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          // 2.3.3.3.4.1 - 2.3.3.3.4.2 å¦‚æœè°ƒç”¨thenå‡ºé”™ï¼Œå°±ä»¥è¿™ä¸ªå‡ºé”™ä¿¡æ¯ç›´æ¥æ‹’ç»promise</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">          whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // 2.3.3.4 thenä¸æ˜¯å‡½æ•°ï¼Œç›´æ¥ä»¥xä¸ºå€¼æ¥è§£å†³promise</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // 2.3.4 xä¸æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œç›´æ¥ä»¥xä¸ºå€¼æ¥è§£å†³promise</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„<code>Promise</code>å®ç°åŸºæœ¬å®Œæˆã€‚</p><p>ä½†æ˜¯å¦‚æœä»¥ä¸‹é¢çš„ä»£ç æ¥æµ‹è¯•æˆ‘ä»¬çš„<code>Promise</code>çš„è¯ï¼Œä¼šå‘ç°æ— æ³•æ‰“å°ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">);</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // æ— æ³•æ‰“å°</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œé‡ç‚¹å°±æ˜¯æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°å†…éƒ¨çš„<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°ï¼Œå®ƒä»¬æ˜¯åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// è¿™é‡Œå°±å·²ç»éå†$onResolvedCallbacksæˆ–è€…$onRejectedCallbacksæ•°ç»„å¹¶æ‰§è¡Œäº†</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// è€Œä¸‹é¢çš„æ³¨å†Œçš„å›è°ƒè¿˜æ²¡æ‰§è¡Œï¼Œå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">);</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // æ— æ³•æ‰“å°</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>è§£å†³çš„åŠæ³•å°±æ˜¯ä»¥å¼‚æ­¥çš„å½¢å¼æ¥è§£å†³<code>Promise</code>ï¼Œä»¥ä¸€ä¸ªæ–°çš„ä»»åŠ¡æ¥è§£å†³<code>Promise</code>ï¼Œä¹Ÿå°±æ˜¯åŒ…è£¹åœ¨<code>setTimeout</code>ä¸­å³å¯ã€‚</p><h1 id="æµ‹è¯•" tabindex="-1">æµ‹è¯• <a class="header-anchor" href="#æµ‹è¯•">ğŸ”—</a></h1><p>ç°åœ¨æ¥ä½¿ç”¨<code>Promise/A+</code>å®˜æ–¹ç»™å®šçš„æµ‹è¯•æ•°æ®æ¥æµ‹è¯•è¿™ä¸ªå®ç°ã€‚</p><blockquote><p>githubï¼š<a href="https://github.com/promises-aplus/promises-tests" target="_blank" rel="noopener">æµ‹è¯•è„šæœ¬</a></p></blockquote><p>æˆ‘ä»¬æ ¹æ®<code>README.md</code>ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯é…ç½®ä¸€ä¸ªä¾èµ–ï¼Œç„¶åè¿è¡Œç‰¹å®šçš„å‘½ä»¤å³å¯ã€‚</p><p>é¦–å…ˆå…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨<code>npm init</code>æ¥åˆå§‹åŒ–ï¼Œ<code>package.json</code>ä½¿ç”¨é»˜è®¤çš„å³å¯ã€‚</p><p>æ¥ç€å¯¼å…¥è¿™ä¸ªåº“ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-json"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">{</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">  "</span><span style="--s-dark:#B8A965;--s-light:#998418">devDependencies</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">    "</span><span style="--s-dark:#B8A965;--s-light:#998418">promises-aplus-tests</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">*</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><ul><li>æ¥ç€é…ç½®æˆ‘ä»¬çš„<code>script</code>å‘½ä»¤</li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-json"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">{</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">  "</span><span style="--s-dark:#B8A965;--s-light:#998418">devDependencies</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">    "</span><span style="--s-dark:#B8A965;--s-light:#998418">promises-aplus-tests</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">*</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">  "</span><span style="--s-dark:#B8A965;--s-light:#998418">scripts</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // è¿™é‡Œçš„test/index.jsä¿®æ”¹æˆä½ æƒ³æµ‹è¯•çš„æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">    "</span><span style="--s-dark:#B8A965;--s-light:#998418">test</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">promises-aplus-tests test/index.js</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>æœ€åï¼Œéœ€è¦ä»¥ä¸€ä¸ª<code>es6 module</code>çš„å½¢å¼æ¥å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ...ä½ çš„å®ç°</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> deferred</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> defer</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {};</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  defer</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    defer</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    defer</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reject</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> defer</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">module</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">exports</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  deferred</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>æ¥ç€ï¼Œå°±å¯ä»¥è¿è¡Œ<code>npm test</code>çš„æ¥è¿›è¡Œæ„‰å¿«åœ°æµ‹è¯•äº†ã€‚</p><p>é™„ä¸Šå®Œæ•´çš„ä»£ç ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">pending</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">resolved</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">rejected</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">/**</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">param</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> executor</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> å°†ä¼šåœ¨æœªæ¥æ‰§è¡Œçš„å‡½æ•°ã€‚</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">constructor</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> Promiseæ„é€ å‡½æ•°</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> */</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">executor</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> self</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> undefined</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          fn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> err</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          fn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    executor</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">prototype</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onResolved</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> self</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise2</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onResolved</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onResolved</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  onRejected</span><span style="--s-dark:#666666;--s-light:#999999"> =</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> onRejected</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          throw</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> err</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> RESOLVED</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise2</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onResolved</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise2</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> REJECTED</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise2</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$data</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise2</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PENDING</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise2</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#80A665;--s-light:#59873A"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onResolvedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">push</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onResolved</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise2</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      self</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$onRejectedCallbacks</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">push</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">          const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> onRejected</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          PromiseResolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise2</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> PromiseResolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">new</span><span style="--s-dark:#80A665;--s-light:#59873A"> TypeError</span><span style="--s-dark:#666666;--s-light:#999999">());</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> instanceof</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Promise</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    x</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> !==</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> null</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> &amp;&amp;</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">object</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ||</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">))</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> then</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      then</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">then</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> then</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">function</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> false</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      try</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        then</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">call</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">          x</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">y</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">whoCall</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">              whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">              PromiseResolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> y</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">            }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">whoCall</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">              whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">              reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">            }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        );</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> catch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">whoCall</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">          whoCall</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">          reject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">module</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#B8A965;--s-light:#998418">exports</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> MyPromise</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span></code></pre><p>é™„ä¸Šè‡ªå·±åœ°æµ‹è¯•æˆªå›¾</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/04/19/JZpKVgueaFxycwH.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/04/19/JZpKVgueaFxycwH.png" alt=""></a></p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#JavaScript</div><div>#Promise</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/77af50a9ff1b" class="" truncate="" title="JavaScriptä¸­çš„applyå’Œcall"><i class="i-mi:chevron-left" mr-1=""></i><span>JavaScriptä¸­çš„applyå’Œcall</span></a><a href="/6e201f64d36b" class="" ml-auto="" truncate="" title="æ‰‹å†™Promiseç¬”è®°"><span>æ‰‹å†™Promiseç¬”è®°</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-93b0ae89="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-93b0ae89=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-93b0ae89=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-93b0ae89=""></i></div><div flex="~ col grow" gap-4="" data-v-93b0ae89=""><textarea disabled="" placeholder="ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç•™ä¸‹è¯„è®ºè¡Œä¸è¡Œ" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" lg:p-4="" data-v-93b0ae89=""></textarea><div flex="" items-start="" justify-between="" data-v-93b0ae89=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-93b0ae89="">æ”¯æŒ Markdown è¯­æ³• </a><button class="mujika-git-talk-button" cursor-pointer="" data-v-93b0ae89="">ç‚¹å‡»ç™»å½•</button></div></div></div><!--]--></div></div><!----><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">æ–‡ç« ç›®å½•</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-d1d7a153=""><div flex="" items-center="" data-v-d1d7a153=""><span data-v-d1d7a153="">Power by&nbsp;</span><i class="i-logos:vue" data-v-d1d7a153=""></i><span data-v-d1d7a153="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-d1d7a153=""></i></div><div text-center="" data-v-d1d7a153=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-d1d7a153="">CC BY-NC-SA 4.0 </a>2021 - PRESENT Â© Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-d1d7a153="">å¦‚æœæˆ‘å’Œç‹—ä¸€æ ·æœ‰å°¾å·´çš„è¯ï¼Œä¸€å®šä¼šè—ä¸ä½è¿™ä»½å–œæ‚¦ï¼Œè€Œå°¾å·´ä¸€ç›´æ‘‡ä¸ªä¸åœå§ã€‚</div></footer></div></div></body></html>