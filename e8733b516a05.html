<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vue3.0Reactivityä¹‹computed</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-kEKefLn2.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-DjlQYv3q.css"><link rel="modulepreload" crossorigin="" href="/assets/Vue3-0Reactivityä¹‹computed-CKpF9OvF.js"><meta property="og:title" content="Vue3.0Reactivityä¹‹computed"><meta name="twitter:title" content="Vue3.0Reactivityä¹‹computed"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="æ‹ã®æ­Œçš„logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="è‡ªåŠ¨" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="æ—¥é—´" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="å¤œé—´" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">Vue3.0Reactivityä¹‹computed</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">å‘è¡¨äº</span><span pl-1="">2020-06-12 11:33</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">æ›´æ–°äº</span><span pl-1="">2023-02-13 18:28</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">åˆ†ç±»äº</span><!--[--><a pl-1="" href="/category/ç¼–ç¨‹">ç¼–ç¨‹</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">æ€»å­—æ•°</span><span pl-1="">2.6K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">é˜…è¯»æ—¶é•¿ â‰ˆ</span><span pl-1="">10 åˆ†é’Ÿ</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><h1 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€">ğŸ”—</a></h1><p>è¿™æ¬¡è®²è®²<code>computed</code>è¿™ä¸ªAPI</p><h1 id="computed" tabindex="-1"><code>computed</code> <a class="header-anchor" href="#computed">ğŸ”—</a></h1><p><code>computed</code>åœ¨Vue2ä¹Ÿæœ‰ä½“ç°ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªç¼“å­˜æ¯”è¾ƒå¤§çš„è®¡ç®—é‡çš„å€¼çš„ä¸€ç§æ–¹æ³•ï¼Œå¹¶ä¸”èƒ½åœ¨ä¾èµ–çš„å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è‡ªåŠ¨çš„è®¡ç®—æ›´æ–°åçš„å€¼ã€‚</p><p>åœ¨æˆ‘ä»¬å‰é¢çš„ç¿»è¯‘APIçš„æ–‡ç« ä¸­çŸ¥é“äº†Vue3ä¸­<code>computed</code>æ¥æ”¶ä¸€ä¸ªgetterå‡½æ•°ï¼Œè¿”å›äº†ä¸€ä¸ª<code>ref</code>çš„å¯¹è±¡ã€‚</p><p>å¯ä»¥ç”¨ä¸€ä¸ªä¾‹å­æ¥ç®€å•çš„çœ‹ä¸‹Vue3ä¸­<code>computed</code>çš„ä½¿ç”¨ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#666666;--s-light:#999999">{</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reactive</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> effect</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> VueReactivity</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">o</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">lwf</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">o</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">c</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">name</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> + </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> --- computed</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">effect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">name</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>è¿™æ—¶å€™æˆ‘ä»¬å°è¯•æ”¹å˜<code>r.name</code>çš„å€¼ï¼Œç„¶åå†è¾“å‡º<code>c.value</code>çš„å€¼</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/05/04/FZPTJUfeywNV9mS.gif" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/05/04/FZPTJUfeywNV9mS.gif" alt=""></a></p><p>åœ¨æ›´æ–°äº†å“åº”å¼å¯¹è±¡<code>r</code>çš„<code>name</code>å±æ€§ä¹‹åï¼Œå®ƒçš„ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™çš„effectä¾¿æ‰§è¡Œäº†ï¼Œç„¶åå†æ‰“å°<code>c.value</code>ï¼Œå‘ç°å®ƒçš„å€¼å·²ç»å‘ç”Ÿäº†æ”¹å˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥æ¢ç©¶è¿™ä¸ªAPIæ˜¯å¦‚ä½•åšåˆ°è¿™ç§æ•ˆæœçš„ã€‚</p><p>é¦–å…ˆï¼Œè€å¥—è·¯ï¼Œæ‰¾åˆ°å®ƒçš„å®šä¹‰</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">getter</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">setter</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedSetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#80A665;--s-light:#59873A">isFunction</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">))</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    getter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> getterOrOptions</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    setter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> __DEV__</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">          console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">warn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Write operation failed: computed value is readonly</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> NOOP</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    getter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">get</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    setter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">set</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedRef</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">runner</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> effect</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">getter</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    lazy</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // mark effect as computed so that it gets priority during trigger</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    computed</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    scheduler</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        dirty</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">        trigger</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">TriggerOpTypes</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">SET</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  })</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  computed</span><span style="--s-dark:#666666;--s-light:#999999"> = {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    _isRef</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // expose effect so computed can be stopped</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    effect</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">runner</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    get</span><span style="--s-dark:#80A665;--s-light:#59873A"> value</span><span style="--s-dark:#666666;--s-light:#999999">() {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        value</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#80A665;--s-light:#59873A">runner</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        dirty</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#4D9375;--s-light:#1E754F">false</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      track</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">TrackOpTypes</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">GET</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    set</span><span style="--s-dark:#80A665;--s-light:#59873A"> value</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">newValue</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      setter</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">newValue</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> as</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> any</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>è¿™ä¸ªå‡½æ•°å¾ˆé•¿ï¼Œä½†æ€»ä½“ä¸Šå¯ä»¥åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†</p><ul><li>åŒ¹é…å‚æ•°</li><li>å»ºç«‹ä¾èµ–</li><li>è¿”å›æ„å»ºçš„<code>computed</code>å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯<code>ref</code>å¯¹è±¡ï¼‰</li></ul><h2 id="åŒ¹é…å‚æ•°" tabindex="-1">åŒ¹é…å‚æ•° <a class="header-anchor" href="#åŒ¹é…å‚æ•°">ğŸ”—</a></h2><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">getter</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">setter</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedSetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#80A665;--s-light:#59873A">isFunction</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">))</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    getter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> getterOrOptions</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    setter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> __DEV__</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      ?</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">          console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">warn</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Write operation failed: computed value is readonly</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      :</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> NOOP</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    getter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">get</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    setter</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">set</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>è¿™é‡Œåˆ¤æ–­äº†ä¼ è¿›æ¥çš„å‚æ•°æ˜¯ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ä½œä¸ºä¸€ä¸ªgetterï¼ˆæ­¤æ—¶å°±æ˜¯åªè¯»çš„ï¼‰ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£å°±åˆ†åˆ«å–<code>get</code>å’Œ<code>set</code>å±æ€§åšä¸ºgetterå’Œsetterã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œä½¿ç”¨<code>computed</code>æ—¶ï¼Œéƒ½æ˜¯ç›´æ¥ä¼ é€’ä¸€ä¸ªå‡½æ•°è¿›å»ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æˆ‘ä¸¾çš„ä¾‹å­ä¸€æ ·ï¼ŒåŸºæœ¬ä¸Šç”¨ä¸åˆ°setterã€‚</p><h2 id="å»ºç«‹effectï¼ˆä¾èµ–ï¼‰" tabindex="-1">å»ºç«‹effectï¼ˆä¾èµ–ï¼‰ <a class="header-anchor" href="#å»ºç«‹effectï¼ˆä¾èµ–ï¼‰">ğŸ”—</a></h2><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let </span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedRef</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">runner</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> effect</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">getter</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    lazy</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // mark effect as computed so that it gets priority during trigger</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    computed</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    scheduler</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        dirty</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">        trigger</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">TriggerOpTypes</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">SET</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  })</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>è¿™é‡Œæ„å»ºäº†ä¸€ä¸ªeffectï¼ŒæŠŠä¼ è¿›æ¥çš„getterä¼ è¿›äº†<code>effect</code>è¿™ä¸ªAPIï¼Œé€šè¿‡ä¹‹å‰<code>reactive</code>APIçš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œ</p><p><code>effect</code>ä¼ è¿›ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠè¿™ä¸ªå‡½æ•°å’Œè¿™ä¸ªå‡½æ•°å†…éƒ¨ä½¿ç”¨çš„å“åº”å¼å˜é‡å»ºç«‹å…³è”ï¼Œå½“è¿™äº›å“åº”å¼å˜é‡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±é‡æ–°æ‰§è¡Œè¿™ä¸ªä¼ è¿›æ¥çš„å‡½æ•°ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ„å»ºçš„effectå’Œæˆ‘ä»¬ä¹‹å‰ä¼¼ä¹æœ‰ç‚¹ä¸åŒï¼Œé¢å¤–çš„ä¼ å…¥äº†ä¸€ä¸ªå‚æ•°ã€‚</p><p>é¦–å…ˆæ˜¯<code>lazy</code>ï¼Œè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯ï¼Œä¸é©¬ä¸Šæ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯è‡ªåŠ¨ï¼‰è¿™ä¸ªå‡½æ•°æ¥å»ºç«‹ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡è¿”å›çš„å‡½æ•°æ¥æ‰‹åŠ¨çš„æ¥æ”¶é›†ä¾èµ–ã€‚</p><p>è¿™é‡Œçš„<code>lazy</code>åœ¨<code>effect</code>çš„æºç ä¸­éå¸¸ç®€å•</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> effect</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> any</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  fn</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  options</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ReactiveEffectOptions</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> EMPTY_OBJ</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> ReactiveEffect</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#80A665;--s-light:#59873A">isEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">))</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    fn</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> fn</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">raw</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> createReactiveEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fn</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> options</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ä¸‹é¢ä¸ºlazyå‚æ•°</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">lazy</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    effect</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> effect</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>å¯ä»¥ç®€å•çš„ç†è§£ï¼Œ<code>lazy</code>ä¸ºå‡ï¼Œå°±è‡ªåŠ¨å¸®ä½ æ‰§è¡Œäº†è¿™ä¸ªåœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºå‡ºæ¥çš„effectï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨çš„æ”¶é›†ä¾èµ–ã€‚å¦‚æœä¸ºçœŸï¼Œç›´æ¥è¿”å›ï¼Œå¯ä»¥ç”±ç”¨æˆ·è‡ªå·±æ‰§è¡Œæ¥æ”¹å˜æ”¶é›†ä¾èµ–çš„æ—¶æœºã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>computed</code>ï¼Œè¿™ä¸ªå‚æ•°ä¸Šé¢æœ‰ä¸€ä¸ªæ³¨é‡Šï¼Œç¿»è¯‘è¿‡æ¥ä¸ºï¼šç»™è¿™ä¸ªeffectæ·»åŠ ä¸€ä¸ªæ ‡è®°ï¼Œä»¥è‡³äºå®ƒå¯ä»¥åœ¨triggeræ—¶ï¼Œä¼˜å…ˆçš„æ‰§è¡Œã€‚</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º<code>scheduler</code>ï¼Œä¼ å…¥çš„ä¸ºä¸€ä¸ªå‡½æ•°ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å›åˆ°å‰é¢çœ‹<code>trigger</code>å‡½æ•°çš„å®ç°ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> trigger</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  target</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#CB7676;--s-light:#AB5959">object</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  type</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">TriggerOpTypes</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  key</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  newValue</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  oldValue</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  oldTarget</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Map</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Set</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">effects</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new </span><span style="--s-dark:#80A665;--s-light:#59873A">Set</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ReactiveEffect</span><span style="--s-dark:#666666;--s-light:#999999">&gt;()</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // è¿™æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§çš„effectçš„Set</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">computedRunners</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new </span><span style="--s-dark:#80A665;--s-light:#59873A">Set</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ReactiveEffect</span><span style="--s-dark:#666666;--s-light:#999999">&gt;()</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#80A665;--s-light:#59873A">add</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effectsToAdd</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Set</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ReactiveEffect</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#CB7676;--s-light:#AB5959">undefined</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effectsToAdd</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      effectsToAdd</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> !== </span><span style="--s-dark:#BD976A;--s-light:#B07D48">activeEffect</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> || !</span><span style="--s-dark:#BD976A;--s-light:#B07D48">shouldTrack</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          // æ ¹æ®computedè¿™ä¸ªå‚æ•°æ¥åˆ†ç±»effect</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">          if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">            computedRunners</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">add</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">            effects</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">add</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">          }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          // the effect mutated its own dependency during its execution.</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          // this can be caused by operations like foo.value++</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          // do not trigger or we end in an infinite loop</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">  </span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">  </span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#80A665;--s-light:#59873A">run</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ReactiveEffect</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">__DEV__</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> &amp;&amp; </span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onTrigger</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      effect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">onTrigger</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        effect</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        target</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        key</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        type</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        newValue</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        oldValue</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        oldTarget</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // å¦‚æœscheduleræœ‰å€¼ï¼Œå°±æ‰§è¡Œschedulerï¼Œå¦åˆ™å°±æ‰§è¡Œeffectã€‚</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">scheduler</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      effect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">scheduler</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      effect</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // Important: computed effects must be run first so that computed getters</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // can be invalidated before any normal effects that depend on them are run.</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // é‡ç‚¹ï¼šè®¡ç®—effectéœ€è¦æå‰è¿è¡Œã€‚è¿™æ ·å¯ä»¥ä½¿å¾—è®¡ç®—effectçš„getterçš„å€¼åœ¨ä»»ä½•ä¸€èˆ¬çš„effectè¿è¡Œä¹‹å‰å¤±æ•ˆ</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  computedRunners</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">run</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  effects</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">run</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>å…·ä½“çš„é‡ç‚¹éƒ½å†™åœ¨ä»£ç çš„æ³¨é‡Šä¸­äº†ï¼Œç®€å•è®²å°±æ˜¯åˆ†effectä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä¸€èˆ¬effectï¼Œä¸€ç±»æ˜¯è®¡ç®—effectï¼Œå½“ä¸€ä¸ªå“åº”å¼å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå…ˆæ‰§è¡Œå®ƒçš„è®¡ç®—effectï¼Œå†æ‰§è¡Œå®ƒçš„ä¸€èˆ¬effectã€‚</p><p>ä¸ºå•¥è¦å…ˆæ‰§è¡Œè®¡ç®—effectå‘¢ï¼Ÿè¿™ä¸ªæˆ‘ä»¬æœ€åå†è¯´ã€‚</p><h2 id="è¿”å›æ„å»ºçš„computedå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯refå¯¹è±¡ï¼‰" tabindex="-1">è¿”å›æ„å»ºçš„<code>computed</code>å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯<code>ref</code>å¯¹è±¡ï¼‰ <a class="header-anchor" href="#è¿”å›æ„å»ºçš„computedå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯refå¯¹è±¡ï¼‰">ğŸ”—</a></h2><p>æˆ‘ä»¬å†çœ‹æœ€åä¸€æ®µä»£ç </p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  options</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WritableComputedRef</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  computed</span><span style="--s-dark:#666666;--s-light:#999999"> = {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    _isRef</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // expose effect so computed can be stopped</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    effect</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">runner</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    get</span><span style="--s-dark:#80A665;--s-light:#59873A"> value</span><span style="--s-dark:#666666;--s-light:#999999">() {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        value</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#80A665;--s-light:#59873A">runner</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        dirty</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#4D9375;--s-light:#1E754F">false</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      track</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">TrackOpTypes</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">GET</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    set</span><span style="--s-dark:#80A665;--s-light:#59873A"> value</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">newValue</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      setter</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">newValue</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> as</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> any</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>æœ€åå°±æ˜¯æ„å»ºä¸€ä¸ªrefå¯¹è±¡ï¼Œå’Œä¸€èˆ¬çš„refå¯¹è±¡ä¸åŒçš„æ˜¯ï¼Œè®¡ç®—refæœ‰ä¸€ä¸ª<code>effect</code>çš„å±æ€§ï¼Œæš´éœ²äº†é€šè¿‡å‚æ•°ç”Ÿæˆçš„effectå¯¹è±¡ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœæ­¢è¿™ä¸ªeffectã€‚</p><p>è¿™ä¸ªæ„å»ºçš„refå¯¹è±¡å’Œæˆ‘ä»¬ä¹‹å‰é€šè¿‡<code>ref</code>æ„å»ºçš„refå¯¹è±¡åŸºæœ¬å¾ˆåƒï¼Œä½†æ˜¯åœ¨getterä¸­å‡ºç°äº†ä¸€ä¸ªåˆ¤æ–­ã€‚åˆ¤æ–­äº†<code>dirty</code>çš„å€¼æ¥æ‰§è¡Œ<code>runner</code>ä¹Ÿå°±æ˜¯effectã€‚</p><p>é‚£è¿™ä¸ª<code>dirty</code>æ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨å¼€å¤´ä¸¾çš„ä¾‹å­ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#666666;--s-light:#999999">{</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reactive</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> effect</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> VueReactivity</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">o</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">lwf</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">o</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">c</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">name</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> + </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> --- computed</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">effect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">name</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>å½“æˆ‘ä»¬æ‰“å°<code>c.value</code>æ—¶ï¼Œè¿™æ˜¯è§¦å‘äº†<code>value</code>çš„getterï¼Œä¹Ÿå°±æ˜¯åˆ°äº†</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  options</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WritableComputedRef</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  computed</span><span style="--s-dark:#666666;--s-light:#999999"> = {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    get</span><span style="--s-dark:#80A665;--s-light:#59873A"> value</span><span style="--s-dark:#666666;--s-light:#999999">() {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // æ­¤æ—¶è¿è¡Œåˆ°è¿™é‡Œ</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        value</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#80A665;--s-light:#59873A">runner</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        dirty</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#4D9375;--s-light:#1E754F">false</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      track</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">TrackOpTypes</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">GET</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> value</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> as</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> any</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ¤æ–­äº†<code>dirty</code>ï¼Œ<code>dirty</code>åˆå§‹åŒ–æ˜¯<code>true</code>çš„ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œifå—ã€‚</p><p>è¿™æ—¶å€™æ‰§è¡Œäº†<code>runner</code>ï¼Œä¹Ÿå°±æ˜¯å“åº”å¼å¯¹è±¡<code>r</code>ä¼šæ”¶é›†åˆ°ä¼ å…¥<code>computed</code>çš„å‡½æ•°ã€‚</p><p><code>runner</code>çš„è¿”å›å€¼ä¹Ÿå°±æ˜¯ä¼ å…¥å‡½æ•°çš„è¿”å›å€¼ï¼Œèµ‹ç»™äº†<code>value</code>å˜é‡ï¼Œç„¶åç½®<code>dirty</code>å˜é‡ä¸º<code>false</code>ï¼Œæ¥ç€ä¾¿æ˜¯æ”¶é›†ä¾èµ–ï¼Œè¿”å›<code>value</code>å˜é‡äº†ã€‚</p><p>åˆ°è¿™ï¼Œæˆ‘ä»¬å°±è·å¾—äº†computedå¯¹è±¡çš„<code>value</code>å±æ€§äº†</p><p>å¦‚æœç°åœ¨æˆ‘ä»¬å†ä¸€æ¬¡çš„è¿è¡Œ<code>c.value</code>ï¼Œä¾ç„¶ä¼šè°ƒç”¨è¿™ä¸ªå±æ€§çš„getterï¼Œä½†æ˜¯ç”±äº<code>dirty</code>å˜é‡ä¸º<code>false</code>ï¼Œç›´æ¥è¿”å›äº†<code>value</code>å¯¹è±¡ã€‚</p><p>èªæ˜çš„äººå¯èƒ½æ˜ç™½äº†ï¼Œ<code>dirty</code>æ˜¯ç”¨æ¥åˆ¤æ–­ä¾èµ–åˆ°çš„å“åº”å¼å¯¹è±¡æ˜¯å¦å‘ç”Ÿæ”¹å˜çš„ã€‚</p><p>æ²¡æ”¹å˜çš„è¯ï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„å€¼ï¼Œä¹Ÿå°±é¿å…äº†å¤šæ¬¡çš„è®¡ç®—ã€‚</p><p>okï¼Œè¿™æ—¶ï¼Œæˆ‘æ‰§è¡Œäº†<code>r.name = &amp;#39;index&amp;#39;</code>ï¼Œä¹Ÿå°±æ˜¯ä¼šè§¦å‘å“åº”å¼å¯¹è±¡<code>r</code>çš„æ‰€æœ‰ä¾èµ–effectæ‰§è¡Œã€‚</p><p>è¿™æ—¶ï¼Œå“åº”å¼å¯¹è±¡<code>r</code>çš„ä¾èµ–ä¸­æ˜¯æœ‰æˆ‘ä»¬ä¼ å…¥<code>computed</code>çš„å‡½æ•°æ‰€æ„æˆçš„effectçš„ã€‚</p><p>åœ¨<code>trigger</code>å‡½æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>run</code>å‡½æ•°</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> trigger</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">  </span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#80A665;--s-light:#59873A">run</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ReactiveEffect</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // å¦‚æœscheduleræœ‰å€¼ï¼Œå°±æ‰§è¡Œschedulerï¼Œå¦åˆ™å°±æ‰§è¡Œeffectã€‚</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">scheduler</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      effect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">scheduler</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">effect</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      effect</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // Important: computed effects must be run first so that computed getters</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // can be invalidated before any normal effects that depend on them are run.</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // é‡ç‚¹ï¼šè®¡ç®—effectéœ€è¦æå‰è¿è¡Œã€‚è¿™æ ·å¯ä»¥ä½¿å¾—è®¡ç®—effectçš„getterçš„å€¼åœ¨ä»»ä½•ä¸€èˆ¬çš„effectè¿è¡Œä¹‹å‰å¤±æ•ˆ</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  computedRunners</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">run</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  effects</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">forEach</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">run</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>è¿™ä¸ª<code>run</code>å‡½æ•°å°±æ˜¯æ‰§è¡Œæˆ‘ä»¬çš„effectçš„ï¼Œå…¶ä¸­åˆ¤æ–­äº†<code>effect.options.scheduler</code>ï¼Œä¸ºçœŸå°±ä¼ å…¥effectå¯¹è±¡å¹¶æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯<code>effect.options.scheduler(effect)</code>ï¼Œä¸ºå‡å°±ç›´æ¥æ‰§è¡Œeffectå¯¹è±¡ã€‚</p><p>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰é€šè¿‡ä¼ å…¥å‡½æ•°ç”Ÿæˆä¸€ä¸ªè®¡ç®—effectæ—¶ä¼ å…¥çš„é¢å¤–å‚æ•°å—ï¼Ÿ</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  getterOrOptions</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ComputedGetter</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt; | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WritableComputedOptions</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">runner</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> effect</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">getter</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    scheduler</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      //è¿™é‡Œå°±æ˜¯å½“è®¡ç®—effectä¾èµ–çš„å“åº”å¼å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šæ‰§è¡Œçš„ä»£ç æ®µã€‚</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48">dirty</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        dirty</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">        trigger</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">computed</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">TriggerOpTypes</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">SET</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>è¿™é‡Œåˆ¤æ–­äº†<code>dirty</code>å˜é‡ï¼Œå¦‚æœä¸º<code>false</code>ï¼Œå°±ç½®ä¸º<code>true</code>å¹¶è§¦å‘è¿™ä¸ªè®¡ç®—refçš„ä¾èµ–ï¼Œ<code>dirty</code>ä¸ºå‡çš„æ„æ€å°±æ˜¯æ­¤æ—¶è®¡ç®—refæ‰€ä¾èµ–çš„å“åº”å¼å¯¹è±¡å·²ç»å‘ç”Ÿæ”¹å˜äº†ã€‚</p><p>å‰é¢æˆ‘ä»¬å·²ç»æ‰“å°äº†<code>c.value</code>çš„å€¼äº†ï¼Œè¿™æ—¶çš„<code>dirty</code>å°±æ˜¯<code>false</code>äº†ï¼Œè¿›å…¥äº†ifçš„ä»£ç å—ã€‚ç½®ä¸º<code>dirty</code>ä¸º<code>true</code>ï¼Œè§¦å‘äº†è®¡ç®—refçš„ä¾èµ–ã€‚</p><p>å¦‚æœä¸€ç›´æ²¡æœ‰å–<code>value</code>å±æ€§çš„å€¼ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦å»è§¦å‘è®¡ç®—refçš„ä¾èµ–ã€‚åœ¨ç¬¬ä¸€æ¬¡è·å–è®¡ç®—refçš„å€¼ï¼ˆ<code>.value</code>ï¼‰ä¹‹å‰ï¼Œå®ƒçš„å€¼éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼ˆä¹Ÿä¸èƒ½è¯´ä¸ç¡®å®šï¼Œå°±æ˜¯ä¼šæ ¹æ®å®ƒæ‰€ä¾èµ–å“åº”å¼å¯¹è±¡çš„æœ€æ–°å€¼æ¥è¿›è¡Œè®¡ç®—å¹¶è¿”å›ï¼‰ã€‚</p><p>è¿™æ—¶æˆ‘ä»¬å†æ¬¡æ‰“å°<code>c.value</code>ï¼Œç”±äºå“åº”å¼å¯¹è±¡<code>r</code>çš„æ”¹å˜ä½¿å¾—<code>dirty</code>å˜ä¸ºäº†<code>true</code>ï¼Œå°±åˆè¦å†æ‰§è¡Œä¸€æ¬¡<code>runner</code>æ¥è·å–æœ€æ–°çš„å€¼ã€‚</p><p>æœ€åï¼Œä¸ºä»€ä¹ˆè¦å…ˆæ‰§è¡Œå“åº”å¼å¯¹è±¡çš„è®¡ç®—effectå‘¢ï¼Ÿ</p><p>å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç æ¥ç†è§£</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#666666;--s-light:#999999">{</span><span style="--s-dark:#BD976A;--s-light:#B07D48">reactive</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> effect</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> VueReactivity</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">o</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">lwf</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">o</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">c</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">name</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> + </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> --- computed</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">effect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">name</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">c</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>è¿™æ—¶è¿è¡Œ<code>r.name = &amp;#39;index&amp;#39;</code>çš„è¯ï¼Œè¿™æ—¶ä¼šæ‰“å°ä¸¤æ¬¡effect</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-text"><span class="line"><span>// rå¯¹è±¡æ”¹å˜è§¦å‘äº†effect</span></span>
<span class="line"><span>'index'</span></span>
<span class="line"><span>'index --- computed'</span></span>
<span class="line"><span>// cå¯¹è±¡æ”¹å˜è§¦å‘äº†effect</span></span>
<span class="line"><span>'index'</span></span>
<span class="line"><span>'index --- computed'</span></span></code></pre><p>å¦‚æœä½ æ²¡æœ‰å…ˆæ‰§è¡Œè®¡ç®—effectçš„è¯ï¼Œæ­¤æ—¶å¯¹äºè¯¥è®¡ç®—refçš„<code>dirty</code>è¿˜æ˜¯<code>false</code>ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é€šçŸ¥åˆ°è®¡ç®—refå¯¹è±¡æ­¤æ—¶ä¾èµ–çš„å“åº”å¼å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ï¼Œä½¿ç”¨åˆ°äº†æ—§çš„å€¼ã€‚ä¹Ÿå°±æ˜¯æ‰“å°äº†</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-text"><span class="line"><span>// rå¯¹è±¡æ”¹å˜è§¦å‘äº†effect</span></span>
<span class="line"><span>'index'</span></span>
<span class="line"><span>// cçš„getterä¸­dirtyè¿˜æ˜¯ä¸ºfalseï¼Œä½¿ç”¨åˆ°äº†æ—§çš„å€¼ã€‚</span></span>
<span class="line"><span>'lwf --- computed'</span></span>
<span class="line"><span>// cå¯¹è±¡æ”¹å˜è§¦å‘äº†effect</span></span>
<span class="line"><span>'index'</span></span>
<span class="line"><span>'index --- computed'</span></span></code></pre><p>è‡³æ­¤ï¼Œ<code>computed</code>APIçš„åŸºæœ¬æµç¨‹åŸºæœ¬ä¸Šå°±è®²å®Œäº†ã€‚ä¸å¾—ä¸è¯´å®ç°ä¸Šç¡®å®å¾ˆå·§å¦™ï¼Œç”¨åˆ°äº†å¾ˆå¤šçš„é—­åŒ…ã€‚</p><h1 id="åè®°" tabindex="-1">åè®° <a class="header-anchor" href="#åè®°">ğŸ”—</a></h1><p>è¿˜å·®æœ€åä¸€ä¸ª<code>readonly</code>APIäº†ï¼Œè¿™ä¸ªå’Œ<code>reactive</code>å·®ä¸å¤šï¼Œè¿™å‡ å¤©åº”è¯¥å°±å¯ä»¥å†™å‡ºæ¥äº†ï¼Œå¦‚æœæˆ‘å†™çš„æœ‰é”™ï¼Œå¸Œæœ›å¯ä»¥æŒ‡å‡ºï¼Œéå¸¸æ„Ÿè°¢ï¼~</p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#JavaScript</div><div>#Vue</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/69a5f2d7683a" class="" truncate="" title="Vue3.0Reactivityä¹‹readonly"><i class="i-mi:chevron-left" mr-1=""></i><span>Vue3.0Reactivityä¹‹readonly</span></a><a href="/f2ce2a5d2fc0" class="" ml-auto="" truncate="" title="Vue3.0Reactivityä¹‹ref"><span>Vue3.0Reactivityä¹‹ref</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-f3312cf8="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-f3312cf8=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-f3312cf8=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-f3312cf8=""></i></div><div flex="~ col grow" gap-2="" lg:gap-4="" data-v-f3312cf8=""><textarea disabled="" placeholder="ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç•™ä¸‹è¯„è®ºè¡Œä¸è¡Œ" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" lg:p-4="" data-v-f3312cf8=""></textarea><div flex="" items-start="" data-v-f3312cf8=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-f3312cf8="">æ”¯æŒ Markdown è¯­æ³•</a><div ml-auto="" data-v-f3312cf8=""></div><!----><button class="mujika-button" data-v-f3312cf8="" data-v-15330f5f=""><!--[--><!--]--><!--[-->ç‚¹å‡»ç™»å½•<!--]--></button></div></div></div><!--]--></div></div><!----><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">æ–‡ç« ç›®å½•</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-d1d7a153=""><div flex="" items-center="" data-v-d1d7a153=""><span data-v-d1d7a153="">Power by&nbsp;</span><i class="i-logos:vue" data-v-d1d7a153=""></i><span data-v-d1d7a153="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-d1d7a153=""></i></div><div text-center="" data-v-d1d7a153=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-d1d7a153="">CC BY-NC-SA 4.0 </a>2021 - PRESENT Â© Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-d1d7a153="">å¦‚æœæˆ‘å’Œç‹—ä¸€æ ·æœ‰å°¾å·´çš„è¯ï¼Œä¸€å®šä¼šè—ä¸ä½è¿™ä»½å–œæ‚¦ï¼Œè€Œå°¾å·´ä¸€ç›´æ‘‡ä¸ªä¸åœå§ã€‚</div></footer></div></div></body></html>