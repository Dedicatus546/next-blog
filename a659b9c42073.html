<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>恋の歌</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-D1RD9nfH.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-BmBo8YJO.css"><link rel="modulepreload" crossorigin="" href="/assets/JavaScript的一种跨标签页的通信方式-BU8QbTAh.js"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="恋の歌的logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="自动" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="日间" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="夜间" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">JavaScript的一种跨标签页的通信方式</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">发表于</span><span pl-1="">2021-08-11 17:02</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">更新于</span><span pl-1="">2023-02-13 18:28</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">分类于</span><!--[--><a pl-1="" href="/category/编程">编程</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">总字数</span><span pl-1="">2.3K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">阅读时长 ≈</span><span pl-1="">9 分钟</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><p><code>JavaScript</code>的一种跨标签页的通信方式。</p><p>刚好这个星期在搞第三方账号接入我们的一个系统。</p><p>原型很简单，就是点击某个按钮，弹出一个第三方的账号接入页面，可能是输入账号，也可能是扫码等等。</p><p>执行完授权操作之后，自动关闭授权窗口，然后局部刷新原来页面的授权账号列表。</p><p>这个可以用掘金的授权登录来看，就类似下面这种类型：</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/08/14/fyD6US.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/08/14/fyD6US.png" alt=""></a></p><p>刚开始完全懵逼的好吧，没做过这种需求，只会登录注册的我流下了悔恨的泪水，呜呜呜😭。</p><p>从原型来看，转为代码需要解决的点有三个：</p><ul><li>怎么生成这样的小窗口；</li><li>怎么在授权之后自动关闭；</li><li>怎么往授权页传输数据；</li><li>怎么在授权之后通知到原来的页面；</li></ul><h1 id="生成一个小窗口" tabindex="-1">生成一个小窗口 <a class="header-anchor" href="#生成一个小窗口">🔗</a></h1><p>平时可能为了新开一个标签页，可能会使用两种方式：</p><ul><li>使用<code>window.open(href, "_blank")</code>来新开一个窗口；</li><li>构建一个<code>&lt;a href="href" target="_blank"/&gt;</code>标签，然后使用<code>click</code>方法模拟点击，新开一个窗口；</li></ul><p>第二个感觉没戏，所以就把目光转向<code>window.open</code>，去<code>MDN</code>查了下，发现<code>window.open</code>可以打开小窗口！</p><p>通过<code>window.open</code>的第三个参数，可以选择窗口的一些配置，常用的如下：</p><ul><li><code>width</code> 指定窗口宽度</li><li><code>height</code> 指定窗口高度</li><li><code>top</code> 窗口左上角距离屏幕左上角的高度偏移</li><li><code>left</code> 窗口左上角距离屏幕左上角的宽度偏移</li><li><code>menubar</code> 是否显示菜单栏</li><li><code>toolbar</code> 是否显示工具栏</li><li><code>status</code> 是否显示状态栏</li><li><code>scrollbars</code> 是否显示滚动条</li><li>…</li></ul><p>由于第三个参数需要以字符串的形式来传入，比如指定宽高的话就为<code>'width=1000,height=500'</code>。</p><p>字符串还是比较不方便的，我们可以使用对象来传入，然后稍微处理下：</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> openUrl</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">url</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> name</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> config</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {})</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> str</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Object</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">entries</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">config</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">map</span><span style="--s-dark:#666666;--s-light:#999999">(([</span><span style="--s-dark:#BD976A;--s-light:#B07D48">key</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> val</span><span style="--s-dark:#666666;--s-light:#999999">])</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> `</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">key</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D;--s-light:#B56959">=</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">val</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">join</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> window</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">open</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">url</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> name</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> str</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>然后我们可以尝试一下：</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">openUrl</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">https://www.baidu.com</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">百度</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  width</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1200</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  height</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 600</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  top</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 100</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  left</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 100</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  menubar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  toolbar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  status</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  scrollbars</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">yes</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>效果如下：</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/08/14/f6eXE8.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/08/14/f6eXE8.png" alt=""></a></p><p>看起来还不错，那么第一个问题我们就解决了。</p><h1 id="授权之后自动关闭" tabindex="-1">授权之后自动关闭 <a class="header-anchor" href="#授权之后自动关闭">🔗</a></h1><p>有<code>window.open</code>，感觉应该就有<code>window.close</code>，去<code>MDN</code>搜了搜，发现还真有，真好对应了窗口的关闭。</p><p><code>MDN</code>对<code>window.close</code>的解释如下：</p><blockquote><p>该方法只能由<code>window.open</code>方法打开的窗口的<code>window</code>对象来调用。如果一个窗口不是由脚本打开的，那么，在调用该方法时，<code>JavaScript</code>控制台会出现类似下面的错误： 不能使用脚本关闭一个不是由脚本打开的窗口。 或<code>Scripts may not close windows that were not opened by script.</code>。</p></blockquote><p>也就是说，如果我们想关闭一个打开的窗口，前提是这个窗口是由我打开的</p><p>那么我打开的这个窗口的 <code>window</code> 对象怎么获取呢，很简单，就是 <code>window.open</code> 的返回值</p><p>我们可以打印下</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/05/Iu5Aaj.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/05/Iu5Aaj.png" alt=""></a></p><p>确实是一个 <code>window</code> 对象，而且也存在 <code>close</code> 方法</p><p>我们试下调用 <code>close</code> 方法能不能关闭这个窗口</p><p>贴下整体的代码（使用Vue3）</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> lang</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> openUrl</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  url</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  config</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Record</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999"> | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> str</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Object</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">entries</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">config</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">map</span><span style="--s-dark:#666666;--s-light:#999999">(([</span><span style="--s-dark:#BD976A;--s-light:#B07D48">key</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> val</span><span style="--s-dark:#666666;--s-light:#999999">])</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> `</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">key</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D;--s-light:#B56959">=</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">val</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">join</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> window</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">open</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">url</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> name</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> str</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> targetWindow</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Window</span><span style="--s-dark:#666666;--s-light:#999999"> | </span><span style="--s-dark:#CB7676;--s-light:#AB5959">null</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> null</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> openHandler</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  targetWindow</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> openUrl</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">https://www.baidu.com</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">百度</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    width</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1200</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    height</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 600</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    top</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 100</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    left</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 100</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    menubar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    toolbar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    status</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    scrollbars</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">yes</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> closeHandler</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  targetWindow</span><span style="--s-dark:#666666;--s-light:#999999">?.</span><span style="--s-dark:#80A665;--s-light:#59873A">close</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">openHandler</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">打开窗口</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">closeHandler</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">关闭窗口</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/05/Iu5LlV.gif" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/05/Iu5LlV.gif" alt=""></a></p><p>没有问题，如果我们对自身直接使用 <code>window.close</code> 会有什么现象呢</p><p>直接开控制台试一下</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/05/IuIeTH.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/05/IuIeTH.png" alt=""></a></p><p>发现出现了警告⚠️，而且标签页也没有被关闭，警告的大致意思就是只能又打开的窗口进行关闭</p><p>那么第二个问题基本解决，接下来就是最后一个问题</p><h1 id="怎么往授权页传输数据" tabindex="-1">怎么往授权页传输数据 <a class="header-anchor" href="#怎么往授权页传输数据">🔗</a></h1><p>在授权页我们进行登录，登录成功或者失败，我们都要通知到打开它的那个窗口</p><p>比如登录成功了，通知父窗口局部刷新，或者发送数据给父窗口，父窗口根据这个数据获取用户信息等等</p><p>刚开始，我想，既然父窗口拿到了子窗口的 <code>window</code> 对象，那么是否可以直接在上面挂在属性呢</p><p>类似与 <code>window.val = 1</code> 的形式</p><p>so，我们写出了如下的代码</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> openHandler</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  targetWindow</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> openUrl</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">https://www.baidu.com</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">百度</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    width</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1200</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    height</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 600</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    top</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 100</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    left</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 100</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    menubar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    toolbar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    status</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    scrollbars</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">yes</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // 往 window 上挂在属性</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  targetWindow</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">myVal</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">a val from sub window.</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // 打印该属性</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">targetWindow</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">myVal</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3VwXd.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3VwXd.png" alt=""></a></p><p>发现确实可以往上面挂在属性，控制台也正确地输出了</p><p>正当我觉得应该可以实现的时候，在子窗口里面是打印不出来这个值的</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3VWcQ.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3VWcQ.png" alt=""></a></p><p>这条路行不通，那怎么办呢，其实方法很简单，我们通过url来传递我们需要传递的数据，然后在子页面中对 <code>url</code> 进行解析即可</p><p>比如我们想往授权页传输用户的 <code>id</code> ，我们可以打开一个 <code>'http://target.com?userId=1'</code></p><p>我们可以稍稍的封装一下函数</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> openUrl</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  url</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  config</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Record</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999"> | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">&gt;,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  params</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Record</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">any</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> str</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Object</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">entries</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">config</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      .</span><span style="--s-dark:#80A665;--s-light:#59873A">map</span><span style="--s-dark:#666666;--s-light:#999999">(([</span><span style="--s-dark:#BD976A;--s-light:#B07D48">key</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> val</span><span style="--s-dark:#666666;--s-light:#999999">])</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> `</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">key</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D;--s-light:#B56959">=</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">val</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      .</span><span style="--s-dark:#80A665;--s-light:#59873A">join</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> queryStr</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Object</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">entries</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">params</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      .</span><span style="--s-dark:#80A665;--s-light:#59873A">map</span><span style="--s-dark:#666666;--s-light:#999999">(([</span><span style="--s-dark:#BD976A;--s-light:#B07D48">key</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> val</span><span style="--s-dark:#666666;--s-light:#999999">])</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> `</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">key</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D;--s-light:#B56959">=</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">val</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      .</span><span style="--s-dark:#80A665;--s-light:#59873A">join</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">&amp;</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> window</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">open</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">url</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D;--s-light:#B56959">?</span><span style="--s-dark:#4D9375;--s-light:#1E754F">${</span><span style="--s-dark:#C98A7D;--s-light:#B56959">queryStr</span><span style="--s-dark:#4D9375;--s-light:#1E754F">}</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> name</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> str</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>打开之后</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3mthV.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3mthV.png" alt=""></a></p><p>发现 <code>url</code> 后面带上了参数</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3mzHs.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3mzHs.png" alt=""></a></p><p>然后我们在子页面中通过 <code>window.location.search</code> 即可拿到参数部分，然后进行解析就 <code>ok</code> 了</p><h1 id="怎么在授权之后通知到原来的页面" tabindex="-1">怎么在授权之后通知到原来的页面 <a class="header-anchor" href="#怎么在授权之后通知到原来的页面">🔗</a></h1><p>父窗口向子窗口传递数据搞定了，那么子窗口怎么向父窗口传递数据呢</p><p>像这次的这个第三方接入的需求，需要第三方账号登录成功后通知父窗口发送请求来刷新局部的数据</p><p>通过父向子传递数据我们知道，直接往 <code>window</code> 上挂在可能是行不通的</p><p>不过光说无用，得试试，那么首先要解决怎么在子窗口中拿到父窗口的 <code>window</code> 对象</p><p>这时候就要使用 <code>window</code> 上的 <code>opener</code> 属性了，它会返回打开它自身的 <code>window</code> 对象</p><p>如果这个窗口不是由另一个窗口打开的，那么这个值为 <code>null</code></p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3K7NR.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3K7NR.png" alt=""></a></p><p>那么怎么证明这子窗口里面这个 window 就是父窗口的 window 呢</p><p>可以先在父窗口挂个属性，看子窗口能不能拿到</p><p>可是当我想直接在子窗口看看能不能读到父窗口的属性的时候，报错了</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3QVRx.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3QVRx.png" alt=""></a></p><p>从文字不难看出，是跨域错误，两个不同域的窗体对象不能访问对方属性</p><p>从而也就证实了往 window 上挂载属性是不可行的</p><p>当然即使往 window 上挂载数据可行，从另一个角度想，用户在子窗口进行登录注册的动作是不确定的</p><p>也就是说父窗口无法精确地判断子窗口究竟有没有完成动作</p><p>也就是需要启动一个定时器来轮询子窗口 window 对象上的某个属性</p><p>这样的代码看起来就不符合逻辑</p><p>应该有点类似于发布订阅的类型，子窗口发送一个事件，父窗口往这个事件上注册回调，从而精确地判断子窗口完成动作的时间</p><p>那么在 js 里面，有没有这样的 api 呢</p><p>有的，它就是 <code>message</code> 事件和 <code>postMessage</code> 方法</p><p><code>postMessage</code> 允许我们往另一个窗体上发送 <code>message</code> 事件以及传递相关的数据</p><blockquote><p>window.postMessage() 方法可以安全地实现跨源通信。通常，对于两个不同页面的脚本，只有当执行它们的页面位于具有相同的协议（通常为https），端口号（443为https的默认值），以及主机 (两个页面的模数 Document.domain设置为相同的值) 时，这两个脚本才能相互通信。window.postMessage() 方法提供了一种受控机制来规避此限制，只要正确的使用，这种方法就很安全。 - MDN</p></blockquote><p>它的函数签名有两个</p><ul><li><code>postMessage(message: any, targetOrigin: string, transfer?: Transferable[]): void</code></li><li><code>postMessage(message: any, options?: WindowPostMessageOptions): void</code></li></ul><p>这两个其实一样，只不过把参数 <code>targetOrigin</code> 和 <code>transfer</code> 放到 <code>options</code> 里面而已</p><p>发送 ok 了，那么就是监听 message 事件了</p><p>通过 <code>window.addEventListener('message', callback)</code> 来监听</p><p>回调的 <code>event</code> 参数有三个属性</p><ul><li><code>data</code> : 从其他 <code>window</code> 中传递过来的对象。</li><li><code>origin</code> : 调用 <code>postMessage</code> 时消息发送方窗口的 <code>origin</code> . 这个字符串由 协议、"://"、域名、":端口号"拼接而成。</li><li><code>source</code> : 对发送消息的窗口对象的引用; 您可以使用此来在具有不同 <code>origin</code> 的两个窗口之间建立双向通信。</li></ul><p>那么现在就可以试一试了</p><p>前面我们已经在子窗口中拿到父窗口的对象了</p><p>我们先监听父窗口的 <code>message</code> 事件</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3UTVP.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3UTVP.png" alt=""></a></p><p>接着我们使用子窗口的 <code>postMessage</code> 来往父窗口发送 <code>message</code> 事件</p><p><a data-fancybox="doc-gallery" href="https://z3.ax1x.com/2021/11/07/I3ahJU.png" target="_blank" rel="noopener noreferrer"><img src="https://z3.ax1x.com/2021/11/07/I3ahJU.png" alt=""></a></p><p>发现成功拿到了数据</p><p>这里需要注意是以 <code>window.opener</code> 返回的其他窗口的对象来使用 <code>postMessage</code> 方法</p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#JavaScript</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/41b9b1e48fe0" class="" truncate="" title="view-design的Select组件双向绑定问题"><i class="i-mi:chevron-left" mr-1=""></i><span>view-design的Select组件双向绑定问题</span></a><a href="/004922bae706" class="" ml-auto="" truncate="" title="在浏览器中使用摄像头和麦克风DEMO"><span>在浏览器中使用摄像头和麦克风DEMO</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-557c65bc="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-557c65bc=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-557c65bc=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-557c65bc=""></i></div><div flex="~ col grow" gap-2="" lg:gap-4="" data-v-557c65bc=""><textarea disabled="" placeholder="万水千山总是情，留下评论行不行" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" h-4em="" lg:p-4="" lg:h-8em="" data-v-557c65bc=""></textarea><div flex="" items-start="" data-v-557c65bc=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-557c65bc="">支持 Markdown 语法</a><div ml-auto="" data-v-557c65bc=""></div><!----><button class="mujika-button" data-v-557c65bc="" data-v-15330f5f=""><!--[--><!--]--><!--[-->点击登录<!--]--></button></div></div></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-557c65bc="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" items-center="" justify-center="" data-v-557c65bc="">哦呢该，如果没有评论的话，瓦达西...</div><!----><!--]--></div></div><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">文章目录</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-689781c6=""><div flex="" items-center="" data-v-689781c6=""><span data-v-689781c6="">由&nbsp;</span><i class="i-logos:vue" data-v-689781c6=""></i><span data-v-689781c6="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-689781c6=""></i><span data-v-689781c6="">&nbsp;驱动</span></div><div text-center="" data-v-689781c6=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-689781c6="">CC BY-NC-SA 4.0 </a>2021 - PRESENT © Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-689781c6="">如果我和狗一样有尾巴的话，一定会藏不住这份喜悦，而尾巴一直摇个不停吧。 - 《秒速五厘米》</div></footer></div></div></body></html>