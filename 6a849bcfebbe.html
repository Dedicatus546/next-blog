<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>è®°ä¸€æ¬¡ Safari ä¸‹è°ƒç”¨ navigator.mediaDevices.getDisplayMedia è·å–å½•å±å¤±è´¥é—®é¢˜</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-kEKefLn2.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-DjlQYv3q.css"><link rel="modulepreload" crossorigin="" href="/assets/è®°ä¸€æ¬¡-Safari-ä¸‹è°ƒç”¨-navigator-mediaDevices-getDisplayMedia-è·å–å½•å±å¤±è´¥é—®é¢˜-B5NUjGM6.js"><meta property="og:title" content="è®°ä¸€æ¬¡ Safari ä¸‹è°ƒç”¨ navigator.mediaDevices.getDisplayMedia è·å–å½•å±å¤±è´¥é—®é¢˜"><meta name="twitter:title" content="è®°ä¸€æ¬¡ Safari ä¸‹è°ƒç”¨ navigator.mediaDevices.getDisplayMedia è·å–å½•å±å¤±è´¥é—®é¢˜"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="æ‹ã®æ­Œçš„logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="è‡ªåŠ¨" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="æ—¥é—´" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="å¤œé—´" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">è®°ä¸€æ¬¡ Safari ä¸‹è°ƒç”¨ navigator.mediaDevices.getDisplayMedia è·å–å½•å±å¤±è´¥é—®é¢˜</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">å‘è¡¨äº</span><span pl-1="">2023-07-13 14:41</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">æ›´æ–°äº</span><span pl-1="">2023-07-15 11:58</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">åˆ†ç±»äº</span><!--[--><a pl-1="" href="/category/ç¼–ç¨‹">ç¼–ç¨‹</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">æ€»å­—æ•°</span><span pl-1="">1.6K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">é˜…è¯»æ—¶é•¿ â‰ˆ</span><span pl-1="">6 åˆ†é’Ÿ</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><h1 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€">ğŸ”—</a></h1><p>è®°ä¸€æ¬¡ Safari ä¸‹è°ƒç”¨ navigator.mediaDevices.getDisplayMedia è·å–å½•å±å¤±è´¥é—®é¢˜ã€‚</p><p>å…¬å¸çš„è¿éº¦ç³»ç»Ÿåœ¨ Safari çš„æµ‹è¯•ä¸‹å‡ºç°æ— æ³•å¼€å¯å½•å±æ¨æµçš„é—®é¢˜ï¼Œè€Œåœ¨ Chrome ä¸‹å®Œå…¨æ­£å¸¸ã€‚</p><p>ç„¶å boss å«æˆ‘çœ‹çœ‹è¿™ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆåŸå› ã€‚</p><h1 id="æ­£æ–‡" tabindex="-1">æ­£æ–‡ <a class="header-anchor" href="#æ­£æ–‡">ğŸ”—</a></h1><p>åœ¨ Safari ä¸Šè°ƒç”¨å¤±è´¥çš„æ—¶å€™ï¼Œä¼šå‡ºç° <code>getDisplayMedia must be called from a user gesture handler.</code> è¿™ä¸ªé”™è¯¯ã€‚</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2023/07/13/202307131430368.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2023/07/13/202307131430368.avif" alt=""></a></p><p>äºŒè¯ä¸è¯´å’±å°±æ˜¯ç›´æ¥ä¸€ä¸ªé¢å‘è°·æ­Œç¼–ç¨‹ï¼Œæœç´¢è¿™ä¸ªé”™è¯¯ã€‚</p><p>ä¸€ä¸‹å­å°±åœ¨ StackOverflow ä¸Šæ‰¾åˆ°äº†ç›¸å…³çš„ä¸€äº›å¸–å­ã€‚</p><p><a href="https://stackoverflow.com/questions/62929138/safari-getdisplaymedia-must-be-called-from-a-user-gesture-handler" target="_blank" rel="noopener">Safari getDisplayMedia must be called from a user gesture handler</a></p><p>å¤§è‡´çš„æ„æ€å°±æ˜¯è¯´ï¼Œåœ¨ç”¨æˆ·è¿›è¡Œäº†æ‰‹åŠ¿æ“ä½œä¹‹åæ‰èƒ½è°ƒç”¨ <code>getDisplayMedia</code> æ–¹æ³•ã€‚</p><p>å³ Safari æ— æ³•é€šè¿‡ç±»ä¼¼ <code>onload</code> çš„äº‹ä»¶ï¼Œæˆ–è€… Vue é‡Œé¢çš„ <code>onMounted</code> é’©å­æ¥ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">document</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">addEventListener</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">load</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  navigator</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">mediaDevices</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">getDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999">().</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {},</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> error</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // æŠ¥é”™</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // getDisplayMedia must be called from a user gesture handler.</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>æ‰€ä»¥æˆ‘ä»¬å¾—é€šè¿‡ä¸€ä¸ªæŒ‰é’®æ¥è§¦å‘è¿™ä¸ªæ“ä½œï¼Œä½†æ˜¯æˆ‘è½¬å¿µä¸€æƒ³ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯åœ¨ç‚¹å‡»æŒ‰é’®ä¹‹åæ‰è¿›è¡Œ <code>getDisplayMedia</code> è°ƒç”¨çš„å•Šã€‚</p><p>è€Œç½‘ä¸Šçš„å¸–å­åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨è¯´éœ€è¦é€šè¿‡äº¤äº’æ¥è§¦å‘ï¼Œè¿™æ—¶å€™å°±é™·å…¥äº†å°´å°¬çš„å¢ƒåœ°ã€‚</p><p>äºæ˜¯æˆ‘æƒ³äº†å¦ä¸€ä¸ªçš„åŠæ³•ï¼Œæˆ‘å†™äº†ä¸€ä¸ªæµ‹è¯•çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç›´æ¥è°ƒç”¨ <code>navigator.mediaDevices.getDisplayMedia</code> ã€‚</p><p>ç„¶ååœ¨ç‚¹å‡»åˆ‡æ¢æˆå½•å±ä¹‹åçš„é€»è¾‘ä¸­çš„å„ä¸ªä½ç½®æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªå‡½æ•°ã€‚</p><p>æµ‹è¯•å‡½æ•°é•¿å¦‚ä¸‹çš„æ ·å­ï¼Œå› ä¸ºæˆ‘ä»¬çš„é¡¹ç›®ç”¨çš„ Vue ï¼Œæ‰€ä»¥ä¸‹é¢ç”¨ Vue çš„å†™æ³•ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  data</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  methods</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    async</span><span style="--s-dark:#80A665;--s-light:#59873A"> testMethod</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">position</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      await</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> navigator</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">mediaDevices</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">getDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999">().</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">success, position: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> position</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> error</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">error</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">error: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> error</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç„¶ååœ¨ä¸»é€»è¾‘ä¸­çš„å„ä¸ªä½ç½®åŠ ä¸Šè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  data</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  methods</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    testMethod</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">position</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    mainMethod</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      await</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">testMethod</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ä¸€äº›æ“ä½œ</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      await</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">testMethod</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">2</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ä¸€äº›æ“ä½œ</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      await</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">testMethod</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">3</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // çœŸæ­£è°ƒç”¨ navigator.mediaDevices.getDisplayMedia çš„åœ°æ–¹</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>æ‰§è¡Œä¹‹åæˆ‘å‘ç°ï¼Œåªæœ‰ç¬¬ä¸€ä¸ª <code>testMethod</code> èƒ½æ‰§è¡ŒæˆåŠŸï¼Œç¬¬äºŒä¸ªå¼€å§‹å°±å‡ºç°ä¸Šé¢è¯´åˆ°çš„é”™è¯¯äº†ã€‚</p><p>æˆ‘åˆæŠŠ <code>this.testMethod(1)</code> å»æ‰ï¼Œç„¶åæ‰§è¡Œï¼Œå‘ç°ç¬¬äºŒä¸ªèƒ½æ‰§è¡ŒæˆåŠŸäº†ï¼Œä½†ç¬¬ä¸‰ä¸ªå°±å¤±è´¥äº†ã€‚</p><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥æ’é™¤æ˜¯æºä»£ç çš„é—®é¢˜ï¼ˆå› ä¸ºæˆ‘ä»¬ä»£ç é‡Œé¢å¼•å…¥äº† owt.js ï¼Œæœ‰äº›æ“ä½œè¿˜æ˜¯åœ¨è¿™ä¸ªåº“å†…éƒ¨æ‰§è¡Œçš„ï¼‰ã€‚</p><p>åˆ°è¿™é‡Œè™½ç„¶å¾—å‡ºä¸æ˜¯ä»£ç å†™æ³•çš„é—®é¢˜ï¼Œä½†æ˜¯æŠ¥é”™ä¾ç„¶æ²¡æœ‰è§£å†³ã€‚</p><p>ç„¶åæˆ‘åˆåœ¨ Google ä¸Šæ‰¾å•Šæ‰¾ï¼Œç„¶åæˆ‘å°±å‘ç°äº†åœ¨è…¾è®¯çš„ QCloud çš„ <a href="https://web.sdk.qcloud.com/trtc/webrtc/doc/zh-cn/tutorial-16-basic-screencast.html" target="_blank" rel="noopener">sdk</a> æ–‡æ¡£é‡Œé¢æ‰¾åˆ°äº†åŸå› ã€‚</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2023/07/13/202307131042440.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2023/07/13/202307131042440.avif" alt=""></a></p><p>åŸæ¥ç”¨æˆ·æ‰‹åŠ¿è¿˜æœ‰ä¸ª 1s çš„é™åˆ¶ï¼Œåœ¨å‚è€ƒé‚£é‡Œè´´äº†ä¸€ä¸ª<a href="https://bugs.webkit.org/show_bug.cgi?id=198040" target="_blank" rel="noopener">é¡µé¢</a>ï¼Œè¿™ä¸ªé¡µé¢æ˜¯ç”¨æ¥æäº¤æµè§ˆå™¨ bug çš„ã€‚</p><p>åœ¨ bug çš„è¯„è®ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸€æ®µã€‚</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2023/07/13/202307131045449.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2023/07/13/202307131045449.avif" alt=""></a></p><p>è‡³æ­¤æˆ‘ä»¬ç¡®å®šäº† 1s é™åˆ¶çš„å‡†ç¡®æ€§ã€‚</p><p>ä¸ºäº†ç¡®è®¤è¿™ä¸ªç‰¹æ€§æ˜¯å­˜åœ¨çš„ï¼Œæˆ‘å†™äº†ä¸€ä¸ªå° demo æ¥æµ‹è¯•ã€‚</p><p>demo çš„å†…å®¹ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªç«‹å³è·å–å½•å±ï¼Œä¸€ä¸ªåœ¨ 1.5s åè·å–å½•å±ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> lang</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> immediate</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> async</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  openDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> delay</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> async</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  await</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#B8A965;--s-light:#998418"> Promise</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span><span style="--s-dark:#666666;--s-light:#999999">&gt;((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      resolve</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1500</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  openDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> openDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> async</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  await</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> navigator</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">mediaDevices</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">getDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      video</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      audio</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">success</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">err</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> err</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    );</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">immediate</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">ç«‹å³æ‰“å¼€å½•å±</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">delay</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">å»¶è¿Ÿä¸€ç§’å½•å±</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡æµ‹è¯•æˆ‘ä»¬å‘ç°ç¡®å®åœ¨å»¶è¿Ÿäº† 1.5s åæ— æ³•æˆåŠŸè°ƒç”¨ <code>getDisplayMedia</code> ã€‚è€Œåœ¨ Chrome ä¸Šæ˜¯æ²¡æœ‰è¿™ä¸ªé™åˆ¶çš„ï¼Œå¹¶ä¸” Chrome ä¹Ÿä¸éœ€è¦æ‰‹åŠ¿æ“ä½œå°±èƒ½æ‹‰èµ·å½•å±é€‰é¡¹ã€‚</p><p>ï¼ˆChrome ä½ çœŸçš„å¤ªæ¸©æŸ”äº†ï¼ï¼‰</p><p>å›åˆ°ç³»ç»Ÿçš„ä»£ç ä¸­ï¼Œåœ¨å®é™…çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜¯æœ‰ä¸€äº›æ“ä½œæ˜¯å¯èƒ½ä¼šé€ æˆæ—¶é—´æ¶ˆè€—çš„ï¼Œç”±äºä½¿ç”¨ await æ¥åŒæ­¥æ“ä½œï¼Œå¯èƒ½å°±ä¼šé€ æˆè°ƒç”¨æ—¶é•¿è¶…è¿‡ 1s å¯¼è‡´çš„è°ƒç”¨å¤±è´¥ã€‚</p><p>äºæ˜¯æˆ‘æƒ³äº†ä¸¤ä¸ªæ–¹æ³•ã€‚</p><ul><li>å»¶è¿Ÿè¿™äº› await çš„æ“ä½œï¼Œä½¿ç”¨ <code>setTimeout</code> æ”¾åˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¸­ï¼Œå°½å¯èƒ½å¿«åœ°æ‰§è¡Œåˆ° <code>getDisplayMedia</code> å‡½æ•°ã€‚</li><li>æå‰è°ƒç”¨ <code>getDisplayMedia</code> æ–¹æ³•ï¼Œå†æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚</li><li>åœ¨è°ƒç”¨ <code>getDisplayMedia</code> ä¹‹å‰å¼¹å‡ºä¸€ä¸ªç¡®è®¤æ¡†ï¼Œç±»ä¼¼é‡æ–°ç”Ÿæˆä¸€ä¸ª 1s èŒƒå›´ï¼Œè¿™æ ·å­ç¡®ä¿ 1s å†…èƒ½è°ƒç”¨åˆ° <code>getDisplayMedia</code> æ–¹æ³•ã€‚</li></ul><p>ç”±äºä¸€äº›æ“ä½œæ˜¯éœ€è¦ç¡®ä¿é¡ºåºæ€§çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ–¹æ³•æ’é™¤äº†ã€‚</p><p>æœ¬æ¥æ˜¯æƒ³ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•çš„ï¼Œä½†æ˜¯é¡¹ç›®ä½¿ç”¨ owt.js çš„å†…ç½® API æ¥è°ƒç”¨ <code>getDisplayMedia</code> æ–¹æ³•çš„ï¼Œæœ¬ç€ä¸ä¿®æ”¹ä¾èµ–åº“æºç çš„åŸåˆ™ä¹Ÿæ”¾å¼ƒäº†ã€‚</p><p>äºæ˜¯æˆ‘ä½¿ç”¨äº†ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼Œä¸ºäº†æœ€å¤§ç¨‹åº¦å‡å°‘å¯¹åŸä»£ç æµç¨‹çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªç®€å•åœ° hack ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> lang</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> usePromise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  let</span><span style="--s-dark:#80A665;--s-light:#59873A"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Function</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#B8A965;--s-light:#998418"> Promise</span><span style="--s-dark:#666666;--s-light:#999999">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">_resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    resolve</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> _resolve</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#CB7676;--s-light:#AB5959">!</span><span style="--s-dark:#666666;--s-light:#999999">];</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> resolve</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">any</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> showOverlay</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4D9375;--s-light:#1E754F">false</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> delay</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> async</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // æ¨¡æ‹Ÿä¸€æ®µè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  await</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new</span><span style="--s-dark:#B8A965;--s-light:#998418"> Promise</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span><span style="--s-dark:#666666;--s-light:#999999">&gt;((</span><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> reject</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      resolve</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1500</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">]</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> usePromise</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  resolve</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  showOverlay</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  await</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  openDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> openDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  navigator</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">mediaDevices</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">getDisplayMedia</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      video</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      audio</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    .</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">success</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">err</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">err</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> err</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    );</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">delay</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">å»¶è¿Ÿä¸€ç§’å½•å±</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      v-show</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">showOverlay</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      style</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        position: fixed;</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        inset: 0;</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        background: #000;</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        display: flex;</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        align-items: center;</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        justify-content: center;</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        color: white;</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">      "</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        resolve?.();</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">        showOverlay = false;</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">      "</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    &gt;</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">      ç‚¹å‡»</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    &lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸‹é¢è¿™æ®µ</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48">promise</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">]</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> usePromise</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">resolve</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">showOverlay</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">await</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> promise</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span></code></pre><p>è¿™æ®µé€»è¾‘å¯ä»¥æ— ç¼æ¤å…¥åˆ°åŸæœ‰çš„é€»è¾‘ä¸­ï¼Œå¹¶ä¸”æ— éœ€æ›´æ”¹ä»»ä½•çš„æµç¨‹ï¼Œåªæ˜¯åœ¨å†™æ³•ä¸Šæœ‰ç‚¹å¥‡è‘©â€¦</p><p>è¿™æ ·åœ¨ Safari ä¸Šå°±èƒ½æˆåŠŸåœ¨å»¶è¿Ÿ 1s åè°ƒç”¨æ–¹æ³•äº†ï¼Œä¸è¿‡è¿™æ ·çš„äº¤äº’ä¸ªäººè€Œè¨€è¿˜æ˜¯æœ‰ç‚¹ä¸‘â€¦</p><p>åŒæ—¶ï¼Œè¿™ä¹Ÿè§£é‡Šäº†å‰é¢æˆ‘ä»¬æ‰€è¯´çš„ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ª <code>testMethod</code> èƒ½æ‰§è¡ŒæˆåŠŸçš„é—®é¢˜ã€‚</p><p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>getDisplayMedia</code> æ—¶ï¼Œæ¥å£è¿”å›äº†ä¸€ä¸ª Promise ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦å»é€‰æ‹©ç‰¹å®šçš„çª—å£ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå¤šæ—¶å€™éƒ½ä¼šè¶…è¿‡ 1s ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº†åé¢çš„ <code>testMethod</code> è°ƒç”¨å¤±è´¥äº†ã€‚</p><h1 id="åè®°" tabindex="-1">åè®° <a class="header-anchor" href="#åè®°">ğŸ”—</a></h1><p>æœ€åè¿™ä¸ªè§£å†³çš„æ–¹æ³•å¹¶æ²¡æœ‰åˆå¹¶åˆ°ä»£ç ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç³»ç»Ÿå°±æ˜¯åªæ”¯æŒ Chrome çš„ã€‚å¹¶ä¸”æµ‹è¯•ä¹Ÿåªæ˜¯åœ¨ Chrome ä¸Šæµ‹è¯•çš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä¹Ÿä¸æ˜ç™½ä¸ºä»€ä¹ˆå®¢æˆ·è¦åœ¨ Safari ä¸Šæµ‹è¯•â€¦</p><p>å°±ç®—è¿™ä¸ª bug ä¿®å¤äº†ï¼Œ Safari ä¾ç„¶ç”¨ä¸äº†ï¼Œå› ä¸º Safari ä¸Šè°ƒç”¨ <code>navigator.mediaDevices.enumerateDevices</code> æ‹¿ä¸åˆ° <code>videooutput</code> ç±»å‹çš„è®¾å¤‡â€¦</p><p>æœç„¶æµè§ˆå™¨è¿˜æ˜¯ Chrome å¥½ï¼Œå®ƒçœŸçš„å¤ªå¼ºå¤§äº†ï¼Œå¤ªè®©äººçœå¿ƒäº†~</p><p>Safari ? çœŸä¸ç†Ÿï¼</p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#Safari</div><div>#getDisplayMedia</div><div>#å½•å±</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/389a9bee078c" class="" truncate="" title="å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ä¸€ä¸ªå¯†ç ï¼ˆè¯‘ï¼‰"><i class="i-mi:chevron-left" mr-1=""></i><span>å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ä¸€ä¸ªå¯†ç ï¼ˆè¯‘ï¼‰</span></a><a href="/2699f069bf8b" class="" ml-auto="" truncate="" title="ä½¿ç”¨ apng-js æ¥æ’­æ”¾ APNG åŠ¨å›¾"><span>ä½¿ç”¨ apng-js æ¥æ’­æ”¾ APNG åŠ¨å›¾</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-f3312cf8="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-f3312cf8=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-f3312cf8=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-f3312cf8=""></i></div><div flex="~ col grow" gap-2="" lg:gap-4="" data-v-f3312cf8=""><textarea disabled="" placeholder="ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç•™ä¸‹è¯„è®ºè¡Œä¸è¡Œ" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" lg:p-4="" data-v-f3312cf8=""></textarea><div flex="" items-start="" data-v-f3312cf8=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-f3312cf8="">æ”¯æŒ Markdown è¯­æ³•</a><div ml-auto="" data-v-f3312cf8=""></div><!----><button class="mujika-button" data-v-f3312cf8="" data-v-15330f5f=""><!--[--><!--]--><!--[-->ç‚¹å‡»ç™»å½•<!--]--></button></div></div></div><!--]--></div></div><!----><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">æ–‡ç« ç›®å½•</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-d1d7a153=""><div flex="" items-center="" data-v-d1d7a153=""><span data-v-d1d7a153="">Power by&nbsp;</span><i class="i-logos:vue" data-v-d1d7a153=""></i><span data-v-d1d7a153="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-d1d7a153=""></i></div><div text-center="" data-v-d1d7a153=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-d1d7a153="">CC BY-NC-SA 4.0 </a>2021 - PRESENT Â© Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-d1d7a153="">å¦‚æœæˆ‘å’Œç‹—ä¸€æ ·æœ‰å°¾å·´çš„è¯ï¼Œä¸€å®šä¼šè—ä¸ä½è¿™ä»½å–œæ‚¦ï¼Œè€Œå°¾å·´ä¸€ç›´æ‘‡ä¸ªä¸åœå§ã€‚</div></footer></div></div></body></html>