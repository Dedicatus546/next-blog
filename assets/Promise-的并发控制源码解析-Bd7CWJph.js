import{createElementBlock as n,openBlock as p,createStaticVNode as t}from"vue";import{c as l}from"./app-BzoAWw-A.js";import"nprogress";import"pinia-plugin-persistedstate";import"vue-router";import"vue-router-better-scroller";import"@vueuse/core";import"@vueuse/components";import"@vueuse/router";import"octokit";import"pinia";import"date-fns";const e={class:"kan-doc"},F="Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ",C=["Promise","å¹¶å‘æ§åˆ¶"],P=["ç¼–ç¨‹"],b=1668677088,v="2022-11-17T17:24:48.000Z",x="2023-02-13T18:28:45.000Z",w=4230,T=[{property:"og:title",content:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ"},{name:"twitter:title",content:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ"}],_={__name:"Promise-çš„å¹¶å‘æ§åˆ¶æºç è§£æ",setup(i,{expose:a}){return a({frontmatter:{title:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ",tags:["Promise","å¹¶å‘æ§åˆ¶"],categories:["ç¼–ç¨‹"],key:1668677088,date:"2022-11-17T17:24:48.000Z",updated:"2023-02-13T18:28:45.000Z",wordCount:4230,meta:[{property:"og:title",content:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ"},{name:"twitter:title",content:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ"}]}}),l({title:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ",meta:[{property:"og:title",content:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ"},{name:"twitter:title",content:"Promise çš„å¹¶å‘æ§åˆ¶æºç è§£æ"}]}),(g,s)=>(p(),n("div",e,s[0]||(s[0]=[t(`<h1 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€">ğŸ”—</a></h1><p><code>Promise</code> çš„å¹¶å‘æ§åˆ¶æºç è§£æï¼Œä¸€çœ‹å°±æ˜¯è€é¢è¯•é¢˜äº†</p><h1 id="æ­£æ–‡" tabindex="-1">æ­£æ–‡ <a class="header-anchor" href="#æ­£æ–‡">ğŸ”—</a></h1><p>ä¸€èˆ¬æˆ‘ä»¬è®²åˆ° <code>Promise</code> çš„å¹¶å‘æ§åˆ¶ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½æ˜¯å’Œ <code>HTTP</code> è¯·æ±‚ç»“åˆèµ·æ¥çš„</p><p>å› ä¸ºæµè§ˆå™¨æ˜¯æœ‰è¿æ¥æ•°é‡é™åˆ¶çš„ï¼Œè¿‡å¤šçš„ <code>HTTP</code> è¯·æ±‚ä¼šå…ˆæŒ‚èµ·ï¼Œç­‰å¾…å…ˆå‰å‘é€çš„è¯·æ±‚å®Œæ¯•ä¹‹åå†å‘é€æŒ‚èµ·çš„è¯·æ±‚</p><p>æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦å ç”¨é¢å¤–çš„å†…å­˜ï¼Œè¿‡å¤šçš„ <code>HTTP</code> è¯·æ±‚æŒ‚èµ·è¿˜å¯èƒ½å¯¼è‡´æµè§ˆå™¨å´©æºƒ</p><p>æ‰€ä»¥ï¼Œåˆç†çš„å‘é€é€Ÿåº¦å°±æ˜¾å¾—æ ¼å¤–çš„é‡è¦</p><p>è¿™æ¬¡ï¼Œæˆ‘ä»¬æ¥å“ä¸€å“ <a href="https://github.com/rxaviers/async-pool" target="_blank" rel="noopener">async-pool</a> è¿™ä¸ªåº“çš„æºä»£ç ï¼Œå®ƒçš„æºä»£ç ï¼Œéå¸¸çš„ç®€æ´ï¼Œå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#4D9375;--s-light:#1E754F;">*</span><span style="--s-dark:#80A665;--s-light:#59873A;"> asyncPool</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iteratorFn</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> executing</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> Set</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">  // æ¶ˆè´¹å…¶ä¸­ä¸€ä¸ª Promise ï¼Œå¹¶ä» executing ä¸­åˆ é™¤è¯¥å®Œæˆçš„ Promise</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> consume</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const</span><span style="--s-dark:#666666;--s-light:#999999;"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">]</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">race</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">executing</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">delete</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    return</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  for</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> item</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> of</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> promise</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#666666;--s-light:#999999;"> ()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> iteratorFn</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">item</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">))().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">      value</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">]</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    );</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">add</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">size</span><span style="--s-dark:#666666;--s-light:#999999;"> &gt;=</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">      yield</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> consume</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  while</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">size</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    yield</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> consume</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">module</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#B8A965;--s-light:#998418;">exports</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> asyncPool</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span></code></pre><p>è¿™é‡Œé¢æ ¸å¿ƒçš„åœ°æ–¹æœ‰ä¸‰ä¸ªï¼Œå…¶ä¸€ä¸ªæ˜¯ <code>Promise.race</code> è¿™ä¸ª api</p><p>å…¶äºŒæ˜¯ <code>for</code> å¾ªç¯ä¸­çš„æ ¹æ® <code>executing.size &gt;= concurrency</code> åˆ¤æ–­æ¥ <code>consume</code> æ‰å·²å®Œæˆçš„ <code>Promise</code></p><p>å…¶ä¸‰æ˜¯å¦‚æœâ€œæ± å­ä¸­â€ <code>Promise</code> æ²¡æœ‰è¾¾åˆ°ä¸Šé™ï¼Œåˆ™éœ€è¦ä¾æ¬¡ <code>consume</code> ï¼Œæ­¤æ—¶å’Œé™æµå°±æ— å…³äº†</p><p><code>Promise.race</code> ä¸‹ï¼Œå¦‚æœæŸä¸ª <code>Promise</code> å·²å®Œæˆæˆ–å¤±è´¥ï¼Œé‚£ä¹ˆè¿”å›çš„ <code>Promise</code> å°±ä¼šå¯¹åº”çš„å®Œæˆæˆ–è€…å¤±è´¥</p><p>å¯¹åº”åˆ°ä»£ç†é‡Œé¢çš„ <code>consume</code> å‡½æ•°ï¼Œå³æ¯æ¬¡æˆ‘ä»¬éƒ½ä» <code>executing</code> ä¸­å–ä¸€ä¸ªå·²å®Œæˆ <code>Promise</code> ï¼Œç„¶åæŠŠè¯¥ <code>Promise</code> ä» <code>executing</code> ä¸­åˆ é™¤ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡è°ƒç”¨ <code>consume</code> å°±ä¼šç»§ç»­</p><p>åœ¨ <code>for</code> å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¯¹ä¼ å…¥çš„ <code>Promise</code>ï¼Œ å¯¹å…¶è¿”å›çš„ç»“æœä¹Ÿè¿›è¡Œäº†åŒ…è£…</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">for</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> item</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> of</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> promise</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#666666;--s-light:#999999;"> ()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> iteratorFn</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">item</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">))().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    value</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">]</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  );</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>è¿™é‡Œæ˜¯ä¸ºäº†è®°ä½å½“å‰çš„ <code>Promise</code> å¯¹è±¡ï¼Œè¿™æ ·åœ¨ <code>consume</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°±èƒ½åˆ é™¤è¿™ä¸ªæŠŠè¿™ä¸ªå·²å®Œæˆçš„ <code>Promise</code> ä» <code>executing</code> ä¸­åˆ é™¤</p><p>å¯¹äºæœ€åçš„ <code>while</code> å¾ªç¯ï¼Œå½“â€œæ± å­â€ä¸­çš„ <code>Promise</code> æ•°é‡å·²ç»å°äºæˆ‘ä»¬æŒ‡å®šçš„æ•°é‡æ—¶ï¼Œé‚£ä¹ˆå¯ä»¥æ˜ç¡® <code>for</code> å†…éƒ¨çš„ <code>yield await consume()</code> å°±ä¸ä¼šæ‰§è¡Œåˆ°</p><p>ä½†æ˜¯å‰©ä¸‹çš„ <code>Promise</code> æˆ‘ä»¬åˆä¸èƒ½ä¸å» <code>consume</code> è¿›è€Œè·å–ç»“æœï¼ˆå› ä¸ºè¿™ä¸ª <code>asyncPool</code> è¿™ä¸ªå‡½æ•°æ˜¯è¦è·å–ç»“æœè¿”å›çš„ï¼‰</p><p>æ‰€ä»¥æœ€åæˆ‘ä»¬éœ€è¦æŠŠâ€œæ± å­â€é‡Œçš„ <code>Promise</code> éƒ½ <code>consume</code> æ‰ï¼Œè¿™æ ·ä¼ å…¥çš„æ‰€æœ‰ <code>Promise</code> éƒ½èƒ½æ­£ç¡®çš„è¢«è¿”å›</p><p>å½“ç„¶ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯æ¯”è¾ƒæ–°çš„è¯­æ³•ï¼Œæ¯”å¦‚ <code>async/await</code> å…³é”®å­—ï¼Œä»¥åŠç”Ÿæˆå™¨å‡½æ•°</p><p>å›åˆ°ä½¿ç”¨ä¸Šï¼Œå®˜æ–¹ç»™äº†æˆ‘ä»¬ä¸€ä¸ªå°ä¾‹å­ï¼Œå¦‚ä¸‹</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/11/17/202211171628242.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/11/17/202211171628242.avif" alt=""></a></p><p>å¯ä»¥å‘ç°ï¼Œå®ƒçš„ä¼ å‚æ˜¯æ ¹æ®å‚æ•°ä¸åŒæ¥ç”Ÿæˆä¸åŒçš„ <code>Promise</code> çš„ï¼Œä½†å®é™…ä¸Šï¼Œç”Ÿæˆçš„ <code>Promise</code> å¹¶ä¸æ˜¯è¿™ä¹ˆç®€å•çš„</p><p>æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠ çµæ´»çš„å‚æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„è°ƒç”¨</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">myAsyncPool</span><span style="--s-dark:#666666;--s-light:#999999;">(</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">  // æŒ‡å®šæœ€å¤§å¹¶å‘ä¸ªæ•°</span></span>
<span class="line"><span style="--s-dark:#4C9A91;--s-light:#2F798A;">  3</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">  // æ¯ä¸ªå¼‚æ­¥çš„å·¥å‚å‡½æ•°</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  [</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    ()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> axios</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">get</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&quot;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">/abc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&quot;</span><span style="--s-dark:#666666;--s-light:#999999;">),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    ()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> axios</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">delete</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&quot;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">/a</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&quot;</span><span style="--s-dark:#666666;--s-light:#999999;">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  ]</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">)</span></span></code></pre><p>ä¸ºäº†è¾¾æˆä¸Šé¢çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æºä»£ç è¿›è¡Œç®€å•åœ°ä¿®æ”¹ï¼Œä¿®æ”¹åå¦‚ä¸‹</p><p>è¿™é‡Œç”¨äº†ç‚¹ <code>ts</code> æ³›å‹ï¼Œæ•´ä½“å¤§æ¡†æ¶å’Œæºç ä¿æŒä¸å˜</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#4D9375;--s-light:#1E754F;">*</span><span style="--s-dark:#80A665;--s-light:#59873A;"> asyncPool</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">T</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">  concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">number</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">  iterable</span><span style="--s-dark:#666666;--s-light:#999999;">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Iterable</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;() =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Promise</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">T</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;"> WrapperPromise</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;[</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">WrapperPromise</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;"> T</span><span style="--s-dark:#666666;--s-light:#999999;">]&gt;;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48;">executing</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new </span><span style="--s-dark:#80A665;--s-light:#59873A;">Set</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">WrapperPromise</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;();</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> consume</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const </span><span style="--s-dark:#666666;--s-light:#999999;">[</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">]</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">race</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">executing</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">delete</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    return</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  for</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48;">item</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> of</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const </span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#80A665;--s-light:#59873A;"> item</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> val</span><span style="--s-dark:#666666;--s-light:#999999;">])</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> as</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;"> WrapperPromise</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">add</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">size</span><span style="--s-dark:#666666;--s-light:#999999;"> &gt;=</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">      yield</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> consume</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  while</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">executing</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">size</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    yield</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> consume</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>çœ‹èµ·æ¥å¾ˆä¸é”™ï¼Œä¸è¿‡è¿™è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼Œæ¯”å¦‚æˆ‘ä»¬æ— æ³•ä¸€æ¬¡æ€§çš„ä¼ å…¥æ‰€æœ‰çš„å¼‚æ­¥å·¥å‚å‡½æ•°</p><p>å³æˆ‘ä»¬éœ€è¦åˆ†ç¦»åˆ›å»ºâ€œæ± å­â€å’Œå¾€â€œæ± å­â€æ”¾å¼‚æ­¥å‡½æ•°è¿™ä¸¤ä¸ªæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ ¸å¿ƒé€»è¾‘å†™å‡ºä¸‹é¢çš„ä»£ç </p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> class</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;"> AsyncPool</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">T</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  private</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">number</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  private</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> running</span><span style="--s-dark:#666666;--s-light:#999999;">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Set</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Promise</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">T</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;&gt;;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  private</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> waiting</span><span style="--s-dark:#666666;--s-light:#999999;">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Array</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;() =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Promise</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">T</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  constructor</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">number</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Iterable</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;() =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Promise</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">T</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;&gt;)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">    this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">concurrency</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">    this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">running</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> Set</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">    this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">waiting</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#666666;--s-light:#999999;"> [];</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    for</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48;">item</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> of</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> iterable</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">      this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">add</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">item</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">  add</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#80A665;--s-light:#59873A;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">Promise</span><span style="--s-dark:#666666;--s-light:#999999;">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82;">T</span><span style="--s-dark:#666666;--s-light:#999999;">&gt;)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B;">this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">running</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">size</span><span style="--s-dark:#666666;--s-light:#999999;"> &lt;</span><span style="--s-dark:#C99076;--s-light:#A65E2B;"> this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">concurrency</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">      const </span><span style="--s-dark:#BD976A;--s-light:#B07D48;">p</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#80A665;--s-light:#59873A;"> promise</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">        this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">running</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">delete</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">p</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">        while</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">          this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">running</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">size</span><span style="--s-dark:#666666;--s-light:#999999;"> &lt;</span><span style="--s-dark:#C99076;--s-light:#A65E2B;"> this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">concurrency</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> &amp;&amp;</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">          this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">waiting</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#B8A965;--s-light:#998418;">length</span><span style="--s-dark:#666666;--s-light:#999999;"> &gt;</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 0</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">        )</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">          const </span><span style="--s-dark:#BD976A;--s-light:#B07D48;">waitPromiseFactory</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#C99076;--s-light:#A65E2B;"> this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">waiting</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">shift</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">!</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">          this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">add</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">waitPromiseFactory</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">        }</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">        return</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> val</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      });</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">      this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">running</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">add</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">p</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    }</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> else</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B;">      this</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">waiting</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">push</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">promise</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ± å­æ¥è¡¨ç¤ºï¼Œä¸€ä¸ªæ˜¯æ­£åœ¨æ‰§è¡Œçš„â€œæ± å­â€ï¼Œä¸€ä¸ªæ˜¯ç­‰å¾…ä¸­çš„â€œæ± å­â€</p><p>æ¯æ¬¡æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª <code>Promise</code> æ—¶ï¼Œå¦‚æœæ­¤æ—¶æ­£åœ¨æ‰§è¡Œçš„â€œæ± å­â€è¿˜æœ‰ä½ç½®ï¼Œé‚£ä¹ˆç›´æ¥æ”¾å…¥æ‰§è¡Œå³å¯</p><p>å¦‚æœæ­¤æ—¶æ­£åœ¨æ‰§è¡Œçš„æ± å­æ²¡ä½ç½®äº†ï¼Œæˆ‘ä»¬å°±å…ˆæ”¾å…¥ç­‰å¾…æ± å­ä¸­</p><p>å½“æ­£åœ¨æ‰§è¡Œçš„â€œæ± å­â€ä¸­æŸä¸€ä¸ª <code>Promise</code> æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤æ‰§è¡Œâ€œæ± å­â€ä¸­å¯¹åº”çš„ <code>Promise</code></p><p>ç„¶åæˆ‘ä»¬éœ€è¦åˆ¤æ–­ï¼Œå¦‚æœæ­¤æ—¶ç­‰å¾…â€œæ± å­â€ä¸­æœ‰æœªå¤„ç†çš„ <code>Promise</code> ï¼Œé‚£ä¹ˆå°±å¯ä»¥åŠ å…¥æ‰§è¡Œâ€œæ± å­â€ä¸­å¼€å§‹æ‰§è¡Œ</p><p>å’Œä¸Šé¢ç‰ˆæœ¬å¯¹æ¯”çš„è¯ï¼Œç¼ºç‚¹å°±æ˜¯æ²¡æ³•ä½¿ç”¨ <code>for await</code> äº†ï¼Œé€‚åˆé›¶æ•£çš„ <code>Promise</code> çš„å¹¶å‘æ§åˆ¶</p>`,38)])))}};export{P as categories,v as date,_ as default,b as key,T as meta,C as tags,F as title,x as updated,w as wordCount};
