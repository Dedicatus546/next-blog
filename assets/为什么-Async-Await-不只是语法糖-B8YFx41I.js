import{createElementBlock as n,openBlock as l,createStaticVNode as t}from"vue";import{c as p}from"./app-kEKefLn2.js";import"nprogress";import"pinia-plugin-persistedstate";import"vue-router";import"vue-router-better-scroller";import"@vueuse/core";import"@vueuse/components";import"@vueuse/router";import"octokit";import"pinia";import"date-fns";const e={class:"kan-doc"},w="ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–",C=["JavaScript","Async/Await","Promise"],b=["è¯‘æ–‡"],E=1677484217,P="2023-02-27T15:50:17.000Z",F="2023-02-27T15:50:17.000Z",_=8052,x=[{property:"og:title",content:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–"},{name:"twitter:title",content:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–"}],S={__name:"ä¸ºä»€ä¹ˆ-Async-Await-ä¸åªæ˜¯è¯­æ³•ç³–",setup(i,{expose:a}){return a({frontmatter:{title:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–",tags:["JavaScript","Async/Await","Promise"],categories:["è¯‘æ–‡"],key:1677484217,date:"2023-02-27T15:50:17.000Z",updated:"2023-02-27T15:50:17.000Z",wordCount:8052,meta:[{property:"og:title",content:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–"},{name:"twitter:title",content:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–"}]}}),p({title:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–",meta:[{property:"og:title",content:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–"},{name:"twitter:title",content:"ä¸ºä»€ä¹ˆ Async/Await ä¸åªæ˜¯è¯­æ³•ç³–"}]}),(h,s)=>(l(),n("div",e,s[0]||(s[0]=[t(`<h1 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€">ğŸ”—</a></h1><p>åŸæ–‡åœ°å€ï¼š<a href="https://www.zhenghao.io/posts/await-vs-promise" target="_blank" rel="noopener">Why Async/Await Is More Than Just Syntactic Sugar</a></p><h1 id="æ­£æ–‡" tabindex="-1">æ­£æ–‡ <a class="header-anchor" href="#æ­£æ–‡">ğŸ”—</a></h1><p>æœ¬æ–‡ä¸»è¦æ˜¯æˆ‘å¯¹ async/await å¯¹æ¯” Promise çš„ä¸€äº›è§è§£ã€‚</p><p>å°½ç®¡ç½‘ç»œä¸Šå·²ç»å­˜åœ¨äº†è®¸è®¸å¤šå¤šçš„å…³äº <code>async/await</code> å¯¹æ¯” <code>Promise</code> çš„æ–‡ç« ï¼Œä½†æ˜¯éƒ½æœ‰å¾ˆå¤šå€¼å¾—æ”¹è¿›çš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘å°±è‡ªå·±å†™äº†ä¸€ç¯‡ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å…³æ³¨çš„ç‚¹æ˜¯ <code>async/await</code> ä¸ä»…ä»…æ˜¯ <code>Promise</code> ä¹‹ä¸Šçš„è¯­æ³•ç³–ï¼Œå› ä¸º <code>async/await</code> ç¡®å®æä¾›äº†æ˜¾è‘—çš„å¥½å¤„ã€‚</p><ul><li><code>async/await</code> å…è®¸æˆ‘ä»¬å»ä½¿ç”¨é‚£äº›åœ¨åŒæ­¥ç¨‹åºä¸­å¯ç”¨çš„æ‰€æœ‰çš„è¯­æ³•ï¼Œä»è€Œæˆ‘ä»¬èƒ½å†™å‡ºæ›´åŠ æœ‰è¡¨ç°åŠ›å’Œæ›´åŠ å¯è¯»çš„ä»£ç ã€‚</li><li><code>async/await</code> ç»Ÿä¸€äº†å¼‚æ­¥ç¼–ç¨‹çš„ç»éªŒã€‚</li><li><code>async/await</code> æä¾›äº†æ›´å¥½çš„é”™è¯¯å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚</li></ul><blockquote><p>è¿™ç¯‡æ–‡ç« å‡å®šè¯»è€…æœ‰å…³äº <code>Promise</code> å’Œ <code>async/await</code> çš„åŸºç¡€çŸ¥è¯†ã€‚æœ¬æ–‡å¹¶ä¸æ˜¯ç±»ä¼¼ <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous" target="_blank" rel="noopener">MDN</a> å’Œ <a href="https://javascript.info/promise-basics" target="_blank" rel="noopener">javascript.info</a> çš„åŸºç¡€æ•™ç¨‹ã€‚</p></blockquote><h2 id="åœ¨-javascript-ä¸­å…³äºå¼‚æ­¥ç¼–ç¨‹çš„ä¸€å°éƒ¨åˆ†å†å²" tabindex="-1">åœ¨ JavaScript ä¸­å…³äºå¼‚æ­¥ç¼–ç¨‹çš„ä¸€å°éƒ¨åˆ†å†å² <a class="header-anchor" href="#åœ¨-javascript-ä¸­å…³äºå¼‚æ­¥ç¼–ç¨‹çš„ä¸€å°éƒ¨åˆ†å†å²">ğŸ”—</a></h2><p>å¼‚æ­¥ç¼–ç¨‹åœ¨ JavaScript ä¸­å¾ˆå¸¸è§ã€‚æ¯å½“æˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€ä¸ª web æœåŠ¡ï¼Œæˆ–è€…è¿›è¡Œæ–‡ä»¶è®¿é—®ï¼Œæˆ–è€…è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œå°½ç®¡è¯­è¨€æœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯å¼‚æ­¥ç‰¹æ€§å´èƒ½å¤Ÿè®©æˆ‘ä»¬é˜²æ­¢ UI è¢«é˜»å¡ã€‚</p><p>åœ¨ ES2015ï¼ˆES6ï¼‰ å¯¹ JavaScript è¿›è¡Œé‡å¤§å‡çº§ä¹‹å‰ï¼Œè§£å†³å¼‚æ­¥ç¼–ç¨‹çš„æ–¹å¼æ˜¯å›è°ƒã€‚æˆ‘ä»¬è¡¨è¾¾æ—¶é—´ä¾èµ–ï¼ˆå³å¼‚æ­¥æ“ä½œçš„æ‰§è¡Œé¡ºåºï¼‰çš„å”¯ä¸€æ–¹æ³•æ˜¯å°†ä¸€ä¸ªå›è°ƒåµŒå¥—åœ¨å¦ä¸€ä¸ªå›è°ƒä¸­ã€‚è¿™ä¼šå¯¼è‡´æ‰€è°“çš„<a href="http://callbackhell.com/" target="_blank" rel="noopener">å›è°ƒåœ°ç‹±</a>ã€‚</p><blockquote><p>reddit ä¸Šçš„ä¸€ä½ç”¨æˆ· <a href="https://www.reddit.com/r/javascript/comments/wmpdsu/comment/ik2cnoh/?utm_source=share&amp;utm_medium=web2x&amp;context=3" target="_blank" rel="noopener">@theQuandary</a> æŒ‡å‡ºï¼Œåœ¨ ES6 ä¹‹å‰ï¼Œåœ¨ JavaScript ä¸­å¼‚æ­¥ç¼–ç¨‹æœ‰æ¯”å›è°ƒæ›´å¥½çš„å…¶ä»–å¯é€‰æ‹©çš„æ–¹å¼ã€‚å¾ˆæŠ±æ­‰è¿™é‡Œä¸æ˜¯ 100% ç¡®å®šï¼Œå› ä¸ºæˆ‘æ²¡æœ‰äº²è‡ªç»å†è¿‡è¿™æ®µå†å²ã€‚</p></blockquote><p>åœ¨ ES2015ï¼Œ JavaScript å¼•å…¥äº† <code>Promise</code> ã€‚å¯¹äºå¼‚æ­¥æ“ä½œæ¥è¯´å®ƒæ˜¯æœ€ä¼˜çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨å®ƒæ¥è¿›è¡Œä¼ é€’ï¼Œç»„åˆï¼Œèšåˆä»¥åŠåº”ç”¨å˜æ¢æ“ä½œã€‚æ—¶é—´ä¾èµ–ä¹Ÿå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨ <code>then</code> æ–¹æ³•æ¥æ¸…æ™°åœ°è¡¨è¾¾ã€‚</p><p>{% details æ›´å¤šå†å²â€¦ %} åœ¨ JavaScript ä¸­å¼•å…¥ <code>Promise</code> çš„ç‚¹å­å¹¶ä¸æ˜¯ç‹¬åˆ›çš„ã€‚å®ƒæ˜¯å—åˆ°ä¸€ä¸ªå¹´ä»£éå¸¸ä¹…è¿œçš„è¯­è¨€â€”â€” <a href="http://wiki.erights.org/wiki/Promise" target="_blank" rel="noopener">E è¯­è¨€</a>æ‰€å¯å‘çš„ã€‚ E è¯­è¨€çš„åˆ›é€ è€… <a href="https://twitter.com/marksammiller" target="_blank" rel="noopener">Mark Miller</a> ä¹Ÿæ˜¯ <a href="https://tc39wiki.calculist.org/about/people/" target="_blank" rel="noopener">TC39 çš„æˆå‘˜</a>ã€‚ <code>async/await</code> è¯­æ³•ä¹Ÿå€Ÿé‰´äº† <a href="https://docs.microsoft.com/en-us/dotnet/csharp/async" target="_blank" rel="noopener">C#</a> ã€‚ {% enddetails %}</p><p>éšç€ <code>Promise</code> æˆä¸ºä¸€ä¸ªå¼ºå¤§çš„åŸå§‹å¯¹è±¡ï¼Œè¿™ä¼¼ä¹æ„å‘³ç€åœ¨ JavaScript ä¸­å¼‚æ­¥ç¼–ç¨‹å·²ç»è¢«è§£å†³äº†ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿ</p><p>è¿™ä¸ä¸€å®šï¼Œå› ä¸ºæœ‰äº›æ—¶å€™ä½¿ç”¨ <code>Promise</code> ä¼šè®©ä»£ç çœ‹èµ·æ¥å¾ˆä½çº§</p><h2 id="æœ‰äº›æ—¶å€™ä½¿ç”¨-promise-ä¼šè®©ä»£ç çœ‹èµ·æ¥å¾ˆä½çº§" tabindex="-1">æœ‰äº›æ—¶å€™ä½¿ç”¨ Promise ä¼šè®©ä»£ç çœ‹èµ·æ¥å¾ˆä½çº§ <a class="header-anchor" href="#æœ‰äº›æ—¶å€™ä½¿ç”¨-promise-ä¼šè®©ä»£ç çœ‹èµ·æ¥å¾ˆä½çº§">ğŸ”—</a></h2><p>å°½ç®¡ Promise æœ‰ä¼˜ç‚¹ï¼Œä½†æ˜¯åœ¨ JavaScript ä¸­éœ€è¦ä¸€ä¸ªæ›´åŠ é«˜çº§çš„è¯­æ³•æ¥å¤„ç†å¼‚æ­¥ç¼–ç¨‹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦‚ä¸‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥å»¶è¿Ÿçš„è½®è¯¢æŸä¸ªæ¥å£ã€‚å¦‚æœè½®è¯¢æ¬¡æ•°è¾¾åˆ°ç»™å®šæœ€å¤§å€¼ï¼Œé‚£ä¹ˆä»¥ <code>null</code> å€¼æ¥è§£å†³ï¼ˆresolveï¼‰è¿™ä¸ª Promise å¯¹è±¡</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>Promise</code> çš„å¯èƒ½çš„è§£å†³æ–¹æ³•</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> count</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 0</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> apiCall</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">    // é‡è¯•åˆ°ç¬¬å…­æ¬¡æ—¶ï¼Œç”¨å­—ç¬¦ä¸² &#39;value&#39; æ¥è§£å†³è¿™ä¸ª Promise</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    count</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">++</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> ===</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 5</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> ?</span><span style="--s-dark:#80A665;--s-light:#59873A;"> resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> :</span><span style="--s-dark:#80A665;--s-light:#59873A;"> resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">null</span><span style="--s-dark:#666666;--s-light:#999999;">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  );</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> sleep</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">interval</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#80A665;--s-light:#59873A;"> setTimeout</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> poll</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">    // ä¸ºäº†ç®€æ´ï¼Œè¿™é‡Œè·³è¿‡å¯¹é”™è¯¯çš„å¤„ç†</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> ===</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 0</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#80A665;--s-light:#59873A;"> resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">null</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">    apiCall</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">      if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> !==</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> null</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#80A665;--s-light:#59873A;"> resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">      else</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        sleep</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">interval</span><span style="--s-dark:#666666;--s-light:#999999;">).</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">          resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#80A665;--s-light:#59873A;">poll</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> -</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 1</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">));</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">        });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">poll</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;">6</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 1000</span><span style="--s-dark:#666666;--s-light:#999999;">).</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">console</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">log</span><span style="--s-dark:#666666;--s-light:#999999;">);</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // è¾“å‡º &#39;value&#39;</span></span></code></pre><p>è¿™æ®µé€»è¾‘çš„ç›´è§‰æ€§å’Œå¯è¯»æ€§å–å†³äºé˜…è¯»åˆ°è¯¥æ®µä»£ç çš„äººå¯¹ <code>Promise</code> çš„ç†Ÿç»ƒç¨‹åº¦ï¼Œéœ€è¦æ˜ç™½ <code>Promise.prototype.resolve</code> æ˜¯å¦‚ä½•â€œæ‰å¹³åŒ–â€ <code>Promise</code> ä»¥åŠæ˜ç™½é€’å½’è°ƒç”¨è¿‡ç¨‹ã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œå†™å‡ºè¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„å¯è¯»æ€§å¹¶ä¸æ˜¯æœ€å¥½çš„ã€‚</p><p>{% details å¯ä»¥é€šè¿‡ <code>setInterval</code> æ¥å®ç° %}</p><p>å‡½æ•°å‡ ä¹éƒ½å¯ä»¥ä»¥å¦ä¸€ç§æ–¹å¼æ¥ç¼–å†™ã€‚è¿™æ˜¯æˆ‘çš„ä¸€ä¸ªæœ‹å‹ <a href="https://twitter.com/jrsinclair" target="_blank" rel="noopener">James</a> ç¼–å†™çš„ä½¿ç”¨äº† <code>setInterval</code> çš„æ–¹å¼ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">const</span><span style="--s-dark:#80A665;--s-light:#59873A;"> pollInterval</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    let</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> intervalToken</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> timeoutToken</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    intervalToken</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#80A665;--s-light:#59873A;"> setInterval</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#666666;--s-light:#999999;"> ()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">      const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> result</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> apiCall</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">      if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">result</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> !==</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> null</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        clearInterval</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">intervalToken</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        clearTimeout</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">timeoutToken</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">result</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    },</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    timeoutToken</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#80A665;--s-light:#59873A;"> setTimeout</span><span style="--s-dark:#666666;--s-light:#999999;">(()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">      clearInterval</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">intervalToken</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">      resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">null</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    },</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> retry</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> *</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">};</span></span></code></pre><p>{% enddetails %}</p><h2 id="å¼•å…¥-async-await" tabindex="-1">å¼•å…¥ async/await <a class="header-anchor" href="#å¼•å…¥-async-await">ğŸ”—</a></h2><p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>async/await</code> è¯­æ³•æ¥é‡å†™ä¸Šé¢çš„å‡½æ•°</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> poll</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  while</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#666666;--s-light:#999999;"> &gt;=</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 0</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> apiCall</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">catch</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">e</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {});</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // ä¸ºäº†ç®€æ´è·³è¿‡é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> !==</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> null</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> return</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> sleep</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">interval</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    retry</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">--</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> null</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>æˆ‘æƒ³å¾ˆå¤šäººä¼šè§‰å¾—ä¸Šé¢çš„ä»£ç å¯è¯»æ€§æ›´é«˜ï¼Œå› ä¸ºæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æ‰€æœ‰çš„å¸¸è§çš„è¯­æ³•æ¥å¤„ç†å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚å¾ªç¯ã€ <code>try-catch</code> ã€‚</p><p>{% details é€’å½’æ–¹å¼ %} ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„è‹¹æœä¸è‹¹æœçš„æ¯”è¾ƒï¼Œå› ä¸ºæˆ‘é€‰æ‹©äº†ä¸€ä¸ªé€’å½’è§£æ³•æ¥å¯¹æ¯”è¿­ä»£è§£æ³•ã€‚æˆ‘ä»¬å¯ä»¥ç”¨é€’å½’é‡å†™ä¸Šé¢çš„ä»£ç ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">const</span><span style="--s-dark:#80A665;--s-light:#59873A;"> pollAsyncAwait</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> async</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#666666;--s-light:#999999;"> &lt;</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 0</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> return</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> null</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> apiCall</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">catch</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">e</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {});</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // ä¸ºäº†ç®€æ´è·³è¿‡é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> !==</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> null</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> return</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> value</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> sleep</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">interval</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    return</span><span style="--s-dark:#80A665;--s-light:#59873A;"> pollAsyncAwait</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">retry</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> -</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 1</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> interval</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">};</span></span></code></pre><p>{% enddetails %}</p><p>è¿™å¯èƒ½å°±æ˜¯ <code>async/await</code> çš„æœ€å¤§å–ç‚¹ - å…è®¸ä½ ä»¥çœ‹èµ·æ¥åŒæ­¥çš„æ–¹å¼æ¥ç¼–å†™å¼‚æ­¥ä»£ç ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯å¯¹ <code>async/await</code> æœ€å¸¸è§çš„åå¯¹æ„è§ï¼Œå…³äºè¿™ä¸ªè¯é¢˜ï¼Œä¹‹åä¼šèŠåˆ°ã€‚</p><p>é¡ºå¸¦ä¸€æï¼Œ <code>await</code> ç”šè‡³æœ‰æ­£ç¡®çš„<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence" target="_blank" rel="noopener">è¿ç®—ç¬¦ä¼˜å…ˆçº§</a>ï¼Œè¿™æ„å‘³ç€ <code>await a + await b</code> è¡¨ç¤º <code>(await a) + (await b)</code> ï¼Œè€Œä¸æ˜¯ <code>await (a + await b)</code> ã€‚</p><h2 id="async-await-å¯¹åŒæ­¥å’Œå¼‚æ­¥ä»£ç éƒ½æä¾›äº†ç»Ÿä¸€çš„ç»éªŒ" tabindex="-1">async/await å¯¹åŒæ­¥å’Œå¼‚æ­¥ä»£ç éƒ½æä¾›äº†ç»Ÿä¸€çš„ç»éªŒ <a class="header-anchor" href="#async-await-å¯¹åŒæ­¥å’Œå¼‚æ­¥ä»£ç éƒ½æä¾›äº†ç»Ÿä¸€çš„ç»éªŒ">ğŸ”—</a></h2><p>å¦ä¸€ä¸ª <code>async/await</code> çš„ä¼˜ç‚¹æ˜¯ <code>await</code> ä¼šè‡ªåŠ¨åœ°æŠŠä»»ä½•é <code>Promise</code> ï¼ˆå³æ²¡æœ‰ <code>thenable</code> æ¥å£ï¼‰å¯¹è±¡ åŒ…è£…æˆ <code>Promise</code> ã€‚ è¯­ä¹‰ä¸Š <code>await</code> ç›¸å½“äº <code>Promise.resolve</code> ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ <code>await</code> ä»»ä½•ä¸œè¥¿</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> fetchValue</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 1</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> fn</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> val</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> fetchValue</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">  console</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">log</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">);</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // 1</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">// ğŸ‘† ä¸Šé¢çš„ä»£ç ç›¸å½“äºä¸‹é¢çš„ä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> fn</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">  Promise</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#80A665;--s-light:#59873A;">fetchValue</span><span style="--s-dark:#666666;--s-light:#999999;">()).</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    console</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">log</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">);</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // 1</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>{% details æ³¨æ„è¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç›¸å…³çš„è¡Œä¸ºâ€¦ %} æŠŠ <code>await foo</code> å’Œ <code>Promise.resolve(foo).then(...)</code> ç”»ä¸Šç­‰å·å¹¶ä¸æ˜¯ 100% æ­£ç¡®çš„ã€‚</p><p>åœ¨ Chrome 73 ä¹‹å‰ï¼Œ ECMA è§„èŒƒæŠŠ <code>await foo</code> è½¬åŒ–ä¸º <code>new Promise(resolve =&gt; resolve(p))</code> ã€‚ä¹‹ååœ¨è¿™ä¸ª <a href="https://github.com/tc39/ecma262/pull/1250" target="_blank" rel="noopener">PR</a> é‡Œä¿®æ”¹äº†è§„èŒƒé‡Œçš„ä¸€å¤„åœ°æ–¹ã€‚ä½†æ˜¯ç›´åˆ°ç°åœ¨ï¼Œä¸æ˜¯æ¯ä¸ªæµè§ˆå™¨éƒ½éµå®ˆè§„èŒƒä¸­çš„æ”¹å˜ï¼›æˆªè‡³æœ¬æ–‡ç¼–å†™ä¹‹æ—¥ï¼Œ Safari ä¾ç„¶æ²¡æœ‰å®ç°æ›´æ–°è¿‡åçš„è§„èŒƒã€‚ç»“æœå°±æ˜¯ï¼Œåœ¨ Safari å’Œ Chrome åˆ†åˆ«æ‰§è¡Œ<a href="https://gist.github.com/zhenghaohe/c90ec960b890eca60b7bd8008f856a70" target="_blank" rel="noopener">è¿™æ®µä»£ç æ®µ</a>ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚ {% enddetails %}</p><p>å¦‚æœæˆ‘ä»¬ç›´æ¥è°ƒç”¨ <code>fetchValue</code> è¿”å›çš„æ•°å­— <code>1</code> çš„ <code>then</code> æ–¹æ³•ï¼Œå°±ä¼šäº§ç”Ÿå¦‚ä¸‹é”™è¯¯ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> fetchValue</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#4C9A91;--s-light:#2F798A;"> 1</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> fn</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">  fetchValue</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    console</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">log</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">val</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">fn</span><span style="--s-dark:#666666;--s-light:#999999;">();</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // âŒ Uncaught TypeError: fetchValue(...).then is not a function</span></span></code></pre><p>æœ€ç»ˆï¼Œ<code>async</code> å‡½æ•°è¿”å›çš„ä»»ä½•ä¸œè¥¿éƒ½æ€»æ˜¯æ˜¯ä¸€ä¸ª <code>Promise</code> ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">Object</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#B8A965;--s-light:#998418;">prototype</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">toString</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">call</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#666666;--s-light:#999999;"> ()</span><span style="--s-dark:#666666;--s-light:#999999;"> {})());</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // &#39;[object Promise]&#39;</span></span></code></pre><h2 id="async-await-æä¾›äº†æ›´å¥½çš„é”™è¯¯å †æ ˆè·Ÿè¸ª" tabindex="-1">async/await æä¾›äº†æ›´å¥½çš„é”™è¯¯å †æ ˆè·Ÿè¸ª <a class="header-anchor" href="#async-await-æä¾›äº†æ›´å¥½çš„é”™è¯¯å †æ ˆè·Ÿè¸ª">ğŸ”—</a></h2><p>V8 å·¥ç¨‹å¸ˆ <a href="https://twitter.com/mathias" target="_blank" rel="noopener">Mathias</a> å†™äº†ä¸€ç¯‡ <a href="https://mathiasbynens.be/notes/async-stack-traces" target="_blank" rel="noopener">å¼‚æ­¥å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼šä¸ºä»€ä¹ˆ await èƒœè¿‡ Promise#then()</a> çš„æ–‡ç« ï¼Œä»‹ç»äº†ç›¸æ¯” <code>Promise</code> ï¼Œåœ¨ <code>async/await</code> ä¸‹ä¸ºä»€ä¹ˆå¼•æ“å¯ä»¥æ›´å¥½åœ°æ•è·å’Œå­˜å‚¨å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">async</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> foo</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> bar</span><span style="--s-dark:#666666;--s-light:#999999;">();</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> bar</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  throw</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> Error</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">BEEP BEEP</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">foo</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">catch</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">error</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> console</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">log</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">error</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">stack</span><span style="--s-dark:#666666;--s-light:#999999;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">// Error: BEEP BEEP</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">//     at bar (&lt;anonymous&gt;:7:9)</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">//     at foo (&lt;anonymous&gt;:2:9)</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">//     at &lt;anonymous&gt;:10:1</span></span></code></pre><p><code>async</code> ç‰ˆæœ¬æ­£ç¡®åœ°æ•è·äº†é”™è¯¯å †æ ˆçš„è·Ÿè¸ªä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ <code>Promise</code> çš„ç‰ˆæœ¬ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> foo</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#80A665;--s-light:#59873A;"> bar</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> bar</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    throw</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> Error</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">BEEP BEEP</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">foo</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">catch</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">error</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> console</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">log</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">error</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">stack</span><span style="--s-dark:#666666;--s-light:#999999;">));</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">// Error: BEEP BEEP  at &lt;anonymous&gt;:7:11</span></span></code></pre><p>å †æ ˆè·Ÿè¸ªä¿¡æ¯ä¸¢å¤±äº†ã€‚æŠŠç®­å¤´å‡½æ•°æ”¹ä¸ºå…·åå‡½æ•°ï¼Œè¿™ç§æƒ…å†µå¯ä»¥å¾—åˆ°æ”¹å–„ï¼Œä½†æ˜¯ä»ç„¶ä¸å¤Ÿå¥½ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> foo</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#80A665;--s-light:#59873A;"> bar</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">value</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> bar</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  return</span><span style="--s-dark:#B8A965;--s-light:#998418;"> Promise</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">then</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">function</span><span style="--s-dark:#80A665;--s-light:#59873A;"> thisWillThrow</span><span style="--s-dark:#666666;--s-light:#999999;">()</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    throw</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> Error</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">BEEP BEEP</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">foo</span><span style="--s-dark:#666666;--s-light:#999999;">().</span><span style="--s-dark:#80A665;--s-light:#59873A;">catch</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">error</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> console</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">log</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">error</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">stack</span><span style="--s-dark:#666666;--s-light:#999999;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">// Error: BEEP BEEP</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">//    at thisWillThrow (&lt;anonymous&gt;:7:11)</span></span></code></pre><h2 id="å¯¹-async-await-æ™®éçš„åå¯¹æ„è§" tabindex="-1">å¯¹ async/await æ™®éçš„åå¯¹æ„è§ <a class="header-anchor" href="#å¯¹-async-await-æ™®éçš„åå¯¹æ„è§">ğŸ”—</a></h2><p>æˆ‘æœ‰äº†è§£åˆ°å¯¹ <code>async/await</code> çš„ä¸¤ç§æ™®éçš„åå¯¹æ„è§ã€‚</p><p>å…¶ä¸€ï¼Œå½“è°ƒç”¨ä¸€ä¸ªä¸å¿…é¡ºåºæ‰§è¡Œçš„ç‹¬ç«‹çš„å¼‚æ­¥å‡½æ•°æ—¶ï¼Œå³å¯ä»¥é€šè¿‡ <code>Promise.all</code> æ­£ç¡®åœ°è¢«å¤„ç†æ—¶ï¼ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨å®½æ¾çš„æœ¯è¯­çš„è¯ï¼Œä¹Ÿå¯ä»¥å«åšâ€œå¹¶è¡Œâ€ï¼‰ï¼Œ <code>async/await</code> ä¼šæˆä¸ºä¸€ä¸ªè‡ªåºŸæ­¦åŠŸçš„è®¾è®¡ã€‚</p><p>è¿™ä¼šè®©å¼€å‘è€…å¯¹å¼‚æ­¥ç¼–ç¨‹æµ…å°è¾„æ­¢ï¼Œæ— æ³•çœŸæ­£åœ°äº†è§£ <code>Promise</code> åœ¨å¹•åçš„å·¥ä½œåŸç†ã€‚</p><p>å…¶äºŒï¼Œè¿™éƒ¨åˆ†æœ‰äº›ç»†å¾®çš„å·®åˆ«ã€‚ä¸€äº›<a href="https://dev.to/jesterxl/why-i-don-t-use-async-await-4amc" target="_blank" rel="noopener">å‡½æ•°å¼ç¼–ç¨‹çƒ­è¡·è€…</a>è®¤ä¸º <code>async/await</code> ä¼šå¯¼è‡´å‘½ä»¤å¼ç¼–ç¨‹ã€‚æ ¹æ®ä¸€ä½å‡½æ•°å¼å¼€å‘è€…çš„è§‚ç‚¹ï¼Œèƒ½å¤Ÿä½¿ç”¨å¾ªç¯å’Œ <code>try catch</code> å¹¶ä¸æ˜¯å¥½äº‹ï¼Œå› ä¸ºè¿™äº›è¯­æ³•æ„å‘³ç€å‰¯ä½œç”¨ï¼Œå¹¶ä¸”é¼“åŠ±ä¸å¤Ÿç†æƒ³çš„é”™è¯¯å¤„ç†ã€‚</p><p>æˆ‘èµåŒè¿™ä¸ªè®ºç‚¹ã€‚å‡½æ•°å¼å¼€å‘è€…ç†æ‰€å½“ç„¶åœ°å…³å¿ƒä»–ä»¬æ‰€å†™ç¨‹åºçš„ç¡®å®šæ€§ã€‚ä»–ä»¬å¯¹è‡ªå·±çš„ä»£ç è¦æœ‰ç»å¯¹çš„æŠŠæ¡æƒã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå¼•å…¥ä¸€ä¸ªå¸¦æœ‰ç±»ä¼¼ <a href="https://folktale.origamitower.com/api/v2.3.0/en/folktale.result.html" target="_blank" rel="noopener">Result</a> ç±»å‹çš„å¤æ‚çš„ç±»å‹ç³»ç»Ÿä¹Ÿæ˜¯åˆç†çš„ã€‚ä½†æˆ‘ä¸è®¤ä¸º <code>async/await</code> å’Œå‡½æ•°å¼ç¼–ç¨‹ä¹‹é—´äº’ç›¸çŸ›ç›¾ã€‚æˆ‘çš„æœ‹å‹ <a href="https://twitter.com/jrsinclair" target="_blank" rel="noopener">James</a> ï¼Œä¸€ä¸ªç†Ÿç»ƒçš„å‡½æ•°å¼ç¼–ç¨‹å¼€å‘è€…ï¼Œä»–è¯´åœ¨ Haskell è¯­è¨€ä¸­å­˜åœ¨ä¸€ä¸ªå’Œ <code>async/await</code> ç›¸ç­‰çš„ç‰¹æ€§ - <a href="https://wiki.haskell.org/Keywords#do" target="_blank" rel="noopener">Do ç¬¦å·</a>ç‰¹æ€§ã€‚</p><p>æ— è®ºå¦‚ä½•ï¼Œæˆ‘è®¤ä¸ºå¤§å¤šæ•°äººï¼ŒåŒ…æ‹¬æˆ‘ï¼Œå‡½æ•°ç¼–ç¨‹åªæ˜¯ä¸€ä¸ªåå¤©å…»æˆçš„çˆ±å¥½ï¼ˆå°½ç®¡æˆ‘ç¡®å®è®¤ä¸ºå‡½æ•°ç¼–ç¨‹éå¸¸çš„é…·ï¼Œå¹¶ä¸”æˆ‘ä¹Ÿåœ¨æ…¢æ…¢åœ°å­¦ä¹ å®ƒï¼‰ã€‚ç”± <code>async/await</code> æä¾›çš„æ­£å¸¸çš„æ§åˆ¶æµå£°æ˜ä»¥åŠ <code>try catch</code> çš„é”™è¯¯å¤„ç†æµç¨‹ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æå…¶æœ‰ç”¨çš„ï¼Œåœ¨ JavaScript ä¸­æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ç¼–æ’å¤æ‚çš„å¼‚æ­¥æ“ä½œã€‚è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¯´ â€œ <code>async/await</code> åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–â€ è¿™ç§è¯´æ³•æ˜¯ä¸å¤Ÿå‡†ç¡®çš„ã€‚</p><h2 id="å»¶ä¼¸é˜…è¯»" tabindex="-1">å»¶ä¼¸é˜…è¯» <a class="header-anchor" href="#å»¶ä¼¸é˜…è¯»">ğŸ”—</a></h2><ul><li><a href="https://jrsinclair.com/articles/2019/how-to-run-async-js-in-parallel-or-sequential/" target="_blank" rel="noopener">å¦‚ä½•é¡ºåºæˆ–è€…å¹¶è¡Œæ‰§è¡Œ async å‡½æ•°</a>ã€‚</li><li>æ ‡é¢˜ä½¿ç”¨çš„â€œè¯­æ³•ç³–â€è¿™å‡ ä¸ªå­—åœ¨ Reddit ä¸Šä¹Ÿå¼•å‘äº†ä¸€åœºæœ‰è¶£çš„<a href="https://www.reddit.com/r/javascript/comments/wnli3o/on_syntactic_sugar/" target="_blank" rel="noopener">è®¨è®º</a></li></ul>`,62)])))}};export{b as categories,P as date,S as default,E as key,x as meta,C as tags,w as title,F as updated,_ as wordCount};
