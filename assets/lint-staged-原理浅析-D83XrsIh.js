import{createElementBlock as t,openBlock as n,createStaticVNode as p}from"vue";import{c as l}from"./app-CGnJzz9B.js";import"nprogress";import"pinia-plugin-persistedstate";import"vue-router";import"vue-router-better-scroller";import"@vueuse/core";import"@vueuse/components";import"@vueuse/router";import"octokit";import"pinia";import"date-fns";const e={class:"kan-doc"},v="lint-staged åŸç†æµ…æ",x=1661308814,j="2022-08-24T10:40:14.000Z",b="2023-02-13T18:28:44.000Z",w=["lint-staged"],F=["ç¼–ç¨‹"],E=8679,S=[{property:"og:title",content:"lint-staged åŸç†æµ…æ"},{name:"twitter:title",content:"lint-staged åŸç†æµ…æ"}],_={__name:"lint-staged-åŸç†æµ…æ",setup(i,{expose:a}){return a({frontmatter:{title:"lint-staged åŸç†æµ…æ",key:1661308814,date:"2022-08-24T10:40:14.000Z",updated:"2023-02-13T18:28:44.000Z",tags:["lint-staged"],categories:["ç¼–ç¨‹"],wordCount:8679,meta:[{property:"og:title",content:"lint-staged åŸç†æµ…æ"},{name:"twitter:title",content:"lint-staged åŸç†æµ…æ"}]}}),l({title:"lint-staged åŸç†æµ…æ",meta:[{property:"og:title",content:"lint-staged åŸç†æµ…æ"},{name:"twitter:title",content:"lint-staged åŸç†æµ…æ"}]}),(g,s)=>(n(),t("div",e,s[0]||(s[0]=[p(`<h1 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€">ğŸ”—</a></h1><p>æ²¡æœ‰ç»è¿‡æ ¼å¼è¯­æ³•æ ¡éªŒçš„ä»£ç ï¼Œå°±è·Ÿç”µå­çƒŸä¸æŠ½æ‚¦æŸ¯5æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰çµé­‚</p><p style="text-align:right;">â€”â€”â€”â€”â€”â€”èŠ‚é€‰è‡ªã€Šçº¯çœŸçš„ä»£ç ã€‹ï¼Œä½œè€…ï¼šé²è¿…</p><p>å‰é¢æˆ‘ä»¬æœ‰è®²è¿‡ä½¿ç”¨ç¬¨æ–¹æ³•æ¥å®Œæˆå¯¹ <code>hexo</code> å¸–å­çš„ <code>updated</code> å­—æ®µè¿›è¡Œæ›´æ–°</p><p>å¦‚æœä½ ä¸çŸ¥é“è¿™ä¸ªç¬¨æ–¹æ³•ï¼Œä½ å¯ä»¥ç‚¹å‡»{% post_link ä½¿ç”¨-husky-æ¥ä¸ºå¸–å­å¢åŠ æ›´æ–°æ—¶é—´ æ­¤å¤„ %}ä¸€é”®èµ·é£åˆ°è¯¥å¸–å­</p><p>å½“ç„¶ï¼Œå¯¹äºç¼–ç¨‹æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>lint-staged</code> ä»¥åŠ <code>eslint</code> å®Œæˆåªå¯¹æš‚å­˜åŒºæ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–</p><p>æ‰€ä»¥ï¼Œè¿™ç¯‡ä¸»è¦æµ…æä¸€ä¸‹ <code>lint-staged</code> æ˜¯å¦‚ä½•åªå¯¹æš‚å­˜åŒºæ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–çš„</p><p>äº†è§£å®Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™å’Œ <code>eslint</code> ä¸€æ ·çš„å·¥å…·æ¥å¯¹ <code>hexo</code> çš„å¸–å­çš„ <code>updated</code> å­—æ®µè¿›è¡Œæ›´æ–°äº†ï¼Œä¸å¿…å†å…³å¿ƒ <code>git</code> æ“ä½œæ–¹é¢çš„é€»è¾‘</p><h1 id="æ­£æ–‡" tabindex="-1">æ­£æ–‡ <a class="header-anchor" href="#æ­£æ–‡">ğŸ”—</a></h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬å½“ç„¶è¦æŠŠä»£ç æ‹‰ä¸‹äº†ï¼Œé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/okonet/lint-staged" target="_blank" rel="noopener">lint-staged</a></p><p>åœ¨ <code>lib</code> æ–‡ä»¶å¤¹ä¸‹é¢å°±æ˜¯å…¨éƒ¨çš„æºä»£ç æ–‡ä»¶äº†</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/26/202208261612323.avif" alt=""></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬åªéœ€è¦é‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶</p><ul><li><code>execGit.js</code></li><li><code>getStagedFiles.js</code></li><li><code>gitWorkflow.js</code></li><li><code>parseGitZOutput.js</code></li></ul><p>è¿™å‡ ä¸ªæ–‡ä»¶å¯ä»¥è¯´æ¶µç›–äº†æ ¸å¿ƒçš„é€»è¾‘ï¼Œå…¶ä»–çš„æ–‡ä»¶å¾ˆå¤šéƒ½æ˜¯åœ¨å¤„ç†æ§åˆ¶å°è¾“å‡ºç›¸å…³çš„é€»è¾‘</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¼šä¸€ä¸ªä¸ªæ–‡ä»¶æ¥è®²</p><h2 id="execgit-js" tabindex="-1">execGit.js <a class="header-anchor" href="#execgit-js">ğŸ”—</a></h2><p>ä¸åŒäºä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„ <code>shelljs</code> ï¼Œ <code>lint-staged</code> ä½¿ç”¨äº† <code>execa</code> åº“æ¥ä½œä¸ºåœ¨ <code>node</code> ä¸Šæ‰§è¡Œ <code>git</code> å‘½ä»¤çš„å·¥å…·</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> const</span><span style="--s-dark:#80A665;--s-light:#59873A;"> execGit</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> async</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">cmd</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> options</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#666666;--s-light:#999999;"> {})</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">  debugLog</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Running git command</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> cmd</span><span style="--s-dark:#666666;--s-light:#999999;">)</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  try</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> stdout</span><span style="--s-dark:#666666;--s-light:#999999;"> }</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> execa</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">git</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> GIT_GLOBAL_OPTIONS</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">concat</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">cmd</span><span style="--s-dark:#666666;--s-light:#999999;">),</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      ...</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">options</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">      all</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> true</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">      cwd</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> options</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">cwd</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> ||</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> process</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">cwd</span><span style="--s-dark:#666666;--s-light:#999999;">(),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    })</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    return</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> stdout</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> catch</span><span style="--s-dark:#666666;--s-light:#999999;"> ({</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> all</span><span style="--s-dark:#666666;--s-light:#999999;"> })</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    throw</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> Error</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">all</span><span style="--s-dark:#666666;--s-light:#999999;">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>è¿™æ®µçš„æ ¸å¿ƒå°±æ˜¯ <code>const { stdout } = await execa(&#39;git&#39;)</code> ï¼Œæ„æ€å°±æ˜¯æ‰§è¡Œä¸€ä¸ª <code>git</code> å‘½ä»¤ï¼Œç„¶åè¿”å›å‘½ä»¤è¾“å‡ºçš„å†…å®¹</p><h2 id="parsegitzoutput-js" tabindex="-1">parseGitZOutput.js <a class="header-anchor" href="#parsegitzoutput-js">ğŸ”—</a></h2><p>å¯¹æ¯”ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>git status --porcelain</code> æŒ‰è¡Œæ¥å¤„ç†ï¼Œ <code>lint-staged</code> å°±ç®€å•å¤šäº†ï¼Œç›´æ¥ <code>git status -z</code> ç„¶åæ ¹æ®ç©ºå­—ç¬¦åˆ†å‰²</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> const</span><span style="--s-dark:#80A665;--s-light:#59873A;"> parseGitZOutput</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">input</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">  input</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    ?</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> input</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">        .</span><span style="--s-dark:#80A665;--s-light:#59873A;">replace</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">/</span><span style="--s-dark:#C99076;--s-light:#A65E2B;">\\u0000</span><span style="--s-dark:#4D9375;--s-light:#1E754F;">$</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">/</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0;"> // eslint-disable-line no-control-regex</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">        .</span><span style="--s-dark:#80A665;--s-light:#59873A;">split</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#C99076;--s-light:#A65E2B;">\\u0000</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    :</span><span style="--s-dark:#666666;--s-light:#999999;"> []</span></span></code></pre><p>è¿™é‡Œç¡®å®å­¦åˆ°äº†ï¼Œä¹‹å‰ç¡®å®ä¸çŸ¥é“æ€ä¹ˆé€šè¿‡ç©ºå­—ç¬¦ <code>split</code> ï¼ŒåŸæ¥ç©ºå­—ç¬¦çš„ <code>unicode</code> ç¼–ç ä¸º <code>\\u0000</code> ï¼Œå¥½å§ï¼Œæ˜¯æˆ‘å¤ªèœäº†</p><p>è¿™é‡Œè¦ä¸»è¦é€šè¿‡ <code>replace</code> æ¥æŠŠæœ€åä¸€ä¸ªç©ºå­—ç¬¦æ›¿æ¢æ‰ï¼Œç„¶åå†é€šè¿‡ç©ºå­—ç¬¦åˆ†å‰²</p><p><code>git status -z</code> ä¼šåœ¨æœ€åä¸€ä¸ªæ–‡ä»¶åé¢è·Ÿä¸Šç©ºå­—ç¬¦ï¼Œå¦‚ä¸‹</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/26/202208261647946.avif" alt=""></p><p>å¦‚æœä¸æ›¿æ¢ï¼Œä¼šäº§ç”Ÿç©ºçš„é¡¹ï¼Œå³ <code>&#39;1|2|3|&#39;.split(&#39;|&#39;)</code> ä¼šè¿”å› <code>[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;&#39;]</code>,</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/26/202208261703772.avif" alt=""></p><h2 id="getstagedfiles-js" tabindex="-1">getStagedFiles.js <a class="header-anchor" href="#getstagedfiles-js">ğŸ”—</a></h2><p>ç›¸æ¯”äºä¹‹å‰æˆ‘ä»¬ä½¿ç”¨ <code>git status</code> æ¥æ ¹æ®å¤´ä¸¤ä¸ªå­—ç¬¦æ ‡è®°æ¥åˆ¤æ–­å½“å‰åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ï¼Œ <code>lint-staged</code> ä½¿ç”¨äº† <code>git diff</code></p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> const</span><span style="--s-dark:#80A665;--s-light:#59873A;"> getStagedFiles</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> async</span><span style="--s-dark:#666666;--s-light:#999999;"> ({</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> cwd</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> process</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">cwd</span><span style="--s-dark:#666666;--s-light:#999999;">(),</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> diff</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> diffFilter</span><span style="--s-dark:#666666;--s-light:#999999;"> }</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#666666;--s-light:#999999;"> {})</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  try</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> lines</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> await</span><span style="--s-dark:#80A665;--s-light:#59873A;"> execGit</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#80A665;--s-light:#59873A;">getDiffCommand</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">diff</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> diffFilter</span><span style="--s-dark:#666666;--s-light:#999999;">),</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> cwd</span><span style="--s-dark:#666666;--s-light:#999999;"> })</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    if</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#CB7676;--s-light:#AB5959;">!</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">lines</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> return</span><span style="--s-dark:#666666;--s-light:#999999;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    return</span><span style="--s-dark:#80A665;--s-light:#59873A;"> parseGitZOutput</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">lines</span><span style="--s-dark:#666666;--s-light:#999999;">).</span><span style="--s-dark:#80A665;--s-light:#59873A;">map</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">file</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#80A665;--s-light:#59873A;"> normalize</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">path</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">resolve</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">cwd</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> file</span><span style="--s-dark:#666666;--s-light:#999999;">)))</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F;"> catch</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">    return</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> null</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>ä¸Šé¢æ‰§è¡Œçš„ <code>git</code> å‘½ä»¤é»˜è®¤æƒ…å†µä¸‹å…¶å®å°±æ˜¯ <code>git diff --name-only -z --diff-filter=ACMR --staged</code></p><p>è¿™æ¡å‘½ä»¤å°±æ˜¯è¾“å‡ºå½“å‰æš‚å­˜åŒºçš„æ–‡ä»¶åˆ—è¡¨</p><p>å…¶ä¸­ <code>--name-only</code> åªè¾“å‡ºæ–‡ä»¶åï¼Œå¹¶ä¸”è¾“å‡ºæ˜¯ <code>UTF-8</code> çš„ç¼–ç çš„ï¼Œä¹Ÿå°±æ˜¯æ”¯æŒéè‹±æ–‡æ–‡ä»¶åï¼Œä¸ç”¨åƒä¹‹å‰ä¸€æ ·å»è®¾ç½® <code>core.quotepath = false</code></p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280043839.avif" alt=""></p><p><code>--staged</code> å°±æ˜¯å‘Šè¯‰ <code>git</code> æˆ‘è¦æ¯”è¾ƒçš„æ˜¯æš‚å­˜åŒºä¸ <code>Head</code> çš„å·®å¼‚ï¼Œè€Œä¸æ˜¯å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„å·®å¼‚ï¼Œå¦‚æœä¸åŠ ï¼Œé‚£ä¹ˆæ¯”è¾ƒçš„å°±æ˜¯å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„å·®å¼‚</p><p><code>--diff-filter</code> æŒ‡å®šéœ€è¦è¿‡æ»¤çš„æ–‡ä»¶ï¼Œ <code>ACMR</code> å°±å¯¹åº”äº†å››ç§æ–‡ä»¶ï¼Œ <code>Added</code>, <code>Copied</code>, <code>Modified</code>, <code>Renamed</code> ï¼Œè¿™é‡Œæ²¡æœ‰ <code>D</code> ï¼Œå› ä¸ºå¯¹åˆ é™¤æ–‡ä»¶æ²¡å¿…è¦å»æ›´æ”¹å®ƒçš„å†…å®¹</p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå°å†™ï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å°±ä¼šå˜æˆæ’é™¤é€‰é¡¹ï¼Œå³ <code>--diff-filter=acmr</code> å°±æ˜¯æ’é™¤è¿™å››ç±»çš„æ–‡ä»¶</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280052189.avif" alt=""></p><p>è¿™é‡Œå¯ä»¥çœ‹ <code>git</code> çš„æ–‡æ¡£ï¼Œæœ‰æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œè¿™é‡Œå°±ç®€å•çš„è®²è¿™è¡Œå‘½ä»¤çš„åŠŸèƒ½</p><p>æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ <code>add</code> äº† <code>1.txt</code> è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åå†å¾€ <code>1.txt</code> é‡Œé¢æ·»åŠ äº†ä¸€è¡Œï¼Œæ­¤æ—¶ <code>git status</code> å¦‚ä¸‹</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280113924.avif" alt=""></p><p>æ‰§è¡Œ <code>git diff --name-only -z --diff-filter=ACMR --staged</code> ï¼Œåªè¾“å‡ºäº† <code>1.txt</code></p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280100168.avif" alt=""></p><p>æ‰§è¡Œ <code>git diff --name-only -z --diff-filter=ACMR</code> ï¼Œè¿˜æ˜¯åªè¾“å‡ºäº† <code>1.txt</code></p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280127126.avif" alt=""></p><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ä¸ºå•¥ä¼šä¸€æ ·ï¼Œæˆ‘ä»¬åªè¦å»æ‰ <code>--name-only</code> åœ¨è¾“å‡ºï¼Œå°±å¯ä»¥æ˜ç™½äº†</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280129357.avif" alt=""></p><h2 id="gitworkflow-js" tabindex="-1">gitWorkflow.js <a class="header-anchor" href="#gitworkflow-js">ğŸ”—</a></h2><p>çœ‹è¿™ä¸ªæ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå»çœ‹ <code>runAll.js</code> è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è¡¨æ˜äº† <code>gitWorkflow.js</code> å†…æ–¹æ³•çš„è°ƒç”¨é¡ºåº</p><p>æˆ‘ä»¬åªéœ€å…³å¿ƒå¦‚ä¸‹çš„ä»£ç </p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff;" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> const</span><span style="--s-dark:#80A665;--s-light:#59873A;"> runAll</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> async</span><span style="--s-dark:#666666;--s-light:#999999;"> ()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">  // ...</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34;">  </span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> git</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> GitWorkflow</span><span style="--s-dark:#666666;--s-light:#999999;">({</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    allowEmpty</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    gitConfigDir</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    gitDir</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    matchedFileChunks</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    diff</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    diffFilter</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959;">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> runner</span><span style="--s-dark:#666666;--s-light:#999999;"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959;"> new</span><span style="--s-dark:#80A665;--s-light:#59873A;"> Listr</span><span style="--s-dark:#666666;--s-light:#999999;">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    [</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        title</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Preparing lint-staged...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        task</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> git</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">prepare</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        title</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Hiding unstaged changes to partially staged files...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        task</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> git</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">hideUnstagedChanges</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        enabled</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> hasPartiallyStagedFiles</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        title</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> \`</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Running tasks for staged files...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">\`</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        task</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> task</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> task</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">newListr</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">listrTasks</span><span style="--s-dark:#666666;--s-light:#999999;">,</span><span style="--s-dark:#666666;--s-light:#999999;"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> concurrent</span><span style="--s-dark:#666666;--s-light:#999999;"> }),</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        skip</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> ()</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> listrTasks</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">every</span><span style="--s-dark:#666666;--s-light:#999999;">((</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">task</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> task</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">skip</span><span style="--s-dark:#666666;--s-light:#999999;">()),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        title</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Applying modifications from tasks...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        task</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> git</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">applyModifications</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        skip</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> applyModificationsSkipped</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        title</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Restoring unstaged changes to partially staged files...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        task</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> git</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">restoreUnstagedChanges</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        enabled</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> hasPartiallyStagedFiles</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        skip</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> restoreUnstagedChangesSkipped</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        title</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Reverting to original state because of errors...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        task</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> git</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">restoreOriginalState</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        enabled</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> restoreOriginalStateEnabled</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        skip</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> restoreOriginalStateSkipped</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        title</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;"> &#39;</span><span style="--s-dark:#C98A7D;--s-light:#B56959;">Cleaning up temporary files...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977;">&#39;</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A;">        task</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#666666;--s-light:#999999;"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">)</span><span style="--s-dark:#666666;--s-light:#999999;"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> git</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">cleanup</span><span style="--s-dark:#666666;--s-light:#999999;">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48;">ctx</span><span style="--s-dark:#666666;--s-light:#999999;">),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        enabled</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> cleanupEnabled</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418;">        skip</span><span style="--s-dark:#666666;--s-light:#999999;">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> cleanupSkipped</span><span style="--s-dark:#666666;--s-light:#999999;">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">    ],</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48;">    listrOptions</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">  )</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F;">  await</span><span style="--s-dark:#BD976A;--s-light:#B07D48;"> runner</span><span style="--s-dark:#666666;--s-light:#999999;">.</span><span style="--s-dark:#80A665;--s-light:#59873A;">run</span><span style="--s-dark:#666666;--s-light:#999999;">()</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0;">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999;">}</span></span></code></pre><p>å…¶ä¸­æˆ‘ä»¬æœ€å…³å¿ƒçš„å°±æ˜¯å¦‚ä½•æŠŠå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„åŒºåˆ«ä¿å­˜ä»¥åŠæ¢å¤ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä»£ç ä¸­çš„</p><ul><li>Hiding unstaged changes to partially staged filesâ€¦</li><li>Restoring unstaged changes to partially staged filesâ€¦</li></ul><p>è¿™ä¸¤ä¸ªè¿‡ç¨‹</p><p>æˆ‘ä»¬å…ˆçœ‹ <code>hideUnstagedChanges</code> è¿™æ®µä»£ç </p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280158420.avif" alt=""></p><p>å¯ä»¥å‘ç°ä»–åªæ˜¯æŠŠå·¥ä½œåŒºçš„æ”¹å˜ä¸¢å¼ƒäº†è€Œå·²</p><p>å¯èƒ½ä½ ä¼šç–‘æƒ‘ï¼Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤å·¥ä½œåŒºçš„æ”¹å˜ä¸å°±ä¸¢å¤±äº†å—ï¼Œåˆ°æ—¶å€™æ€ä¹ˆæ¢å¤å‘¢ï¼Ÿ</p><p>æ²¡é”™ï¼Œåœ¨ <code>prepare</code> æ–¹æ³•ä¸­ï¼Œæœ‰å¯¹å·¥ä½œåŒºçš„æ”¹å˜è¿›è¡Œä¿å­˜</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280202650.avif" alt=""></p><p>æ²¡é”™ï¼Œè¿™é‡Œçš„æ ¸å¿ƒå°±æ˜¯æ‰§è¡Œçš„è¿™æ®µ <code>git</code> å‘½ä»¤ï¼Œè¿™æ®µå‘½ä»¤ä¸º</p><p><code>git diff --binary --unified=0 --no-color --no-ext-diff --src-prefix=a/ --dst-prefix=b/ --patch --submodule=short --output .git/lint-staged_unstaged.patch</code></p><p>è¿™ä¸ªå‘½ä»¤ç”Ÿæˆäº†ä¸€ä¸ª <code>patch</code> æ–‡ä»¶ï¼Œä¿å­˜äº†å½“å‰å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„åŒºåˆ«</p><p>è¿™é‡Œé¢æœ€é‡è¦çš„å‚æ•°å°±æ˜¯ <code>--unified=0</code> ï¼Œè¿™ä¸ªå‚æ•°å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šå¦‚ä¸‹</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280210852.avif" alt=""></p><p>ç”ŸæˆæŒ‡å®šä¸Šä¸‹æ–‡è¡Œæ•°çš„ <code>diff</code> ï¼Œemmmï¼Œæœ‰ç‚¹éš¾æ‡‚</p><p>æˆ‘ä»¬å¯ä»¥åšä¸ªå°æµ‹è¯•ï¼Œæˆ‘ä»¬å…ˆå¾€ç‰ˆæœ¬åº“é‡Œé¢æäº¤ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280219135.avif" alt=""></p><p>ç„¶åæˆ‘ä»¬å¾€ä¸­é—´æ’å…¥ä¸€è¡Œï¼Œå¦‚ä¸‹</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280220646.avif" alt=""></p><p>è¿™é‡Œä¸è¾“å‡º <code>patch</code> æ–‡ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥æ‰“å°åˆ°æ§åˆ¶å°</p><p>æ‰§è¡Œ <code>git diff --unified=0</code></p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280222925.avif" alt=""></p><p>æ‰§è¡Œ <code>git diff --unified=3</code></p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280223005.avif" alt=""></p><p>è¿™é‡Œæˆ‘ä»¬å‘ç°ï¼ŒåŒºåˆ«å°±æ˜¯å¢åŠ çš„è¡Œä¸Šä¸‹ä¼šå‡ºç°æ–‡ä»¶åŸæœ¬çš„è¡Œ</p><p>é‚£è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>å…¶å®è¿™è·Ÿåé¢è¦è®²åˆ°çš„ <code>git apply</code> å‘½ä»¤æœ‰å…³ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“ï¼Œæˆ‘ä»¬å·²ç»ä¿å­˜äº†å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„åŒºåˆ«äº†</p><p>é‚£ä¹ˆ <code>hideUnstagedChanges</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>checkout --force</code> æ¥æŠŠå·¥ä½œåŒºçš„æ”¹å˜ç»™ä¸¢æ‰</p><p>æ¥ä¸‹æ¥çš„æ­¥éª¤æˆ‘æƒ³ä½ ä¹Ÿåº”è¯¥æ‡‚äº†</p><p>ä¸¢æ‰å·¥ä½œåŒºçš„æ”¹å˜ä¹‹åï¼Œå¯¹æ–‡ä»¶è¿›è¡Œ <code>eslint</code>ï¼ˆæˆ–è€…å…¶ä»–çš„å‘½ä»¤ï¼‰ï¼Œç„¶åæŠŠæ–‡ä»¶ <code>add</code> è¿›æš‚å­˜åŒºï¼ˆ <code>eslint</code> å¯èƒ½ä¼šæ”¹å˜æ–‡ä»¶ï¼‰</p><p>ç„¶åå†æŠŠç”Ÿæˆçš„ <code>patch</code> æ–‡ä»¶é€šè¿‡æŸç§æ–¹å¼æ¢å¤åˆ°å·¥ä½œåŒºä¸­ï¼Œæ¥ç€å°±æ˜¯æˆ‘ä»¬æ‰§è¡Œçš„ <code>commit</code> å‘½ä»¤äº†ï¼ˆä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯åœ¨ <code>pre-commit</code> ä¸­æ‰§è¡Œ <code>lint-staged</code> ï¼‰</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦çœ‹ <code>restoreUnstagedChanges</code> è¿™ä¸ªå‡½æ•°äº†ï¼Œä»åå­—ä¸Šçœ‹æˆ‘ä»¬å°±çŸ¥é“å®ƒé‡æ–°æŠŠä¹‹å‰å·¥ä½œåŒºçš„æ”¹å˜æ¢å¤åˆ°äº†å·¥ä½œåŒºï¼ˆä¹‹å‰æ‰§è¡Œ <code>checkout --force</code> ä¸¢å¼ƒäº†ï¼Œä½†æ˜¯ä½¿ç”¨äº† <code>git diff</code> ç”Ÿæˆäº† <code>patch</code> æ–‡ä»¶ï¼‰ï¼Œä»£ç å¦‚ä¸‹</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280235579.avif" alt=""></p><p>è¿™é‡Œçš„ <code>catch</code> å†…å®¹éƒ½ä¸ç”¨çœ‹ï¼Œä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯è¿™ä¸ª <code>git</code> å‘½ä»¤</p><p>è¿™ä¸ªå‘½ä»¤ä¸º <code>git apply -v --whitespace=nowarn --recount --unidiff-zero .git/lint-staged_unstaged.patch</code></p><p>æ²¡é”™ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯æŠŠæˆ‘ä»¬ä¹‹å‰çš„ä¿å­˜ä¸‹æ¥çš„ <code>patch</code> æ–‡ä»¶ç»™æ¢å¤åˆ°å·¥ä½œåŒº</p><p>è¿™é‡Œé¢æœ€é‡è¦çš„å‚æ•°å°±æ˜¯ <code>--unidiff-zero</code> ï¼Œå®˜æ–¹æ–‡æ¡£è§£é‡Šå¦‚ä¸‹</p><p><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/08/28/202208280240210.avif" alt=""></p><p>è¿™æ®µçš„æ„æ€é€šä¿—ç‚¹è®²å°±æ˜¯ï¼Œ<code>git apply</code> åœ¨åˆå¹¶çš„æ—¶å€™ï¼Œä¼šè‡³å°‘æŸ¥æ‰¾ä¸€è¡ŒåŸæœ¬å°±å­˜åœ¨çš„ä»£ç æ¥ä½œä¸ºä¾æ®æ¥åº”ç”¨è¿™ä¸ªæ”¹å˜ï¼Œå› ä¸ºè¿™æ ·å­åšå®‰å…¨ï¼Œä½†å¦‚æœä½ ä½¿ç”¨äº† <code>git diff --unified=0</code> ç”Ÿæˆ <code>patch</code> ï¼Œé‚£ä¹ˆåº”ç”¨ä¼šå¤±è´¥ï¼Œå› ä¸ºè¿™æ ·çš„ <code>patch</code> æ²¡æœ‰è¿™äº›ä¾æ®è¡Œï¼Œä¸ºäº†ç»•è¿‡è¿™ä¸ªæ£€æŸ¥ï¼Œä½¿ç”¨ <code>--unidiff-zero</code> å³å¯</p><p>é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å…³æ‰è¿™ä¸ªéªŒè¯å‘¢ï¼Œå…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ”¹å˜æš‚å­˜åŒºæ–‡ä»¶çš„æŸäº›è¡Œï¼Œè€Œå¦‚æœç”Ÿæˆçš„ <code>patch</code> åˆšå¥½ä¾èµ–äº†è¿™äº›è¡Œï¼Œé‚£ä¹ˆ <code>apply</code> æ“ä½œå°±ä¼šå¤±è´¥ï¼Œæ ¹æœ¬ä¸Šæˆ‘ä»¬ä¸å¿…åœ¨æ„æš‚å­˜åŒºæ–‡ä»¶çš„æ”¹å˜ï¼Œæˆ‘ä»¬ä»…ä»…åªæ˜¯éœ€è¦ä¿å­˜å½“å‰å·¥ä½œåŒºçš„æ”¹å˜ï¼Œæ‰€ä»¥ä¸è¦ä¾èµ–é¢å¤–çš„è¡Œæ¥è¿›è¡Œ <code>apply</code></p><p>åˆ°è¿™ï¼Œæˆ‘ä»¬åŸºæœ¬å°±ç†æ¸…äº† <code>lint-staged</code> çš„åŸç†ï¼Œå¦‚ä¸‹</p><ul><li>ä½¿ç”¨ <code>git diff</code> è·å–æš‚å­˜åŒºæ–‡ä»¶åˆ—è¡¨</li><li>å¦‚æœæš‚å­˜åŒºæ–‡ä»¶åˆ—è¡¨ä¸­å­˜åœ¨è¿˜æœª <code>add</code> çš„ä¿®æ”¹ï¼Œä½¿ç”¨ <code>git diff</code> ç”Ÿæˆ <code>patch</code> ï¼Œè¿™é‡Œç”Ÿæˆçš„ <code>patch</code> ä¸è¦é™„å¸¦æ²¡è¢«ä¿®æ”¹çš„è¡Œ</li><li>å¯¹å­˜åœ¨è¿˜æœª <code>add</code> çš„ä¿®æ”¹çš„æ–‡ä»¶ä½¿ç”¨ <code>git checkout --force</code> ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹</li><li>åº”ç”¨ç”¨æˆ·è®¾ç½®çš„å‘½ä»¤ï¼Œæ¯”å¦‚ <code>eslint</code> ï¼Œ <code>prettier</code></li><li>é‡æ–° <code>add</code> æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼ˆ <code>eslint</code> ï¼Œ <code>prettier</code> å¯èƒ½ä¼šå¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼‰</li><li>æŠŠç”Ÿæˆçš„ <code>patch</code> æ–‡ä»¶é€šè¿‡ <code>git apply</code> é‡æ–°åº”ç”¨åˆ°å·¥ä½œåŒºä¸­ï¼Œè¿™é‡Œçš„ <code>apply</code> è¦å…³æ‰è¡ŒéªŒè¯</li></ul><h1 id="åè®°" tabindex="-1">åè®° <a class="header-anchor" href="#åè®°">ğŸ”—</a></h1><p>ä¹‹å‰æˆ‘æœ‰æƒ³è¿‡ä½¿ç”¨ <code>git stash</code> æ¥ä¿å­˜å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„åŒºåˆ«ï¼Œä¸è¿‡ <code>git stash</code> åªèƒ½ä¿å­˜<strong>å·¥ä½œåŒº+æš‚å­˜åŒº</strong>æˆ–<strong>æš‚å­˜åŒº</strong>çš„æ”¹å˜ï¼Œå¾ˆæ˜æ˜¾æ— æ³•ç¬¦åˆ<strong>åªä¿å­˜å·¥ä½œåŒºçš„æ”¹å˜</strong>è¿™ä¸€éœ€æ±‚</p><p>å½“ç„¶æœ¬æ–‡å¹¶æ²¡æœ‰å¾ˆè¯¦ç»†çš„ä»‹ç» <code>lint-staged</code> çš„æ•´ä¸ªå®ç°åŸç†ï¼Œæ¯”å¦‚å­æ¨¡å—çš„å¤„ç†ï¼Œ<code>apply</code> å¤±è´¥çš„å¤„ç†ï¼Œä»¥åŠå‘½ä»¤è¡Œè¾“å‡ºçš„å¤„ç†</p><p>å˜›ï¼Œæˆ‘è§‰å¾—è¿™äº›éƒ½ä¸æ˜¯é‡è¦çš„éƒ¨åˆ†ï¼Œå¾ˆå¤šæ—¶å€™å…¶å®å¤§å®¶çš„æ“ä½œéƒ½æ˜¯å¾ˆç®€å•çš„ï¼Œæ˜ç™½æœ€æ ¸å¿ƒçš„åŸç†å³å¯</p><p>æœ€åï¼Œè¯·å…è®¸æˆ‘å¯¹è¯¥å·¥ä½œä½œè€…è¿›è¡Œä¸€ä¸ªè½°è½°çƒˆçƒˆåœ°èµç¾ï¼Œâ€œç‰›é€¼â€ï¼Œå¼ºçƒˆå»ºè®®æ¯ä¸ªé¡¹ç›®éƒ½å¼•å…¥ï¼Œæ²¡ç»Ÿä¸€é£æ ¼çš„ä»£ç åšå†³ä¸è¦æ”¾å…¥ç‰ˆæœ¬åº“ä¸­ï¼Œä¸¤ä¸‰ç§é£æ ¼å°±å·²ç»å¾ˆè®¨åŒäº†ï¼Œæœ‰äº›äººå†™ä»£ç è¿˜éšå¿ƒæ‰€æ¬²ï¼Œä¸€ä¼šç¼©è¿›ï¼Œä¸€ä¼šä¸ç¼©è¿›ï¼Œç»´æŠ¤èµ·æ¥è·Ÿåƒäº†å±ä¸€æ ·éš¾å—â€¦</p>`,100)])))}};export{F as categories,j as date,_ as default,x as key,S as meta,w as tags,v as title,b as updated,E as wordCount};
