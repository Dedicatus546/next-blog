<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vue@nextææ¡ˆä¹‹script setupå’Œref sugar</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-kEKefLn2.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-DjlQYv3q.css"><link rel="modulepreload" crossorigin="" href="/assets/Vue-nextææ¡ˆä¹‹script-setupå’Œref-sugar-DJt2_aNE.js"><meta property="og:title" content="Vue@nextææ¡ˆä¹‹script setupå’Œref sugar"><meta name="twitter:title" content="Vue@nextææ¡ˆä¹‹script setupå’Œref sugar"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="æ‹ã®æ­Œçš„logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="è‡ªåŠ¨" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="æ—¥é—´" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="å¤œé—´" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">Vue@nextææ¡ˆä¹‹script setupå’Œref sugar</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">å‘è¡¨äº</span><span pl-1="">2020-11-07 23:01</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">æ›´æ–°äº</span><span pl-1="">2023-02-13 18:28</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">åˆ†ç±»äº</span><!--[--><a pl-1="" href="/category/ç¿»è¯‘">ç¿»è¯‘</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">æ€»å­—æ•°</span><span pl-1="">12.3K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">é˜…è¯»æ—¶é•¿ â‰ˆ</span><span pl-1="">45 åˆ†é’Ÿ</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><h1 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€">ğŸ”—</a></h1><p>é’ˆå¯¹<code>Vue@next</code>å¯¹ç»„ä»¶çš„ç¼–å†™ä¸Šçš„ææ¡ˆâ€“<code>&lt;script setup&gt;</code>ï¼Œä»¥åŠ<code>ref</code>çš„è¯­æ³•ç³–</p><p>è¿™ä¸ªææ¡ˆæ„Ÿè§‰å°¤å¤§å¾ˆå–œæ¬¢ï¼Œå¤§éƒ¨åˆ†å¯¹<code>&lt;script setup&gt;</code>çš„ç‰¹æ€§å¾ˆå–œæ¬¢ï¼Œå› ä¸ºå‡å°‘äº†é‡å¤ä»£ç çš„ç¼–å†™</p><p>é’ˆå¯¹<code>ref</code>è¯­æ³•ç³–ä¸‹é¢çš„å›å¤åŸºæœ¬ä¸Šä¸å–œæ¬¢çš„å±…å¤š</p><p>æœ¬æ–‡ç¿»è¯‘ä¸‹ææ¡ˆä»¥åŠå°¤å¤§çš„ç›¸å…³å›å¤ï¼ŒæŒºæœ‰è¶£çš„</p><p>é’ˆå¯¹æ­¤RFCçš„è®¨è®ºï¼š<a href="https://github.com/vuejs/rfcs/pull/222" target="_blank" rel="noopener">New script setup and ref sugar</a> å®Œæ•´çš„RFCï¼š<a href="https://github.com/vuejs/vue-next/pull/2532" target="_blank" rel="noopener">rfcs/0000-script-setup.md at script-setup</a></p><h1 id="æ­£æ–‡" tabindex="-1">æ­£æ–‡ <a class="header-anchor" href="#æ­£æ–‡">ğŸ”—</a></h1><h2 id="summaryï¼ˆæ‘˜è¦ï¼‰" tabindex="-1">Summaryï¼ˆæ‘˜è¦ï¼‰ <a class="header-anchor" href="#summaryï¼ˆæ‘˜è¦ï¼‰">ğŸ”—</a></h2><blockquote><p>Introduce a new script type in Single File Components: <code>&lt;script setup&gt;</code>, which exposes all its top level bindings to the template. Introduce a compiler-based syntax sugar for using refs without <code>.value</code> inside <code>&lt;script setup&gt;</code>. Note: this is intended to replace the current <code>&lt;script setup&gt;</code> as proposed in #182.</p></blockquote><p>é’ˆå¯¹å•æ–‡ä»¶ç»„ä»¶çš„<code>script</code>æ ‡ç­¾çš„æ–°çš„å±æ€§ï¼š<code>&lt;script setup&gt; ... &lt;/script&gt;</code>ï¼Œæš´éœ²äº†å®ƒè‡ªèº«æ‰€æœ‰çš„é¡¶å±‚å˜é‡ï¼Œç»‘å®šåˆ°æ¨¡æ¿<code>template</code>ä¸Š åœ¨<code>&lt;script setup&gt;</code>ä¸­ï¼Œä¸€ä¸ªé’ˆå¯¹ä½¿ç”¨<code>refs</code>æ— éœ€<code>.value</code>çš„åŸºäºç¼–è¯‘æ—¶çš„è¯­æ³•ç³–ã€‚ æ³¨æ„ï¼šè¿™ä¸ªææ¡ˆçš„ç›®çš„æ˜¯ä¸ºäº†å–ä»£<a href="https://github.com/vuejs/rfcs/pull/182" target="_blank" rel="noopener">#182</a>ææ¡ˆä¸­çš„<code>&lt;script setup&gt;</code>éƒ¨åˆ†</p><h2 id="basic-exampleï¼ˆåŸºæœ¬ä¾‹å­ï¼‰" tabindex="-1">Basic exampleï¼ˆåŸºæœ¬ä¾‹å­ï¼‰ <a class="header-anchor" href="#basic-exampleï¼ˆåŸºæœ¬ä¾‹å­ï¼‰">ğŸ”—</a></h2><h3 id="script-setup-now-directly-exposes-top-level-bindings-to-template" tabindex="-1"><code>&lt;script setup&gt;</code> now directly exposes top level bindings to template <a class="header-anchor" href="#script-setup-now-directly-exposes-top-level-bindings-to-template">ğŸ”—</a></h3><p><code>&lt;script setup&gt;</code>ç°åœ¨ä¼šç›´æ¥æš´éœ²é¡¶å±‚å˜é‡ç»‘å®šåˆ°æ¨¡æ¿ä¸Šï¼Œä¾‹å­å¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// imported components are also directly usable in template</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// å¯¼å…¥çš„ç»„ä»¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿å†…ä½¿ç”¨</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Foo</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./Foo.vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// write Composition API code just like in a normal setup()</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// but no need to manually return everything</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// å°±åƒä¸€ä¸ªæ­£å¸¸çš„setup()å‡½æ•°ä¸€æ ·ç¼–å†™Composition API</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ä½†æ˜¯ä¸éœ€è¦æ‰‹åŠ¨åœ°è¿”å›ä»»ä½•ä¸œè¥¿</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span><span style="--s-dark:#666666;--s-light:#999999"> }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  &lt;!--ä½¿ç”¨äº†Fooç»„ä»¶ï¼Œç±»å‹ä¸ºrefçš„countå˜é‡ï¼Œä»¥åŠincå‡½æ•°--&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#FDAEB7;--s-light:#B31D28">Foo</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> :count</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">count</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">inc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999"> /&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Foo</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./Foo.vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    const</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span><span style="--s-dark:#666666;--s-light:#999999"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      Foo</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // see note below</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      count</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      inc</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#FDAEB7;--s-light:#B31D28">Foo</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> :count</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">count</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">inc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999"> /&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><h3 id="ref-sugar-makes-use-of-refs-more-succinct" tabindex="-1"><code>ref:</code> sugar makes use of refs more succinct <a class="header-anchor" href="#ref-sugar-makes-use-of-refs-more-succinct">ğŸ”—</a></h3><p><code>ref:</code>è¯­æ³•ç³–ä½¿å¾—refså¯¹è±¡çš„ä½¿ç”¨å˜å¾—æ›´åŠ çš„ç®€æ´ï¼Œä¾‹å­å¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// declaring a variable that compiles to a ref</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// å£°æ˜ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶è½¬ä¸ºrefç±»å‹çš„ä¸€ä¸ªå˜é‡</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // the variable can be used like a plain value</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // å˜é‡å¯ä»¥åƒä¸€ä¸ªæ™®é€šçš„å€¼ä¸€æ ·ä½¿ç”¨</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // æ³¨ï¼šrefåœ¨æ¨¡æ¿ä¸­æ˜¯å¯ä»¥è‡ªåŠ¨æ‹†ç®±çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨setupå‡½æ•°å†…çš„é€»è¾‘ï¼Œæ˜¯éœ€è¦.valueæ¥å–å€¼è¿›è¡Œæ“ä½œçš„</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  count</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// access the raw ref object by prefixing with $</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// é€šè¿‡æ·»åŠ å‰ç¼€$æ¥è·å–ä¸€ä¸ªåŸrefå¯¹è±¡</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">inc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ count }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹å</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    function</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      count</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      inc</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">inc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ count }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><h2 id="motivationï¼ˆåŠ¨æœºï¼‰" tabindex="-1">Motivationï¼ˆåŠ¨æœºï¼‰ <a class="header-anchor" href="#motivationï¼ˆåŠ¨æœºï¼‰">ğŸ”—</a></h2><blockquote><p>This proposal has two main goals:</p></blockquote><p>è¿™ä¸ªææ¡ˆä¸»è¦æœ‰ä¸¤ä¸ªç›®çš„</p><blockquote><p>Reduce verbosity of Single File Component <code>&lt;script&gt;</code> by directly exposing its context to the template.</p></blockquote><blockquote><p>We have a prior proposal for <code>&lt;script setup&gt;</code> <a href="https://github.com/vuejs/rfcs/blob/sfc-improvements/active-rfcs/0000-sfc-script-setup.md" target="_blank" rel="noopener">here</a>, which is currently implemented (but marked as experimental). The old proposal opted for the <code>export</code> syntax so that the code would play well with unused variable checks.</p></blockquote><blockquote><p>This proposal takes a different direction based on the premise that we can offer customized linter rules in <code>eslint-plugin-vue</code>. This allows us to aim for the most succinct syntax possible.</p></blockquote><p>é€šè¿‡ç›´æ¥æš´éœ²è‡ªèº«ä¸Šä¸‹æ–‡ç»™æ¨¡æ¿æ¥å‡å°‘å•æ–‡ä»¶ç»„ä»¶ä¸­å†—é•¿çš„<code>&lt;script&gt;</code>æ ‡ç­¾ä¸­çš„ä»£ç </p><p>ä¹‹å‰æœ‰è¿‡ä¸€ä¸ªå¯¹<code>&lt;script setup&gt;</code>çš„ææ¡ˆï¼Œ<a href="https://github.com/vuejs/rfcs/blob/sfc-improvements/active-rfcs/0000-sfc-script-setup.md" target="_blank" rel="noopener">ç‚¹æˆ‘è·³è½¬</a>ï¼Œç°åœ¨è¿™ä¸ªç‰¹æ€§å·²ç»å®ç°äº†ï¼ˆä½†æ˜¯æ ‡è®°ä¸ºå®éªŒæ€§è´¨çš„ç‰¹æ€§ï¼‰ã€‚æ—§çš„ææ¡ˆé€‰æ‹©äº†<code>export</code>è¯­æ³•ï¼Œå› æ­¤ä»£ç å¯ä»¥åœ¨æ²¡æœ‰ä½¿ç”¨å˜é‡æ£€æŸ¥çš„æƒ…å†µä¸‹å¾ˆå¥½çš„è¿è¡Œã€‚</p><p>è¿™ä¸ªææ¡ˆé€‰æ‹©äº†ä¸€ä¸ªä¸åŒçš„æ–¹å‘ï¼ŒåŸºäºå¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨<code>eslint-plugin-vue</code>æä¾›ä¸€ä¸ªå®šåˆ¶çš„linterè§„åˆ™ã€‚è¿™æ ·ä½¿å¾—æˆ‘ä»¬å¯ä»¥å°½å¯èƒ½ä½¿ç”¨æœ€ç®€å•çš„è¯­æ³•ã€‚</p><blockquote><p>Improve ergonomics of refs with the <code>ref:</code> syntax sugar.</p></blockquote><blockquote><p>Ever since the introduction of the Composition API, one of the primary unresolved questions is the use of refs vs. reactive objects. It can be cumbersome to use <code>.value</code> everywhere, and it is easy to miss if not using a type system. Some users specifically lean towards using <code>reactive()</code> exclusively so that they donâ€™t have to deal with refs.</p></blockquote><blockquote><p>The existence of ref is mostly a design trade-off due to the constraints of the language we are working with: JavaScript. JavaScript does not provide a native way to pass reactive bindings around without wrapping it with an object. This means that <strong>it is impossible to use refs like normal variable bindings without altering or augmenting JavaScript semantics</strong>.</p></blockquote><p>é€šè¿‡<code>ref:</code>è¯­æ³•ç³–ä½¿å¾—refsç±»å‹æ›´åŠ ç¬¦åˆäººçš„ç›´è§‰ã€‚</p><p>è‡ªä»Composition APIçš„äº§ç”Ÿï¼Œä¸€ä¸ªæ²¡æœ‰è§£å†³çš„ä¸»è¦é—®é¢˜å°±æ˜¯ä½¿ç”¨refè¿˜æ˜¯reactiveã€‚åœ¨æ¯ä¸ªåœ°æ–¹<code>.value</code>æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨ç±»å‹ç³»ç»Ÿçš„æƒ…å†µä¸‹å¾ˆå®¹æ˜“å¿˜è®°æ·»åŠ <code>.value</code>ã€‚ä¸€äº›ç”¨æˆ·æ˜ç¡®åªä½¿ç”¨<code>reactive()</code>è¿™æ ·å°±å¯ä»¥é¿å…å»å¤„ç†refæƒ…å†µ</p><p>ç”±äºæˆ‘ä»¬æ‰€ä½¿ç”¨çš„JavaScriptè¯­è¨€çš„çº¦æŸï¼Œrefçš„å­˜åœ¨å¤§ä½“ä¸Šæ˜¯çš„ä¸€ä¸ªè®¾è®¡æƒè¡¡ã€‚JavaScriptæ— æ³•æä¾›ä¸€ä¸ªåŸç”Ÿçš„æ–¹å¼ï¼Œå³æ— æ³•åœ¨æ²¡æœ‰é€šè¿‡ä¸€ä¸ªå¯¹è±¡åŒ…è£…çš„æƒ…å†µä¸‹è¿›è¡Œå“åº”å¼åœ°ç»‘å®šã€‚è¿™æ„å‘³ç€åœ¨<strong>æ²¡æœ‰æ”¹å˜å’Œå¢åŠ JavaScriptè¯­ä¹‰çš„æƒ…å†µä¸‹åƒæ­£å¸¸å˜é‡ç»‘å®šä¸€æ ·ä½¿ç”¨refæ˜¯ä¸å¯èƒ½çš„</strong></p><blockquote><ul><li>There has been a proposal for <a href="https://github.com/rbuckton/proposal-refs" target="_blank" rel="noopener">adding native refs to JavaScript</a>, but it was designed to address a slightly different problem and doesnâ€™t seem to have received much attention.</li><li>A prominent example of altering JavaScript semantics in return for succinct syntax is <code>Svelte</code>. It <a href="https://github.com/vuejs/rfcs/blob/script-setup/active-rfcs/0000-script-setup.md#svelte-syntax-details" target="_blank" rel="noopener">appropriates a number of JavaScript syntax to express framework-specific behavior</a>.</li></ul></blockquote><ul><li>è™½ç„¶æœ‰ä¸€ä¸ªæ·»åŠ åŸç”ŸJavaScriptçš„refç±»å‹çš„ææ¡ˆï¼Œä½†æ˜¯å®ƒåªæ˜¯è¢«ç”¨äºè§£å†³ä¸€ä¸ªç•¥å¾®ä¸åŒçš„é—®é¢˜ï¼Œä¼¼ä¹æ²¡æœ‰å—åˆ°å¤ªå¤šçš„å…³æ³¨</li><li>æ”¹å˜JavaScriptè¿”å›è¯­ä¹‰ä½¿å…¶ç®€æ´çš„ä¸€ä¸ªè‘—åçš„ä¾‹å­æ˜¯<code>Svelte</code>ï¼Œå®ƒæŒªç”¨äº†JavaScriptä¸­çš„æ•°å­—è¯­æ³•æ¥è¡¨ç¤ºæ¡†æ¶ç‰¹å®šçš„è¡Œä¸ºã€‚</li></ul><blockquote><p>In the past, we have tried to stick to strict JavaScript semantics as much as possible. Deviating from standard JavaScript semantics has number of drawbacks, but we believe there is room for a pragmatic trade-off where "breaking out of the box" a little bit can result in substantial improvements in developer experience.</p></blockquote><p>åœ¨è¿‡å»ï¼Œæˆ‘ä»¬è¯•ç€å°½å¯èƒ½åœ°åšæŒä¸¥æ ¼çš„JavaScriptè¯­ä¹‰ã€‚åç¦»æ ‡å‡†åœ°JavaScriptè¯­ä¹‰ä¼šå¸¦æ¥è®¸å¤šçš„ç¼ºç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬ç›¸ä¿¡ç¨å¾®çš„è·³å‡ºä¸€ç‚¹å®ç”¨æƒè¡¡â€œå±‹å­â€å¯ä»¥ä¸ºå¼€å‘è€…çš„å®è·µå¸¦æ¥å®è´¨æ€§çš„æ”¹å–„ã€‚</p><h2 id="detailed-designï¼ˆè¯¦ç»†çš„è®¾è®¡ï¼‰" tabindex="-1">Detailed Designï¼ˆè¯¦ç»†çš„è®¾è®¡ï¼‰ <a class="header-anchor" href="#detailed-designï¼ˆè¯¦ç»†çš„è®¾è®¡ï¼‰">ğŸ”—</a></h2><h3 id="script-setup" tabindex="-1"><code>&lt;script setup&gt;</code> <a class="header-anchor" href="#script-setup">ğŸ”—</a></h3><blockquote><p>To opt-in to the syntax, add the setup attribute to the <code>&lt;script&gt;</code> block:</p></blockquote><p>ä¸ºäº†åŠ å…¥è¯­æ³•ï¼Œåœ¨<code>&lt;script&gt;</code>å—ä¸ŠåŠ å…¥<code>setup</code>å±æ€§</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// syntax enabled</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><strong>Top level bindings are exposed to template</strong></p></blockquote><blockquote><p>Any top-level bindings (both variables and imports) declared inside <code>&lt;script setup&gt;</code> are directly exposed to the template render context:</p></blockquote><p><strong>é¡¶å±‚çš„ç»‘å®šä¼šæš´éœ²ç»™æ¨¡æ¿</strong></p><p>å£°æ˜åœ¨<code>&lt;script setup&gt;</code>å—ä¸­çš„ä»»ä½•é¡¶å±‚çš„ç»‘å®šï¼ˆå˜é‡å’Œimportï¼‰ä¼šç›´æ¥æš´éœ²ç»™æ¨¡æ¿æ¸²æŸ“çš„ä¸Šä¸‹æ–‡</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Foo</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./Foo.vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> msg</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Hello!</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  &lt;!--ä½¿ç”¨äº†Fooç»„ä»¶å’Œmsgå˜é‡--&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#FDAEB7;--s-light:#B31D28">Foo</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ msg }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#FDAEB7;--s-light:#B31D28">Foo</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Foo</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./Foo.vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> msg</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Hello!</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // å¯¼å‡ºäº†ç»„ä»¶</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      Foo</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // å¯¼å‡ºäº†å˜é‡</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      msg</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#FDAEB7;--s-light:#B31D28">Foo</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ msg }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#FDAEB7;--s-light:#B31D28">Foo</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p>Note: The SFC compiler also extracts binding metadata from <code>&lt;script setup&gt;</code> and use it during template compilation. Therefore in the template, <code>Foo</code> can be used as a component even though itâ€™s returned from <code>setup()</code> instead of registered via <code>components</code> option.</p></blockquote><p>æ³¨æ„ï¼šå•æ–‡ä»¶ç»„ä»¶ç¼–è¯‘å™¨ä¹Ÿä¼šæå–<code>&lt;script setup&gt;</code>ä¸­ç»‘å®šçš„å…ƒæ•°æ®ï¼Œå¹¶åœ¨æ¨¡æ¿ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨ã€‚å› æ­¤åœ¨æ¨¡æ¿ä¸­ï¼Œ<code>Foo</code>å¯ä»¥è¢«å½“æˆä¸€ä¸ªç»„ä»¶æ¥ä½¿ç”¨ï¼Œå³ä½¿å®ƒæ˜¯é€šè¿‡<code>setup()</code>è¿”å›çš„è€Œä¸æ˜¯åœ¨<code>components</code>é€‰é¡¹ä¸­æ³¨å†Œçš„ã€‚</p><blockquote><p><strong>Setup Signature</strong></p></blockquote><blockquote><p>The value of the <code>setup</code> attribute will be used as the arguments of the <code>setup()</code> function:</p></blockquote><p><strong><code>setup</code>æ ‡è¯†</strong></p><p><code>setup</code>å±æ€§çš„å€¼è¢«ç”¨ä½œ<code>setup()</code>å‡½æ•°çš„å‚æ•°</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">&lt;!--è¿™é‡Œç»™setupè®¾ç½®çš„å€¼å¯ä»¥ç†è§£ä¸ºå’Œsetup()å‡½æ•°çš„å‚æ•°ä¸€æ ·--&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">props, { emit }</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ä½¿ç”¨props</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">emit</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">foo</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> emit</span><span style="--s-dark:#666666;--s-light:#999999"> })</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    emit</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">foo</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><strong>Declaring Component Options</strong></p></blockquote><blockquote><p><code>export default</code> can still be used inside <code>&lt;script setup&gt;</code> for declaring component options such as props. Note that the exported expression will be hoisted out of <code>setup()</code> scope so it wonâ€™t be able to reference variables declared in <code>&lt;script setup&gt;</code> (a compile error will be emitted in this case).</p></blockquote><p><strong>å£°æ˜ç»„ä»¶çš„é€‰é¡¹</strong></p><p><code>export default</code>ä»ç„¶å¯ä»¥åœ¨<code>&lt;script setup&gt;</code>ä¸­ä½¿ç”¨ï¼Œæ¥å£°æ˜ç»„ä»¶çš„é€‰é¡¹æ¯”å¦‚propsã€‚æ³¨æ„å¯¼å‡ºè¡¨è¾¾å¼ä¼šè¢«æå‡åˆ°<code>setup()</code>ä½œç”¨åŸŸä¹‹å¤–ï¼Œæ‰€ä»¥å®ƒä¸èƒ½å¼•ç”¨åˆ°å£°æ˜åœ¨<code>&lt;script setup&gt;</code>çš„å˜é‡ã€‚ï¼ˆåœ¨è¿™ä¸ªæƒ…å†µä¸‹ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼‰</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">props</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  props</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    msg</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> String</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34"> </span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ...({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    props</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      msg</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> String</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }),</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><strong>Top level await</strong></p></blockquote><blockquote><p>Top level <code>await</code> can be used inside <code>&lt;script setup&gt;</code>. The resulting <code>setup()</code> function will be made <code>async</code>:</p></blockquote><p>é¡¶å±‚çš„await</p><p>åœ¨<code>&lt;script setup&gt;</code>å†…é¡¶å±‚ä½¿ç”¨<code>await</code>è¯­æ³•ï¼Œæœ€ç»ˆçš„<code>setup()</code>å‡½æ•°ä¼šè¢«è®¾ç½®ä¸º<code>async</code></p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> post</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> await</span><span style="--s-dark:#80A665;--s-light:#59873A"> fetch</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#C98A7D;--s-light:#B56959">/api/post/1</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">).</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">json</span><span style="--s-dark:#666666;--s-light:#999999">())</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  async</span><span style="--s-dark:#80A665;--s-light:#59873A"> setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> post</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> await</span><span style="--s-dark:#80A665;--s-light:#59873A"> fetch</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#C98A7D;--s-light:#B56959">/api/post/1</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">).</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">r</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> r</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">json</span><span style="--s-dark:#666666;--s-light:#999999">())</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> post</span><span style="--s-dark:#666666;--s-light:#999999"> }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><strong>Ref Syntax</strong></p></blockquote><blockquote><p>Code inside <code>&lt;script setup&gt;</code> can use a special <code>ref:</code> declaration to declare variables that can be used as a normal variable, but are compiled into refs:</p></blockquote><p><strong>Refè¯­æ³•</strong></p><p>åœ¨<code>&lt;script setup&gt;</code>å†…å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„<code>ref:</code>å£°æ˜æ¥å£°æ˜æ­£å¸¸çš„å˜é‡ï¼Œä½†æ˜¯ä¼šè¢«ç¼–è¯‘æˆrefç±»å‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  count</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">inc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ count }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><code>ref: count = 0</code> is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/label" target="_blank" rel="noopener">labeled statement</a> which is syntactically valid in both JS/TS. However, we are using it as a variable declaration here. The compiler will:</p><ol><li>Convert it to a proper variable declaration</li><li>Wrap its initial value with ref()</li><li>Rewrite all references to count into count.value.</li></ol></blockquote><p><code>ref: count = 0</code>æ˜¯åŸºäºæ ‡è®°è¯­å¥ï¼Œè¿™ç§è¯­å¥åœ¨JSå’ŒTSä¸Šéƒ½æ˜¯è¯­ä¹‰ä¸Šåˆæ³•çš„ï¼Œç„¶è€Œåœ¨è¿™é‡Œæˆ‘ä»¬æŠŠå®ƒä½œä¸ºå˜é‡å£°æ˜æ¥ä½¿ç”¨ï¼Œç»è¿‡ç¼–è¯‘åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    function</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      count</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      inc</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><blockquote><p>Note that the syntax is opt-in: all Composition APIs can be used inside <code>&lt;script setup&gt;</code> without ref sugar:</p></blockquote><p>æ³¨æ„è¯­æ³•æ˜¯å¯é€‰çš„ï¼Œæ‰€æœ‰çš„Composition APIå¯ä»¥åœ¨<code>&lt;script setup&gt;</code>å†…ä¸ä½¿ç”¨refçš„è¯­æ³•ç³–</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">inc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ count }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">button</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><strong>Accessing Raw Ref</strong></p></blockquote><blockquote><p>It is common for an external composition function to expect a raw ref object as argument, so we need a way to access the raw underlying ref object for bindings declared via <code>ref:</code>. To deal with that, every <code>ref:</code> binding will have a corresponding <code>$</code>-prefixed counter part that exposes the raw ref:</p></blockquote><p><strong>è·å–åŸæ¥çš„ref</strong></p><p>åœ¨ä¸€ä¸ªå¤–éƒ¨çš„compositionå‡½æ•°æ¥æ”¶ä¸€ä¸ªåŸç”Ÿçš„refå¯¹è±¡ä½œä¸ºå‚æ•°æ˜¯å¾ˆå¸¸è§çš„è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼æ¥è·å–é€šè¿‡<code>ref:</code>å£°æ˜çš„åŸç”Ÿçš„åº•å±‚refå¯¹è±¡è¿›è¡Œç»‘å®šã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¯ä¸ª<code>ref:</code>ç»‘å®šä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„å‰ç¼€<code>$</code>åç§°æ¥æš´éœ²åŸç”Ÿçš„ref</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 1</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// $count è¡¨ç¤ºåŸç”Ÿçš„refå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨.valueæ¥è¿›è¡Œå–å€¼</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">$count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ç›´æ¥è¾“å‡ºï¼Œä¼šè¢«ç¼–è¯‘æˆcount.value</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 2</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watch</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">$count</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newCount</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">new count is: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newCount</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 1</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 2</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watch</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newCount</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">new count is: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newCount</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><blockquote><p><strong>Interaction with Non-Literals</strong></p></blockquote><blockquote><p><code>ref:</code> will wrap assignment values with <code>ref()</code>. If the value is already a ref, it will be returned as-is. This means we can use <code>ref:</code> with any function that returns a ref, for example <code>computed:</code></p></blockquote><p><strong>éå­—é¢é‡ç›¸äº’ä½œç”¨ï¼ˆemmmï¼Œè¿™é‡Œä¸çŸ¥é“è¦æ€ä¹ˆç¿»è¯‘â€¦ï¼‰</strong></p><p><code>ref:</code>ä¼šé€šè¿‡<code>ref()</code>å‡½æ•°åŒ…è£…åˆ†é…çš„å€¼ï¼Œå¦‚æœå€¼æ—©å·²æ˜¯ä¸€ä¸ªrefå¯¹è±¡ï¼Œå®ƒä¼šæŒ‰åŸæ ·è¢«è¿”å›ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•è¿”å›ä¸€ä¸ªrefå¯¹è±¡çš„å‡½æ•°ä½¿ç”¨<code>ref:</code>ï¼Œæ¯”å¦‚<code>computed</code></p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> plusOne</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ç›´æ¥ä½¿ç”¨plusOneï¼Œè€Œä¸éœ€è¦plusOne.value</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ä¹Ÿå°±æ˜¯ref: å®šä¹‰ä¸ç®¡å€¼æ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯refç±»å‹ï¼Œä¸€å¾‹å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ˆæ— éœ€.valueï¼‰ï¼Œä¼šè‡ªåŠ¨ç¼–è¯‘æˆ.value</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">plusOne</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 1</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// `ref()` around `computed()` is a no-op here since return value</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// from `computed()` is already a ref.</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// `ref()`åŒ…è£…`computed()`å¹¶ä¸ä¼šäº§ç”Ÿæ“ä½œï¼Œå› ä¸ºä»`computed()`è¿”å›çš„å€¼å·²ç»æ˜¯ä¸€ä¸ªrefå¯¹è±¡äº†ã€‚</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢çš„è¯­å¥ï¼Œç­‰åŒäºconst plusOne = computed(() =&gt; count.value + 1)ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼ˆ===ï¼‰</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// å› ä¸ºåœ¨åˆ›å»ºrefæ—¶ï¼Œä¼šåˆ¤æ–­å¯¹è±¡ä¸Šæ˜¯å¦å­˜åœ¨__v_isRefæ ‡å¿—ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œè€Œcomputedçš„è¿”å›å€¼æ˜¯å­˜åœ¨è¿™ä¸ªæ ‡å¿—çš„ï¼Œå¯ä»¥è¯´æˆcomputedæ˜¯ä¸€ç§ç‰¹æ®Šçš„ref</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> plusOne</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#80A665;--s-light:#59873A">computed</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span><span style="--s-dark:#666666;--s-light:#999999">))</span></span></code></pre><blockquote><p>Or, any custom composition function that returns a ref:</p></blockquote><p>æˆ–è€…ï¼Œä»»ä½•è¿”å›ä¸€ä¸ªrefçš„compositionå‡½æ•°</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> useMyRef</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./composables</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> myRef</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useMyRef</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">myRef</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ä¸éœ€è¦å» .value</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> useMyRef</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./composables</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// if useMyRef() returns a ref, it will be untouched</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// otherwise it's wrapped into a ref</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// å¦‚æœuseMyRef()è¿”å›äº†ä¸€ä¸ªrefï¼Œé‚£ä¹ˆä¸å˜ï¼Œå¦åˆ™ä¼šè¢«åŒ…è£…æˆä¸€ä¸ªrefå¯¹è±¡</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> myRef</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#80A665;--s-light:#59873A">useMyRef</span><span style="--s-dark:#666666;--s-light:#999999">())</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">myRef</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><blockquote><p>Note: if using TypeScript, this behavior creates a typing mismatch which we will discuss in TypeScript Integration below.</p></blockquote><p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨Typescriptï¼Œè¿™ç§è¡Œä¸ºå¯¼è‡´ç±»å‹ä¸åŒ¹é…ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ä¸‹æ–‡çš„TypeScript Integrationè¿›è¡Œè®¨è®º</p><blockquote><p><strong>Destructuring</strong></p></blockquote><blockquote><p>It is common for a composition function to return an object of refs. To declare multiple ref bindings with destructuring, we can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank" rel="noopener">Destructuring Assignment</a>:</p></blockquote><p><strong>è§£æ„</strong></p><p>å¯¹äºä¸€ä¸ªcompositionå‡½æ•°æ¥è¯´ï¼Œè¿”å›ä¸€ä¸ªrefå¯¹è±¡æ˜¯å¾ˆå¸¸è§çš„ï¼Œä¸ºäº†ä½¿ç”¨è§£æ„æ¥å£°æ˜å¤šé‡refç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> ({</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> y</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useMouse</span><span style="--s-dark:#666666;--s-light:#999999">())</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘ä¹‹åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> __x</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> y</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> __x</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useMouse</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">__x</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> y</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> toRef</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">__y</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><blockquote><p>Note: object destructuring must be wrapped in parens - this is JavaScriptâ€™s own syntax requirement to avoid ambiguity with a block statement.</p></blockquote><p>æ³¨æ„ï¼Œå¯¹è±¡è§£æ„å¿…é¡»ç”¨æ‹¬å·åŒ…èµ·æ¥ï¼Œè¿™æ—¶Jsè‡ªèº«è¯­æ³•çš„è¦æ±‚ï¼Œä¸ºäº†é¿å…åœ¨ä¸€ä¸ªå—å£°æ˜ä¸­äº§ç”Ÿæ¨¡æ£±ä¸¤å¯çš„è¯­ä¹‰ã€‚</p><blockquote><p><strong>TypeScript Integration</strong></p></blockquote><blockquote><p>To type setup arguments like props, slots and emit, simply declare them:</p></blockquote><p><strong>TypeScripté›†æˆ</strong></p><p>ä¸ºäº†ç»™setupçš„å‚æ•°ï¼Œæ¯”å¦‚propsï¼Œslotså’Œemitèµ‹äºˆç±»å‹ï¼Œå¯ä»¥ç®€å•åœ°å£°æ˜</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">props, { emit, slots }</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> lang</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> VNode</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// declare props using TypeScript syntax</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// this will be auto compiled into runtime equivalent!</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ä½¿ç”¨TypeScriptå£°æ˜propsï¼Œ</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// åœ¨è¿è¡Œç¯å¢ƒä¼šè¢«è‡ªåŠ¨ç¼–è¯‘</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">declare</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> props</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  msg</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// declare allowed emit signatures via overload</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// å£°æ˜å…è®¸emitç­¾åè¿›è¡Œé‡è½½</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">declare</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> emit</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">add</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> msg</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> void</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">declare</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> emit</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">remove</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> id</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> void</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// you can even declare slot types</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ç”šè‡³å¯ä»¥å£°æ˜slotçš„ç±»å‹</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">declare</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> slots</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  default</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">VNode</span><span style="--s-dark:#666666;--s-light:#999999">[]</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">emit</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">add</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p>Runtime props and emits declaration is automatically generated from TS typing to remove the need of double declaration and still ensure correct runtime behavior. Note that the props type declaration value cannot be an imported type, because the SFC compiler does not process external files to extract the prop names.</p></blockquote><p>è¿è¡Œæ—¶propså’Œemitsçš„å£°æ˜ä»TSç±»å‹ä¸­è‡ªåŠ¨ç”Ÿæˆï¼Œåˆ é™¤é‡å¤çš„å£°æ˜ä»¥ç¡®ä¿æ­£ç¡®çš„è¿è¡Œæ—¶çš„è¡Œä¸ºã€‚æ³¨æ„ï¼Œpropsç±»å‹å£°æ˜ä¸èƒ½æ˜¯ä¸€ä¸ªå¯¼å…¥çš„ç±»å‹ï¼Œå› ä¸ºå•æ–‡ä»¶ç»„ä»¶ç¼–è¯‘å™¨æ— æ³•å¤„ç†å¤–éƒ¨çš„æ–‡ä»¶æ¥æå–propçš„å­—æ®µ</p><p>ç»è¿‡ç¼–è¯‘åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> lang</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> VNode</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> defineComponent</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">declare</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> __emit__</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">add</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> msg</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> void</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">declare</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> function</span><span style="--s-dark:#80A665;--s-light:#59873A"> __emit__</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">remove</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> id</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> void</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">declare</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> slots</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  default</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">VNode</span><span style="--s-dark:#666666;--s-light:#999999">[]</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#80A665;--s-light:#59873A"> defineComponent</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // runtime declaration for props</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // è¿è¡Œæ—¶çš„propså£°æ˜ï¼Œåœ¨ç¼–è¯‘å‰æ˜¯æ²¡å†™è¿™ä¸ªçš„</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  props</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    msg</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#B8A965;--s-light:#998418"> type</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> String</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#B8A965;--s-light:#998418"> required</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999"> }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> as</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> unknown</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> as</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> undefined</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // runtime declaration for emits</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // è¿è¡Œæ—¶çš„emitå£°æ˜</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  emits</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">add</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">]</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> as</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> unknown</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> as</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> undefined</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">: { </span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999"> },</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> emit</span><span style="--s-dark:#666666;--s-light:#999999"> }: {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    emit</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#CB7676;--s-light:#AB5959">typeof</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> __emit__</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    slots</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">slots</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    attrs</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Record</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">any</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  })</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    emit</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">add</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">msg</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p>Details on runtime props generation:</p><ul><li>In dev mode, the compiler will try to infer corresponding runtime validation from the types. For example here <code>msg: String</code> is inferred from the <code>msg: string</code> type.</li><li>In prod mode, the compiler will generate the array format declaration to reduce bundle size (the props here will be compiled into <code>['msg']</code>)</li><li>The generated props declaration is force casted into <code>undefined</code> to ensure the user provided type is used in the emitted code.</li><li>The emitted code is still TypeScript with valid typing, which can be further processed by other tools.</li></ul></blockquote><p>åœ¨ç”Ÿæˆçš„è¿è¡Œæ—¶propsçš„ç»†èŠ‚</p><ul><li>å¼€å‘æ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨å°è¯•ä»ç±»å‹ä¸­æ¨æ–­å¯¹åº”çš„è¿è¡Œæ—¶æ ¡éªŒã€‚æ¯”å¦‚ä¾‹å­çš„<code>msg: String</code>ï¼Œä»<code>msg: string</code>ç±»å‹æ¨å¯¼è€Œæ¥ã€‚</li><li>ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆæ•°ç»„æ ¼å¼çš„propså£°æ˜ï¼Œç›®çš„ä¸ºå‡å°‘æ‰“åŒ…ç”Ÿæˆçš„ä½“ç§¯ï¼ˆåœ¨è¿™é‡Œpropsä¼šè¢«ç¼–è¯‘æˆ<code>['msg']</code>ï¼‰</li><li>ç”Ÿæˆçš„propså£°æ˜è¢«å¼ºåˆ¶è½¬æˆ<code>undefined</code>ï¼Œä»¥ç¡®ä¿ç”Ÿæˆçš„ä»£ç ä½¿ç”¨äº†ç”¨æˆ·æä¾›çš„ç±»å‹ã€‚</li><li>ç”Ÿæˆçš„ä»£ç ä»ç„¶æ˜¯åˆæ³•ç±»å‹çš„Typescriptï¼Œå¯ä»¥è¢«å…¶ä»–å·¥å…·è¿›ä¸€æ­¥çš„å¤„ç†ã€‚</li></ul><blockquote><p><strong>Ref Declaration and Raw Ref Access</strong></p></blockquote><blockquote><p>Unlike normal variable declarations, the <code>ref:</code> syntax has some special behavior in terms of typing:</p><ul><li>The declared variable always has the raw value type, regardless of whether the assigned value is a <code>Ref</code> type or not (always unwraps)</li><li>The accompanying <code>$</code>-prefixed raw access variable always has a <code>Ref</code> type. If the right hand side value type already extends <code>Ref</code>, it will be used as-is; otherwise it will be wrapped as <code>Ref&lt;T&gt;</code>. The following table demonstrates the resulting types of different usage:</li></ul></blockquote><p><strong>Refçš„å£°æ˜ä»¥åŠåŸç”ŸRefå¯¹è±¡çš„è·å–</strong></p><p>å’Œæ™®é€šçš„å˜é‡å£°æ˜ä¸åŒï¼Œå°±ç±»å‹è€Œè¨€<code>ref:</code>è¯­æ³•æœ‰ä¸€äº›ç‰¹åˆ«çš„è¡Œä¸ºï¼š</p><ul><li>å£°æ˜å˜é‡æ€»æ˜¯å«æœ‰åŸå§‹å€¼çš„ç±»å‹ï¼Œå°½ç®¡è¢«åˆ†é…çš„å€¼æ˜¯ä¸€ä¸ªRefç±»å‹æˆ–åˆ™ä¸æ˜¯ä¸€ä¸ªRefç±»å‹ï¼ˆæ€»æ˜¯ä¼šè¢«è§£é™¤åŒ…è£…ï¼‰</li><li>ä¼´éšçš„<code>$</code>å‰ç¼€çš„åŸç”Ÿè®¿é—®çš„å˜é‡æ€»ä¸ºä¸€ä¸ª<code>Ref</code>ç±»å‹ã€‚å¦‚æœå³å€¼ç±»å‹æ—©å·²ä¸ºä¸€ä¸ªç»§æ‰¿è‡ªRefçš„ç±»å‹ï¼Œå°†ä¼šç›´æ¥ä½¿ç”¨å®ƒï¼Œå¦åˆ™å°†ä¼šè¢«<code>Ref&lt;T&gt;</code>å‡½æ•°æ‰€åŒ…è£…</li></ul><table><thead><tr><th style="text-align:left">source</th><th style="text-align:left">resulting type for <code>count</code></th><th style="text-align:left">esulting type for <code>$count</code></th></tr></thead><tbody><tr><td style="text-align:left"><code>ref: count = 1</code></td><td style="text-align:left"><code>number</code></td><td style="text-align:left"><code>Ref&lt;number&gt;</code></td></tr><tr><td style="text-align:left"><code>ref: count = ref(1)</code></td><td style="text-align:left"><code>number</code></td><td style="text-align:left"><code>Ref&lt;number&gt;</code></td></tr><tr><td style="text-align:left"><code>ref: count = computed(() =&gt; 1)</code></td><td style="text-align:left"><code>number</code></td><td style="text-align:left"><code>ComputedRef&lt;number&gt;</code></td></tr><tr><td style="text-align:left"><code>ref: count = computed({ get:()=&gt;1, set:_=&gt;_ })</code></td><td style="text-align:left"><code>number</code></td><td style="text-align:left"><code>WritableComputedRef&lt;number&gt;</code></td></tr></tbody></table><blockquote><p>How to support this in Vetur is discussed in the appendix.</p></blockquote><p>å¦‚ä½•ä½¿å¾—Veturæ”¯æŒè¿™ä¸ªç‰¹æ€§åœ¨é™„å½•ä¸­è®¨è®º</p><blockquote><p><strong>Usage alongside normal <code>&lt;script&gt;</code></strong></p></blockquote><blockquote><p>There are some cases where the code must be executed in the module scope, for example:</p><ul><li>Declaring named exports</li><li>Global side effects that should only execute once. In such cases, a normal <code>&lt;script&gt;</code> block can be used alongside <code>&lt;script setup&gt;</code>:</li></ul></blockquote><p><strong>å’Œæ­£å¸¸çš„<code>&lt;script&gt;</code>æ ‡ç­¾ä½¿ç”¨</strong></p><p>åœ¨ä¸€äº›æƒ…å†µä»£ç å¿…é¡»åœ¨æ¨¡å—ä½œç”¨åŸŸä¸‹æ‰§è¡Œï¼Œæ¯”å¦‚</p><ul><li>å£°æ˜å…·åçš„å¯¼å‡º</li><li>åªä¼šæ‰§è¡Œä¸€æ¬¡çš„å…¨å±€å‰¯ä½œç”¨ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ­£å¸¸çš„<code>&lt;script&gt;</code>å—å¯ä»¥ä¸<code>&lt;script setup&gt;</code>ä¸€èµ·ä½¿ç”¨</li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">performGlobalSideEffect</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// this can be imported as `import { named } from './*.vue'`</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> named</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">performGlobalSideEffect</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> named</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      count</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><blockquote><p><strong>Usage restrictions</strong></p></blockquote><blockquote><p>Due to the difference in module execution semantics, code inside <code>&lt;script setup&gt;</code> relies on the context of an SFC. When moved into external <code>.js</code> or <code>.ts</code> files, it may lead to confusions for both developers and tools. Therefore, <code>&lt;script setup&gt;</code> cannot be used with the <code>src</code> attribute.</p></blockquote><p><strong>é™åˆ¶æ¡ä»¶</strong></p><p>ç”±äºæ¨¡å—æ‰§è¡Œè¯­ä¹‰çš„ä¸åŒï¼Œåœ¨<code>&lt;script setup&gt;</code>ä¸­çš„ä»£ç ä¾èµ–å•æ–‡ä»¶ç»„ä»¶çš„ä¸Šä¸‹æ–‡ã€‚å½“ç§»åŠ¨åˆ°å¤–éƒ¨çš„<code>.js</code>æˆ–è€…<code>.ts</code>æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šä½¿å¼€å‘è€…å’Œå·¥å…·å‘ç”Ÿæ··ä¹±ï¼Œå› æ­¤ï¼Œ<code>&lt;script setup&gt;</code>ä¸èƒ½å’Œsrcå±æ€§ä¸€èµ·ä½¿ç”¨</p><h3 id="drawbacksï¼ˆç¼ºç‚¹ï¼‰" tabindex="-1">Drawbacksï¼ˆç¼ºç‚¹ï¼‰ <a class="header-anchor" href="#drawbacksï¼ˆç¼ºç‚¹ï¼‰">ğŸ”—</a></h3><p><strong>Non-standard semantics</strong></p><p><strong>éæ ‡å‡†çš„è¯­ä¹‰</strong></p><blockquote><p>Some users may have strong aversion against non-standard semantics in their code. Many of the Vue team members held such concerns as well. However, consider that:</p></blockquote><p>ä¸€äº›ç”¨æˆ·å¯èƒ½å¼ºçƒˆåœ°åŒæ¶ä»£ç ä¸­çš„éæ ‡å‡†è¯­ä¹‰ã€‚è®¸å¤šVueå›¢é˜Ÿæˆå‘˜ä¹Ÿæœ‰è¿™æ ·çš„é¡¾è™‘ï¼Œç„¶è€Œï¼Œè€ƒè™‘ï¼š</p><blockquote><ul><li>Single file components look like HTML but isnâ€™t actually HTML. It already has its own required structure and implied behavior on how it works as a Vue component. When you see a <code>*.vue</code> file, you know it works differently from plain HTML.</li><li>Vue templates are syntactically valid HTML, but the directives are essentially syntax extensions to express framework-specific intent.</li><li>JSX has a spec, but isnâ€™t a standard. Itâ€™s a non-standard syntax extension to JavaScript.</li><li>TypeScript isnâ€™t a standard. Itâ€™s a proprietary superset of JavaScript.</li><li>Decorators has struggled to advance into the spec, yet is being widely used and Angular is completely built on top of it.</li></ul></blockquote><ul><li>å•æ–‡ä»¶ç»„ä»¶çœ‹èµ·æ¥åƒHTMLä½†æ˜¯å®é™…ä¸Šä¸æ˜¯HTMLï¼Œå®ƒæ—©å·²æ‹¥æœ‰è‡ªå·±éœ€è¦çš„ç»“æ„å’Œéšå«çš„è¡Œä¸ºï¼Œéšå«è¡Œä¸ºæŒ‡å®ƒå¦‚ä½•ä»¥ä¸€ä¸ªVueç»„ä»¶è¿›è¡Œå·¥ä½œã€‚å½“ä½ çœ‹è§ä¸€ä¸ª<code>*.vue</code>æ–‡ä»¶ï¼Œä½ æ˜ç™½å®ƒçš„è¿ä½œä¸æ™®é€šçš„HTMLä¸åŒã€‚</li><li>Vueçš„æ¨¡æ¿è¯­æ³•ä¸Šæ˜¯åˆæ³•çš„HTMLï¼Œä½†æ˜¯æŒ‡ä»¤æœ¬è´¨ä¸Šæ˜¯ä¸ºäº†è¡¨è¾¾æ¡†æ¶ç‰¹å®šçš„æ„å›¾çš„è¯­æ³•çš„æ‰©å±•</li><li>JSXæ˜¯ä¸€ç§è§„èŒƒï¼Œä½†ä¸æ˜¯ä¸€ç§æ ‡å‡†ã€‚æ˜¯ä¸€ç§æ‰©å±•äº†JavaScriptçš„éæ ‡å‡†è¯­æ³•</li><li>TypeScriptä¸æ˜¯ä¸€ç§æ ‡å‡†ã€‚æ˜¯JavaScriptçš„ä¸€ä¸ªä¸“é—¨çš„è¶…é›†ã€‚</li><li>è£…é¥°å™¨ç‰¹æ€§è¿˜åœ¨åŠªåŠ›åœ°è¿›å…¥è§„èŒƒï¼Œä½†æ˜¯å®ƒå·²ç»è¢«å¹¿æ³›ä½¿ç”¨å¹¶ä¸”Angularåœ¨æ­¤ä¹‹ä¸Šè¿›è¡Œå®Œæ•´æ„å»º</li></ul><blockquote><p>Granted, adding non-standard semantics to JavaScript still creates added learning cost and mental overhead, so we should carefully evaluate the trade-offs of each addition.</p></blockquote><p>å³ä½¿è¿™æ ·ï¼Œç»™JavaScriptæ·»åŠ ä¸€ä¸ªéæ ‡å‡†çš„è¯­ä¹‰ä»ç„¶å¢åŠ äº†å­¦ä¹ æˆæœ¬å’Œç²¾ç¥è´Ÿæ‹…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹æ¯ä¸ªæ·»åŠ çš„ç‰¹æ€§éƒ½å°å¿ƒåœ°è¯„ä¼°æƒè¡¡ã€‚</p><blockquote><p>With that in mind, we believe <code>ref:</code>'s ergonomics value easily outweighs the cost. This is also why we are limiting this proposal to <code>ref:</code> only, since ref access is the only problem that requires alternative semantics to solve.</p></blockquote><p>è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç›¸ä¿¡<code>ref:</code>çš„å·¥ç¨‹ä»·å€¼ç®€å•åœ°èƒœè¿‡æˆæœ¬ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»…é™åˆ¶ææ¡ˆä¸º<code>ref:</code>ï¼Œå› ä¸ºrefçš„è®¿é—®æ˜¯éœ€è¦é€‰æ‹©ä½¿ç”¨è¯­ä¹‰æ¥è§£å†³çš„å”¯ä¸€é—®é¢˜ã€‚</p><blockquote><p>It can also be argued that the <code>ref:</code> syntax isnâ€™t far too removed from standard JavaScript. The following code is actually valid JavaScript in non-strict mode - if you copy it into an <code>.html</code> file, it will run as expected:</p></blockquote><p>ä¹Ÿå¯ä»¥è¯´<code>ref:</code>è¯­æ³•å’Œæ ‡å‡†çš„JavaScriptç›¸è·ä¸è¿œã€‚ä¸‹é¢çš„ä»£ç å®é™…ä¸Šåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯åˆæ³•çš„JavaScriptä»£ç ï¼Œå¦‚æœä½ æŠŠå®ƒå¤åˆ¶åˆ°ä¸€ä¸ªhtmlæ–‡ä»¶ä¸­ï¼Œå®ƒä¼šæŒ‰ç…§é¢„æœŸæ‰§è¡Œ</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><strong>Yet Another Way of Doing Things</strong></p></blockquote><p><strong>å¦ä¸€ç§ç¼–ç æ–¹å¼</strong></p><blockquote><p>Some may think that Vue already has Options API, Composition API, and Class API (outside of core, as a library) - and this RFC is adding yet another way of authoring a component. This is a valid concern, but it does not warrant an instant dismissal. When we talk about the drawbacks of "different ways of doing the same thing", the more fundamental issue is the learning cost incurred when a user encounters code written in another format he/she is not familiar with. It is therefore important to evaluate the addition based on the trade-off between:</p></blockquote><p>ä¸€äº›ç”¨äºå¯èƒ½è®¤ä¸ºVueå·²ç»æœ‰äº†åŸºäºé…ç½®çš„API, åŸºäºç»„åˆçš„API, å’ŒåŸºäºç±»çš„APIï¼ˆåœ¨æ ¸å¿ƒä»£ç å¤–éƒ¨ï¼Œä½œä¸ºä¸€ä¸ªåº“ï¼‰ï¼Œç°åœ¨è¿™ä¸ªRFCåˆæ·»åŠ äº†å¦ä¸€ç§ä¹¦å†™ç»„ä»¶çš„æ–¹å¼ã€‚è¿™æ˜¯åˆç†çš„å¿§è™‘ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯ç«‹å³å¾—åˆ°è§£å†³ã€‚å½“æˆ‘ä»¬è®¨è®ºåšç›¸åŒäº‹æƒ…çš„ä¸åŒæ–¹å¼çš„ç¼ºç‚¹æ—¶ï¼Œæ›´åŸºæœ¬çš„é—®é¢˜æ˜¯å¸¦æ¥äº†å­¦ä¹ æˆæœ¬ï¼Œç”¨æˆ·ä¼šé‡åˆ°ä»¥å¦ä¸€ç§ä»–ä¸ç†Ÿæ‚‰çš„æ ¼å¼ä¹¦å†™çš„ä»£ç ï¼Œå› æ­¤ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹é¢çš„æƒè¡¡æ¥è¯„ä¼°æ·»åŠ è¿›æ¥çš„ç‰¹æ€§éå¸¸çš„é‡è¦</p><blockquote><ul><li>How much benefit does the new way provide?</li><li>How much learning cost does the new way introduce?</li></ul></blockquote><ul><li>æ–°æ–¹å¼å¯ä»¥æä¾›å¤šå¤§çš„ç›Šå¤„</li><li>æ–°æ–¹å¼çš„å­¦ä¹ æˆæœ¬æœ‰å¤šé«˜</li></ul><blockquote><p>This is what we did with the Composition API because we believed the scaling benefits provided by Composition API outweighs its learning cost.</p></blockquote><p>æˆ‘ä»¬ä½¿ç”¨Composition APIå› ä¸ºæˆ‘ä»¬è®¤ä¸ºComposition APIå¸¦æ¥çš„ä¼˜åŠ¿è¶…è¿‡äº†å®ƒçš„å­¦ä¹ æˆæœ¬ã€‚</p><blockquote><p>Unlike the relatively significant paradigm difference between Options API and Composition API, this RFC is merely syntax sugar with the primary goal of reducing verbosity. It does not fundamentally alter the mental model. Without the ref sugar, Composition API code inside <code>&lt;script setup&gt;</code> will be 100% the same with normal Composition API usage (except for the lack of the return object, which is tedious and unnecessary in the first place). The <code>ref:</code> sugar is an extension of the ref concept: for a user with prior knowledge of Composition API, it shouldnâ€™t be difficult to quickly understand how it works.</p></blockquote><p>ä¸åƒOptions APIå’ŒComposition APIé‚£æ ·ç›¸å¯¹é‡å¤§çš„æ ·å¼å·®è·ï¼Œè¿™ä¸ªRFCä»…ä»…æ˜¯ä¸€ä¸ªä¸»è¦ç›®çš„ä¸ºå‡å°‘å†—é•¿çš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå¹¶ä¸ä¼šä»æ ¹æœ¬ä¸Šæ”¹å˜å¿ƒæ™ºæ¨¡å‹ã€‚æ²¡æœ‰refè¯­æ³•ç³–ï¼Œåœ¨<code>&lt;script setup&gt;</code>ä¹¦å†™çš„Composition APIå’Œæ™®é€šçš„Composition APIç”¨æ³•100%ç›¸åŒï¼ˆé™¤äº†ç¼ºå°‘ä¸€ä¸ªè¿”å›çš„å¯¹è±¡ï¼Œé¦–å…ˆå®ƒå°±æ˜¯å•°å—¦å’Œæ²¡æœ‰å¿…è¦çš„ï¼‰ã€‚<code>ref:</code>è¯­æ³•ç³–æ˜¯å¯¹refæ¦‚å¿µçš„æ‰©å±•ï¼Œå¯¹äºæœ‰å…ˆäº†è§£è¿‡Composition APIçš„ç”¨æˆ·æ¥è¯´ï¼Œå¿«é€Ÿåœ°ç†è§£å®ƒåœ°å·¥ä½œæ–¹å¼åº”è¯¥ä¸ä¼šå›°éš¾ã€‚</p><blockquote><p>That is to say - the syntax proposed in this RFC will not make the code more difficult to understand for someone who already knows Composition API. The initial time needed for a user to learn the syntax should be trivial compared to the improved DX in the long run.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬RFCåœ°è¯­æ³•ææ¡ˆä¸ä¼šä½¿å¾—é‚£äº›å·²ç»çŸ¥é“Composition APIçš„ç”¨æˆ·ç†è§£ä»£ç å˜å¾—æ›´å›°éš¾ã€‚åˆšå¼€å§‹å¯¹äºç”¨æˆ·å»å­¦ä¹ è¯­æ³•ä¸é•¿è¿œä¸Šæ”¹å–„ç›¸æ¯”æ˜¯ä¸é‡è¦çš„ã€‚</p><blockquote><p><strong>Requires dedicated tooling support</strong></p></blockquote><p><strong>éœ€è¦ä¸“é—¨çš„å·¥å…·æ”¯æŒ</strong></p><blockquote><p>Appropriating the labeled statement syntax creates a semantic mismatch that leads to integration issues with tooling (linter, TypeScript, IDE support).</p></blockquote><p>æŒªç”¨äº†æ ‡ç­¾è¯­å¥è¯­æ³•é€ æˆè¯­ä¹‰ä¸åŒ¹é…ï¼Œå¯¼è‡´å·¥å…·æ•´åˆé—®é¢˜ï¼ˆå·¥å…·åŒ…æ‹¬linterï¼ŒTypeScriptï¼ŒIDEæ”¯æŒæ’ä»¶ï¼‰</p><blockquote><p>This was also one of the primary reservations we had about Svelte 3â€™s design when it was initially proposed. However since then, the Svelte team has managed to provide good tooling/IDE support via its language tools, even for TypeScript.</p></blockquote><p>åœ¨ææ¡ˆæœ€åˆæå‡ºæ—¶ï¼Œå€Ÿç”¨äº†Svelte 3çš„è®¾è®¡ä¹Ÿæ˜¯ä¸€ä¸ªä¸»è¦çš„é¢„æƒ³ï¼Œä½†æ˜¯è‡ªä»é‚£æ—¶èµ·ï¼ŒSvelteçš„å›¢é˜Ÿè®¾æ³•é€šè¿‡å®ƒçš„è¯­è¨€å·¥å…·æä¾›å¾ˆæ£’çš„å·¥å…·æˆ–è€…IDEçš„æ”¯æŒç”šè‡³æ˜¯TypeScriptæ”¯æŒã€‚</p><blockquote><p>Vueâ€™s single file component also already requires dedicated tooling like <code>eslint-plugin-vue</code> and Vetur. The team has already discussed the technical feasibility of providing such support and there should be no hard technical blocks to make it work. We are confident that we can provide:</p></blockquote><p>Vueçš„å•æ–‡ä»¶ç»„ä»¶ä¹Ÿå·²ç»éœ€è¦ä¸“ç”¨çš„å·¥å…·æ¯”å¦‚<code>eslint-plugin-vue</code>å’ŒVeturã€‚Vueå›¢é˜Ÿå·²ç»è®¨è®ºæä¾›æ”¯æŒçš„æŠ€æœ¯å¯è¡Œæ€§ï¼Œä½¿å®ƒèƒ½å¤Ÿå·¥ä½œåº”è¯¥æ²¡æœ‰æŠ€æœ¯éš¾ç‚¹ã€‚æˆ‘ä»¬æœ‰ä¿¡å¿ƒèƒ½å¤Ÿæä¾›å¦‚ä¸‹çš„ç‰¹æ€§ï¼š</p><blockquote><ul><li>Special syntax highlight of <code>ref:</code> declared variables in Vetur (so that itâ€™s more obvious itâ€™s a reactive variable)</li><li>Proper type check via Vetur and dedicated command line checker</li><li>Proper linting via <code>eslint-plugin-vue</code></li></ul></blockquote><ul><li>åœ¨Veturä¸­ï¼Œå¯¹<code>ref:</code>å®šä¹‰çš„å˜é‡æœ‰ç‰¹æ®Šçš„è¯­æ³•é«˜äº®ã€‚ï¼ˆä»¥ä¾¿æ›´æ˜æ˜¾çš„è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå“åº”å¼çš„å˜é‡ï¼‰</li><li>é€šè¿‡Veturå¯ä»¥æœ‰æ­£ç¡®çš„ç±»å‹æ£€æŸ¥ä»¥åŠä¸“é—¨çš„å‘½ä»¤è¡Œæ£€æŸ¥å·¥å…·</li><li>é€šè¿‡<code>eslint-plugin-vue</code>å¯ä»¥æœ‰æ­£ç¡®çš„ä»£ç è§„èŒƒ</li></ul><blockquote><p><strong>Extracting in-component logic</strong></p></blockquote><p><strong>æå–ç»„ä»¶å†…çš„é€»è¾‘</strong></p><blockquote><p>The <code>ref:</code> syntax sugar is only available inside single file components. Different syntax in and out of components makes it difficult to extract and reuse cross-component logic from existing components.</p></blockquote><p><code>ref:</code>è¯­æ³•ç³–åªèƒ½åœ¨å•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ã€‚ç»„ä»¶å†…å¤–çš„ä¸åŒè¯­æ³•ä½¿å¾—ä»å­˜åœ¨çš„ç»„ä»¶ä¸­æå–å’Œé‡ç”¨è·¨ç»„ä»¶çš„é€»è¾‘å˜å¾—å›°éš¾ã€‚</p><blockquote><p>This is still an issue for Svelte, since Svelte compilation strategy only works inside Svelte components. The generated code assumes a component context and isnâ€™t human-maintainable.</p></blockquote><p>å¯¹äºSvelteè¿™ä»ç„¶æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºSvelteç¼–è¯‘ç­–ç•¥åªå¯ä»¥åœ¨Svelteç»„ä»¶ä¸­å·¥ä½œã€‚ç”Ÿæˆçš„ä»£ç æ˜¯ç»„ä»¶çš„ä¸Šä¸‹æ–‡äº†ï¼Œä¹Ÿå°±æ˜¯æ— æ³•è¿›è¡Œäººä¸ºçš„ç»´æŠ¤ã€‚</p><blockquote><p>In Vueâ€™s case, what we are proposing here is a very thin syntax sugar on top of idiomatic Composition API code. The most important thing to note here is that the code written with the sugar can be easily de-sugared into what a developer would have written without the sugar, and extracted into external JavaScript files for composition.</p></blockquote><p>åœ¨Vueçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªææ¡ˆæ˜¯å¸¸ç”¨Composition APIä»£ç ä¸­çš„ä¸€ä¸ªéå¸¸è–„çš„è¯­æ³•ç³–ã€‚æœ€é‡è¦çš„æ˜¯ä¹¦å†™å¸¦æœ‰è¯­æ³•ç³–çš„ä»£ç å¯ä»¥è¢«ç®€å•åœ°å»ç³–ï¼Œå°±åƒå¼€å‘è€…ç¼–å†™ä¸å¸¦è¯­æ³•ç³–çš„ä»£ç ï¼Œç„¶åæå–åˆ°å¤–éƒ¨çš„æ–‡ä»¶ä¸­è¿›è¡Œæ•´åˆã€‚</p><blockquote><p>Given a piece of code written using the <code>ref:</code> sugar, the workflow of extracting it into an external composition function could be:</p></blockquote><p>ä¸€æ®µä½¿ç”¨äº†<code>ref:</code>è¯­æ³•ç³–çš„ä»£ç ï¼Œæå–åˆ°å¤–éƒ¨ç»„åˆå‡½æ•°çš„å·¥ä½œæµå¦‚ä¸‹ï¼š</p><blockquote><ul><li>Select code range for the code to be extracted</li><li>In VSCode command input: <code>&gt;vetur de-sugar ref usage</code></li><li>Code gets de-sugared</li><li>Cut-paste code into external file and wrap into an exported function</li><li>Import the function in original file and replace original code.</li></ul></blockquote><ul><li>é€‰æ‹©æå–ä»£ç çš„èŒƒå›´</li><li>åœ¨VSCodeå‘½ä»¤è¡Œè¾“å…¥<code>&gt;vetur de-sugar ref usage</code></li><li>ä»£ç è¢«å»ç³–</li><li>ç²˜è´´ä»£ç åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­ï¼ŒåŒ…è£¹åœ¨ä¸€ä¸ªå¯¼å‡ºå‡½æ•°ä¸­</li><li>åœ¨æºæ–‡ä»¶ä¸­å¯¼å…¥å‡½æ•°ï¼Œç„¶åå–ä»£æºä»£ç </li></ul><h2 id="alternativesï¼ˆå¯é€‰æ–¹æ¡ˆï¼‰" tabindex="-1">Alternativesï¼ˆå¯é€‰æ–¹æ¡ˆï¼‰ <a class="header-anchor" href="#alternativesï¼ˆå¯é€‰æ–¹æ¡ˆï¼‰">ğŸ”—</a></h2><blockquote><p><strong>Comment-based syntax</strong></p></blockquote><p>åŸºäºæ³¨é‡Šçš„è¯­æ³•</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Foo</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./Foo.vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> computed</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// æ·»åŠ '@ref'æ³¨é‡Šæ¥è¡¨ç¤º</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// @ref</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> inc</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  count</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#FDAEB7;--s-light:#B31D28">Foo</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> :count</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">count</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> @click</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">inc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999"> /&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p><strong>Other related proposals</strong></p></blockquote><p>å…¶ä»–ç›¸å…³çš„ææ¡ˆ</p><blockquote><ul><li><a href="https://github.com/vuejs/rfcs/pull/182" target="_blank" rel="noopener">https://github.com/vuejs/rfcs/pull/182</a> (current <code>&lt;script setup&gt;</code> implementationï¼ˆå½“å‰<code>&lt;script setup&gt;</code>çš„å®ç°ï¼‰)</li><li><a href="https://github.com/vuejs/rfcs/pull/213" target="_blank" rel="noopener">https://github.com/vuejs/rfcs/pull/213</a></li><li><a href="https://github.com/vuejs/rfcs/pull/214" target="_blank" rel="noopener">https://github.com/vuejs/rfcs/pull/214</a></li></ul></blockquote><h2 id="adoption-strategyï¼ˆé‡‡çº³çš„ç­–ç•¥ï¼‰" tabindex="-1">Adoption strategyï¼ˆé‡‡çº³çš„ç­–ç•¥ï¼‰ <a class="header-anchor" href="#adoption-strategyï¼ˆé‡‡çº³çš„ç­–ç•¥ï¼‰">ğŸ”—</a></h2><blockquote><p>This feature is opt-in. Existing SFC usage is unaffected.</p></blockquote><p>æœ¬ç‰¹æ€§æ˜¯å¯é€‰çš„ï¼Œå·²å­˜åœ¨çš„å•æ–‡ä»¶ç»„ä»¶ç”¨æ³•ä¸å—å½±å“ã€‚</p><h2 id="unresolved-questionsï¼ˆæœªè§£å†³çš„é—®é¢˜ï¼‰" tabindex="-1">Unresolved questionsï¼ˆæœªè§£å†³çš„é—®é¢˜ï¼‰ <a class="header-anchor" href="#unresolved-questionsï¼ˆæœªè§£å†³çš„é—®é¢˜ï¼‰">ğŸ”—</a></h2><blockquote><p>Ref Usage in Nested Function Scopes</p></blockquote><p>åµŒå¥—å‡½æ•°ä½œç”¨åŸŸä¸‹Refçš„ç”¨æ³•ã€‚</p><blockquote><p>Technically, <code>ref:</code> doesnâ€™t have to be limited to root level scope and can be used anywhere <code>let</code> declarations can be used, including nested function scope:</p></blockquote><p>åœ¨æŠ€æœ¯ä¸Šï¼Œ<code>ref:</code>ä¸èƒ½è¢«é™åˆ¶åœ¨æ ¹ä½œç”¨ä¸‹ï¼Œåº”è¯¥å¯ä»¥åœ¨<code>let</code>å®šä¹‰ä¹‹åçš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼ŒåŒ…æ‹¬åµŒå¥—çš„å‡½æ•°ä½œç”¨åŸŸï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> useMouse</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> y</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> update</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    x</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> e</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">pageX</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    y</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> e</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">pageY</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  onMounted</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> window</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">addEventListener</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">mousemove</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> update</span><span style="--s-dark:#666666;--s-light:#999999">))</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  onUnmounted</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> window</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">removeEventListener</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">mousemove</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> update</span><span style="--s-dark:#666666;--s-light:#999999">))</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    x</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $x</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    y</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $y</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>ç»è¿‡ç¼–è¯‘åå¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> useMouse</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> y</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  function</span><span style="--s-dark:#80A665;--s-light:#59873A"> update</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    x</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> e</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">pageX</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    y</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> e</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">pageY</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  onMounted</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> window</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">addEventListener</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">mousemove</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> update</span><span style="--s-dark:#666666;--s-light:#999999">))</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  onUnmounted</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> window</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">removeEventListener</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">mousemove</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> update</span><span style="--s-dark:#666666;--s-light:#999999">))</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    x</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    y</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><blockquote><p>This will make the compilation (and accompanying linter / language service support) more complicated - Iâ€™m not sure if itâ€™s better to limit <code>ref:</code> usage to top scope bindings only.</p></blockquote><p>è¿™ä¼šä½¿å¾—ç¼–è¯‘è¿‡ç¨‹ï¼ˆä¼´éšæ£€æµ‹/è¯­è¨€æœåŠ¡çš„æ”¯æŒï¼‰å˜å¾—å¤æ‚ã€‚æˆ‘ä¸ç¡®å®šé™åˆ¶<code>ref:</code>åªåœ¨é¡¶å±‚ä½œç”¨åŸŸç»‘å®šçš„ç”¨æ³•æ˜¯å¦æ›´å¥½ã€‚</p><h2 id="appendixï¼ˆé™„å½•ï¼‰" tabindex="-1">Appendixï¼ˆé™„å½•ï¼‰ <a class="header-anchor" href="#appendixï¼ˆé™„å½•ï¼‰">ğŸ”—</a></h2><blockquote><p><strong>Transform API</strong></p></blockquote><blockquote><p>The <code>@vue/compiler-sfc</code> package exposes the <code>compileScript</code> method for processing <code>&lt;script setup&gt;</code>:</p></blockquote><p><strong>è½¬æ¢çš„API</strong></p><p><code>@vue/compiler-sfc</code>åŒ…æš´éœ²äº†ç¼–è¯‘è„šæœ¬çš„æ–¹æ³•æ¥å¤„ç†<code>&lt;script setup&gt;</code></p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> parse</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> compileScript</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">@vue/compiler-sfc</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> descriptor</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> parse</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#C98A7D;--s-light:#B56959">...</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">`</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">descriptor</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">script</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ||</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> descriptor</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">scriptSetup</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> result</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> compileScript</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">descriptor</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // returns SFCScriptBlock</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">result</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">code</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">result</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">bindings</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // see next section</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><blockquote><p>The compilation requires the entire descriptor to be provided, and the resulting code will include sources from both <code>&lt;script setup&gt;</code> and normal <code>&lt;script&gt;</code> (if present). It is the higher level toolsâ€™ (e.g. vite or vue-loader) responsibility to properly assemble the compiled output.</p></blockquote><p>ç¼–è¯‘è¿‡ç¨‹éœ€è¦æä¾›æ•´ä¸ªæè¿°ç¬¦ï¼Œç»“æœä»£ç å°†ä¼šåŒ…å«ä»<code>&lt;script setup&gt;</code>å’Œæ­£å¸¸<code>&lt;script&gt;</code>ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰çš„æºä»£ç ã€‚æ­£ç¡®åœ°ç»„åˆç¼–è¯‘è¾“å‡ºåœ°ä»£ç æ˜¯ä¸€ä¸ªé«˜çº§å·¥å…·ï¼ˆæ¯”å¦‚<code>vite</code>æˆ–è€…<code>vue-loader</code>ï¼‰çš„è´£ä»»</p><blockquote><p><strong>Template binding optimization</strong></p></blockquote><blockquote><p>The <code>SFCScriptBlock</code> returned by <code>compiledScript</code> also exposes a <code>bindings</code> object, which is the exported binding metadata gathered during the compilation. For example, given the following <code>&lt;script setup&gt;</code>:</p></blockquote><p><strong>æ¨¡æ¿ç»‘å®šä¼˜åŒ–</strong></p><p>é€šè¿‡<code>compiledScript</code>è¿”å›çš„å•æ–‡ä»¶ç»„ä»¶çš„è„šæœ¬å—æš´éœ²äº†ä¸€ä¸ª<code>bindings</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯¼å‡ºäº†ç»‘å®šçš„åœ¨ç¼–è¯‘æ—¶æ”¶é›†çš„å…ƒæ•°æ®ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µ<code>&lt;script setup&gt;</code>ä»£ç </p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">props</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> foo</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  props</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">bar</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">]</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><blockquote><p>The <code>bindings</code> object will be:</p></blockquote><p><code>bindings</code>å¯¹è±¡å°†ä¼šæ˜¯ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">{</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  foo</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">setup</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  bar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">props</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><blockquote><p>This object can then be passed to the template compiler:</p></blockquote><p>è¿™ä¸ªå¯¹è±¡ä¹‹åå¯ä»¥ä¼ é€’ç»™æ¨¡æ¿ç¼–è¯‘å™¨ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> compile</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">@vue/compiler-dom</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">compile</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">template</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  bindingMetadata</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> bindings</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><blockquote><p>With the binding metadata available, the template compiler can generate code that directly access template variables from the corresponding source, without having to go through the render context proxy:</p></blockquote><p>é€šè¿‡è·å¾—çš„å…ƒæ•°æ®ï¼Œæ¨¡æ¿ç¼–è¯‘å™¨å¯ä»¥ç”Ÿæˆç›´æ¥ä»å¯¹åº”æºæ–‡ä»¶è·å–æ¨¡æ¿å˜é‡çš„ä»£ç ï¼Œæ— éœ€å†å»æŸ¥æ‰¾æ¸²æŸ“ä¸Šä¸‹æ–‡ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ foo + bar }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// code generated without bindingMetadata</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// here _ctx is a Proxy object that dynamically dispatches property access</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// æ²¡æœ‰ç»‘å®šå…ƒæ•°æ®çš„ä»£ç </span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// è¿™é‡Œ _ctx æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¯ä»¥åŠ¨æ€åœ°å–å‡ºå±æ€§</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> render</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">_ctx</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#80A665;--s-light:#59873A"> createVNode</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">div</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> null</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> _ctx</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">foo</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> _ctx</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">bar</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// code generated with bindingMetadata</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// bypasses the render context proxy</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ç»‘å®šäº†å…ƒæ•°æ®çš„ä»£ç </span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ç»•è¿‡äº†æ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†å¯¹è±¡</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> render</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">_ctx</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> _cache</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $setup</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $props</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $data</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#80A665;--s-light:#59873A"> createVNode</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">div</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> null</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $setup</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">foo</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">bar</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><blockquote><p><strong>Ref TypeScript Support Implementation Details</strong></p></blockquote><blockquote><p>There are two issues that prevent <code>ref:</code> from working out of the box with TypeScript. Given the following code:</p></blockquote><p><strong>Refçš„TypeScriptæ”¯æŒçš„å®ç°ç»†èŠ‚</strong></p><p>è¿™æœ‰ä¸¤ä¸ªé—®é¢˜åœ¨é˜²æ­¢<code>ref:</code>ä¸TypeScriptç›´æ¥ä½¿ç”¨ã€‚æ¯”å¦‚ä¸‹é¢ä»£ç </p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span></span></code></pre><blockquote><ul><li>TS wonâ€™t know <code>count</code> should be treated as a local variable</li><li>If <code>x</code> has type <code>Ref&lt;T&gt;</code>, there will be a type mismatch since we expect to use <code>count</code> as <code>T</code>.</li></ul></blockquote><ul><li>TSä¸çŸ¥é“<code>count</code>åº”è¯¥è¢«å½“æˆä¸€ä¸ªå±€éƒ¨å˜é‡æ¥å¤„ç†</li><li>å¦‚æœxçš„ç±»å‹ä¸º<code>Ref&lt;T&gt;</code>ï¼Œå½“æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨countä½œä¸ºæ³›å‹Tæ—¶ä¼šäº§ç”Ÿç±»å‹ä¸åŒ¹é…</li></ul><blockquote><p>The general idea is to pre-transform the code into alternative TypeScript for type checking only (different from runtime-oriented output), get the diagnostics, and map them back. This will be performed by Vetur for IDE intellisense, and via a dedicated command line tool for type checking <code>*.vue</code> files (e.g. VTI or <code>@vuedx/typecheck</code>).</p></blockquote><p>ä¸€èˆ¬çš„æƒ³æ³•æ˜¯é¢„å…ˆæŠŠä»£ç è½¬æ¢ä¸ºåªä¸ºäº†ç±»å‹æ£€æŸ¥çš„TypeScriptä»£ç ï¼ˆä¸é¢å‘è¿è¡Œæ—¶çš„è¾“å‡ºä¸åŒï¼‰ã€‚å¾—åˆ°æ£€æŸ¥ç»“æœï¼Œç„¶åæ˜ å°„å›å»ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šè¢«Veturæ‰§è¡Œç”±IDEè¿›è¡Œæç¤ºã€‚é€šè¿‡ä¸€ä¸ªä¸“é—¨çš„å‘½ä»¤è¡Œå·¥å…·å¯¹<code>*.vue</code>æ–‡ä»¶è¿›è¡Œç±»å‹æ£€æŸ¥ï¼ˆæ¯”å¦‚VTIæˆ–è€…<code>@vuedx/typecheck</code>ï¼‰ã€‚</p><p>ä¾‹å­å¦‚ä¸‹</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// æºä»£ç </span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> x</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// è½¬æ¢ä¹‹å</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> unref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> unref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><blockquote><p><code>ref</code> and <code>unref</code> here are used solely for type conversion purposes since their signatures are:</p></blockquote><p><code>ref</code>å’Œ<code>unref</code>æ–¹æ³•ä»…ç”¨ä½œå¯¹ç±»å‹è½¬æ¢å› ä¸ºå®ƒä»¬çš„å‡½æ•°ç­¾åä¸ºï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Ref</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ?</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> :</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> unref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#CB7676;--s-light:#AB5959">infer</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> V</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ?</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> V</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> :</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span></span></code></pre><p>å¯¹äºè§£æ„</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// æºä»£ç </span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> ({</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> foo</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> bar</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useX</span><span style="--s-dark:#666666;--s-light:#999999">())</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// è½¬æ¢ä¹‹å</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> ref</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> unref</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> foo</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> __foo</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> bar</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> __bar</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useX</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> foo</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> unref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">__foo</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $foo</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">__foo</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> bar</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> unref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">__bar</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">let</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> $bar</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">__bar</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><blockquote><p><strong>Svelte Syntax Details</strong></p></blockquote><p><strong>Svelteè¯­æ³•çš„ç»†èŠ‚</strong></p><blockquote><ul><li><code>export</code> is used to created component props <a href="https://svelte.dev/docs#1_export_creates_a_component_prop" target="_blank" rel="noopener">[details]</a></li><li><code>let</code> bindings are considered reactive (invalidation calls are automatically injected after assignments to <code>let</code> bindings during compilation). <a href="https://svelte.dev/docs#2_Assignments_are_reactive" target="_blank" rel="noopener">[details]</a></li><li>Labeled statements starting with <code>$</code> are used to denote computed values / reactive statements. <a href="https://svelte.dev/docs#3_$_marks_a_statement_as_reactive" target="_blank" rel="noopener">[details]</a></li><li>Imported svelte stores (the loose equivalent of a ref in Vue) can be used like a normal variable by using its <code>$</code>-prefixed counterpart. <a href="https://svelte.dev/docs#4_Prefix_stores_with_$_to_access_their_values" target="_blank" rel="noopener">[details]</a></li></ul></blockquote><ul><li><code>export</code>ç”¨äºåˆ›å»ºä¸€ä¸ªç»„ä»¶çš„props</li><li><code>let</code>ç»‘å®šçš„å˜é‡è¢«è®¤ä¸ºæ˜¯å“åº”å¼çš„ï¼ˆç¼–è¯‘è¿‡ç¨‹ä¸­åœ¨åˆ†é…ç»™<code>let</code>ç»‘å®šä¹‹åæ— æ•ˆçš„æ“ä½œä¼šè¢«è‡ªåŠ¨åœ°æ³¨å…¥ï¼‰</li><li>ä»¥<code>$</code>å¼€å§‹çš„æ ‡ç­¾è¯­å¥è¢«ç”¨äºè¡¨ç¤ºè®¡ç®—å±æ€§å€¼æˆ–è€…å“åº”å¼è¯­å¥ã€‚</li><li>å¯¼å…¥svelteçš„storesåŒ…ï¼ˆå’ŒVueå†…çš„refç›¸åƒï¼‰ï¼Œé€šè¿‡ä½¿ç”¨å¯¹åº”<code>$</code>å‰ç¼€å˜é‡ï¼Œå¯ä»¥åƒä¸€ä¸ªæ­£å¸¸å˜é‡ä¸€æ ·ä½¿ç”¨ï¼Œ</li></ul><h1 id="è¯„è®º" tabindex="-1">è¯„è®º <a class="header-anchor" href="#è¯„è®º">ğŸ”—</a></h1><h2 id="_1" tabindex="-1">1 <a class="header-anchor" href="#_1">ğŸ”—</a></h2><blockquote><p>A drawback of this RFC, which was also a drawback of <code>&lt;script setup&gt;</code> on its own but has become worse now, is the vast amount of options to write the exact same thing. Experienced Vue users (such as the people commenting on this RFC) know all the options, understand how they relate to each other etc., this will however not be the case for a big part of Vueâ€™s userbase.</p></blockquote><p>è¿™ä¸ªRFCçš„ä¸€ä¸ªç¼ºç‚¹ï¼Œå®ƒè‡ªèº«ä¹Ÿæ˜¯<code>&lt;script setup&gt;</code>çš„ç¼ºç‚¹ï¼Œä½†æ˜¯ç°åœ¨å˜å¾—æ›´ç³Ÿç³•äº†ï¼Œå› ä¸ºæœ‰å¤§é‡çš„é€‰æ‹©æ¥ä¹¦å†™å®Œå…¨ä¸€æ ·çš„ä¸œè¥¿ã€‚æœ‰ç»éªŒçš„Vueç”¨æˆ·ï¼ˆæ¯”å¦‚åœ¨è¿™ä¸ªRFCä¸‹é¢è¯„è®ºçš„ï¼‰çŸ¥é“æ‰€æœ‰çš„æ–¹å¼ï¼Œç†è§£è¿™äº›æ–¹å¼ä¹‹é—´çš„è”ç³»ã€‚ä½†å¯¹äºå¤§éƒ¨åˆ†ç”¨æˆ·è€Œè¨€ï¼Œæƒ…å†µå¹¶éå¦‚æ­¤ã€‚</p><blockquote><p>In Vue 2, you only the had the Options API, and eventually we got the class component plugin. With this RFC, youâ€™d have the following options:</p></blockquote><p>åœ¨Vue2ç‰ˆæœ¬ä¸­ï¼Œä½ åªæœ‰é…ç½®å¼çš„APIï¼Œæœ€ç»ˆä¹Ÿæœ‰äº†åŸºäºç±»çš„ç»„ä»¶çš„æ’ä»¶ã€‚åœ¨æœ¬RFCä¸­ï¼Œä½ å¯ä»¥æœ‰å¦‚ä¸‹çš„é€‰æ‹©ï¼š</p><blockquote><ul><li>Options API</li><li>Class API (still an official plugin AFAIK)</li><li>Composition API (Vue 2 &amp; Vue 3 versions which are also different!)</li><li><code>&lt;script setup&gt;</code> w/o ref sugaring</li><li><code>&lt;script setup&gt;</code> w/ ref sugaring</li></ul></blockquote><ul><li>é…ç½®å¼API</li><li>ç±»APIï¼ˆæ®æˆ‘æ‰€çŸ¥ä»ç„¶æ˜¯ä¸€ä¸ªå®˜æ–¹çš„æ’ä»¶ï¼‰</li><li>ç»„åˆAPIï¼ˆVue2å’ŒVue3ç‰ˆæœ¬æ˜¯ä¸ä¸€æ ·çš„ï¼ï¼‰</li><li>ä½¿ç”¨<code>&lt;script setup&gt;</code>ä¸”ä½¿ç”¨refè¯­æ³•ç³–</li><li>ä½¿ç”¨<code>&lt;script setup&gt;</code>ä¸ä½¿ç”¨refè¯­æ³•ç³–</li></ul><blockquote><p>This fragments the userbase a lot, making it harder to get started, to search for help on SO and to pick which one you should use. Itâ€™d be much easier if youâ€™re just starting out with Vue that you know: "Options API for the magic reactivity, composition API for more standard JS, better compositions and better TS support".</p></blockquote><p>ç”¨æˆ·æ¥è§¦äº†å¤ªå¤šçš„æ–¹å¼ï¼Œå¾ˆéš¾å»ä¸Šæ‰‹ï¼Œå¾—å»åœ¨ç½‘ä¸Šæœç´¢åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªã€‚å¦‚æœåˆšå¼€å§‹ä½¿ç”¨Vueï¼Œä¸”çŸ¥é“â€œé­”æ³•çš„å“åº”å¼çš„é…ç½®APIï¼Œæ›´åŠ æ ‡å‡†çš„ç»„åˆAPIï¼Œæ›´å¥½çš„ä»£ç ç¼–å†™å’Œæ›´å¥½çš„TSæ”¯æŒâ€ï¼Œè¿™ä¼šå˜å¾—å®¹æ˜“ä¸Šæ‰‹</p><blockquote><p>However: it is clear that people like this "magic" VCA syntax (see the linked RFCS). Isnâ€™t it possible to extend the custom block API a bit more so that if people really want this syntax, it can also be achieved outside of Vue core, in a (third) party library? If this lands in Vue core it would need to be supported throughout future versions of Vue, so Iâ€™m not sure if youâ€™d even want that, considering the very valid points already mentioned and the fact that youâ€™d need to support many APIs.</p></blockquote><p>ç„¶è€Œï¼Œæ˜æ˜¾ç”¨æˆ·å–œæ¬¢è¿™ç§é­”æ³•çš„è¯­æ³•ï¼Œå¦‚æœç”¨æˆ·çœŸæƒ³è¦è¿™ä¸ªè¯­æ³•ï¼Œå¯ä»¥æ‰©å±•æˆè‡ªå®šä¹‰çš„APIåŒ…å—ï¼Ÿè¿™ä¸ªAPIå¯ä»¥åœ¨Vueçš„æ ¸å¿ƒåŒ…ä¹‹å¤–è·å¾—ï¼Œæ¯”å¦‚åœ¨ç¬¬ä¸‰æ–¹çš„åº“ä¸­ï¼Ÿå¦‚æœæ”¾åˆ°Vueçš„æ ¸å¿ƒä¸­ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨Vueä¹‹åçš„ç‰ˆæœ¬è¿›è¡Œæ”¯æŒï¼Œæˆ‘ä¸ç¡®å®šä½ ä»¬æ˜¯å¦çœŸçš„æƒ³è¦è¿™æ ·ï¼Œè€ƒè™‘åˆ°å·²ç»æåŠåˆ°å¾ˆå¤šåˆæ³•çš„ä¹¦å†™æ–¹å¼ï¼Œäº‹å®ä¸Šä½ ä»¬éœ€è¦å»æ”¯æŒå¾ˆå¤šçš„API</p><blockquote><p>Going into the API itself a bit: I think the <code>$</code> is very confusing if you donâ€™t perfectly understand why itâ€™s there! I.e. you need to KNOW a function requires an actual ref and you need to understand that you are dealing with a sugared ref and in that case you need to prefix it with <code>$</code>, but not in other cases when you need to pass a value. Iâ€™m convinced this will cause a lot of problems with many users and to me it just sounds like a hack to get around <a href="https://github.com/vuejs/rfcs/pull/214#issuecomment-699680052" target="_blank" rel="noopener">#214 (comment)</a>è¯„è®ºã€‚</p></blockquote><p>å›åˆ°APIæœ¬èº«ï¼šæˆ‘è®¤ä¸º<code>$</code>ç¬¦å·éå¸¸ä»¤äººå›°æƒ‘ï¼Œå¦‚æœä½ ä¸èƒ½å®Œå…¨çš„ç†è§£ä¸ºä»€ä¹ˆå®ƒåœ¨è¿™é‡Œçš„è¯ï¼å³ä½ ä¸ä»…éœ€è¦çŸ¥é“ä»–æ˜¯ä¸€ä¸ªrefçš„å‡½æ•°ï¼Œè€Œä¸”éœ€è¦å»ç†è§£åœ¨å¤„ç†å¸¦ç³–çš„refæ—¶éœ€è¦ä½¿ç”¨<code>$</code>å‰ç¼€è¿›è¡Œä¿®é¥°ï¼Œä½†åœ¨å…¶ä»–çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä¼ é€’ä¸€ä¸ªå€¼ï¼Œåˆ™ä¸éœ€è¦æ·»åŠ å‰ç¼€<code>$</code>ï¼Œæˆ‘è§‰å¾—è¿™å°†ä¼šç»™ç”¨æˆ·é€ æˆè®¸å¤šçš„é—®é¢˜ã€‚ä½†å¯¹äºæˆ‘æ¥è¯´å®ƒåªæ˜¯ä¸€ä¸ªhackï¼ˆæ ‡è®°ï¼‰ï¼Œæ¯”å¦‚214ä¸‹é¢çš„<a href="https://github.com/vuejs/rfcs/pull/214#issuecomment-699680052" target="_blank" rel="noopener">è¿™ä¸ª</a>è¯„è®ºã€‚</p><blockquote><p>To conclude; why donâ€™t we just say to the users that donâ€™t like the verbosity of the composition API: use the Options API?</p></blockquote><p>ç»“è®ºå°±æ˜¯ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å¯¹é‚£äº›è®¨åŒå†—é•¿çš„ç»„åˆå¼APIçš„ç”¨æˆ·è¯´ï¼šä½¿ç”¨é…ç½®å¼APIå§ï¼Ÿ</p><p><strong>å°¤å¤§çš„å›å¤</strong></p><blockquote><p>the vast amount of options to write the exact same thing</p><ul><li>Options API</li><li>Class API (still an official plugin AFAIK)</li><li>Composition API (Vue 2 &amp; Vue 3 versions which are also different!)</li><li><code>&lt;script setup&gt;</code> w/o ref sugaring</li><li><code>&lt;script setup&gt;</code> w/ ref sugaring</li></ul></blockquote><p>ï¼ˆä¸Šé¢è¿™æ®µä¸ºå¼•ç”¨åŸä½œè€…çš„è¯ï¼‰</p><blockquote><p>This is vastly exaggerating.</p></blockquote><p>è¿™æ˜¯åŠå…¶å¤¸å¤§çš„ã€‚</p><blockquote><ul><li>The Class API is an official plugin, but is a plugin. Itâ€™s not part of the core API and only attracts users who specifically have strong preference towards classes. In other words, itâ€™s not "idiomatic".</li><li>Composition API v2 and v3 aims to be identical, and most if not all the code will look the same. The small technical differences do not count them as "two ways of doing the same thing."</li><li>Composition API code written in <code>&lt;script setup&gt;</code>, as proposed in this RFC, w/o ref sugar, <strong>is 100% the same as normal Composition API usage</strong> (you just donâ€™t need to manually return everything). In fact, if the user is using SFC, I canâ€™t really find a reason not to use the new <code>&lt;script setup&gt;</code> over a raw <code>export default { components: {...}, setup() { ... }}</code>, given that the former always results in less code.</li><li><code>ref:</code> sugar is a purely additive syntax sugar. It doesnâ€™t change how <code>&lt;script setup&gt;</code> or Composition API works. If one already understands Composition API, it shouldnâ€™t take more than 10 minutes to understand <code>ref:</code>.</li></ul></blockquote><ul><li>åŸºäºç±»çš„APIæ˜¯ä¸€ä¸ªå®˜æ–¹çš„æ’ä»¶ï¼Œä½†ä¹Ÿåªæ˜¯ä¸€ä¸ªæ’ä»¶ã€‚å®ƒä¸æ˜¯æ ¸å¿ƒçš„APIçš„ä¸€éƒ¨åˆ†ï¼Œåªä¼šå¸å¼•åˆ°é‚£äº›å¯¹ç±»æ–¹å¼æœ‰ç›¸å½“åçˆ±çš„ç”¨æˆ·ã€‚æ¢å¥è¯è¯´ï¼Œç±»APIä¸æ˜¯ä¸€ç§å¸¸ç”¨çš„æ–¹å¼ã€‚</li><li>åŸºäºç»„åˆçš„APIåœ¨2.xç‰ˆæœ¬å’Œ3.xç‰ˆæœ¬ç›®çš„æ˜¯ä¸€è‡´çš„ï¼Œå¤§å¤šæ•°çš„ï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ã€‚ç»†å°çš„æŠ€æœ¯ä¸Šçš„å·®å¼‚ä¸ä¼šä½¿å¾—è¿™ä¸¤ç§æ–¹å¼è®¡ç®—ä¸ºâ€œåšç›¸åŒäº‹æƒ…çš„ä¸¤ç§æ–¹å¼â€ã€‚</li><li>ä¹¦å†™åœ¨<code>&lt;script setup&gt;</code>ç»„åˆAPIä»£ç ï¼Œå°±åƒè¿™ä¸ªRFCæå‡ºçš„ä¸€æ ·ï¼Œä½¿ç”¨refè¯­æ³•ç³–ï¼Œå’Œæ­£å¸¸çš„ç»„åˆAPIç”¨æ³•100%ä¸€æ ·ã€‚ï¼ˆä½ åªæ˜¯ä¸éœ€è¦æ‰‹åŠ¨åœ°è¿”å›ä»»ä½•ä¸œè¥¿ï¼‰ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·ä½¿ç”¨å•æ–‡ä»¶ç»„ä»¶ç”¨æ³•ï¼Œæˆ‘çœŸæ— æ³•æ‰¾åˆ°ä¸€ä¸ªä¸ä½¿ç”¨<code>&lt;script setup&gt;</code>è€Œä½¿ç”¨<code>export default { components: {...}, setup() { ... }}</code>çš„ç†ç”±ï¼Œå‰è€…ä½¿ç”¨äº†æ›´å°‘çš„ä»£ç ã€‚</li><li><code>ref:</code>è¯­æ³•ç³–æ˜¯ä¸€ä¸ªçº¯çš„æ–°å¢è¯­æ³•ç³–ã€‚å®ƒä¸ä¼šæ”¹å˜<code>&lt;script setup&gt;</code>æˆ–è€…åŸºäºç»„åˆçš„APIçš„ä½¿ç”¨æ–¹å¼ã€‚å¦‚æœä¸€ä¸ªäººå·²ç»ç†è§£äº†åŸºäºç»„åˆçš„APIï¼Œé‚£ä¹ˆç†è§£<code>ref:</code>è¯­æ³•ç³–ä¸ä¼šè¶…è¿‡10åˆ†é’Ÿã€‚</li></ul><blockquote><p>To sum up - there are two "paradigms": (1) Options API and (2) Composition API. <code>&lt;script setup&gt;</code> and <code>ref:</code> sugar are not different APIs or paradigms. They are extensions of the Composition API - compiler-based sugar to allow you to express the same logic with less code.</p></blockquote><p>ç»¼ä¸Šï¼Œåœ¨Vueä¸­æœ‰ä¸¤ç§â€èŒƒå¼â€œï¼Œï¼ˆ1ï¼‰åŸºäºé…ç½®çš„APIå’Œï¼ˆ2ï¼‰åŸºäºç»„åˆçš„APIï¼Œ<code>&lt;script setup&gt;</code>å’Œ<code>ref:</code>è¯­æ³•ç³–ä¸æ˜¯ä¸åŒçš„APIæˆ–è€…èŒƒå¼ã€‚ä»–ä»¬åªæ˜¯åŸºäºç»„åˆAPIçš„æ‰©å±• - åŸºäºç¼–è¯‘çš„è¯­æ³•ç³–ï¼Œå…è®¸ä½ ä»¥æ›´å°‘çš„ä»£ç æ¥è¡¨è¾¾ç›¸åŒçš„é€»è¾‘ã€‚</p><blockquote><p>Isnâ€™t it possible to extend the custom block API a bit more so that if people really want this syntax, it can also be achieved outside of Vue core, in a (third) party library?ï¼ˆå¼•ç”¨è¯„è®ºï¼‰</p></blockquote><blockquote><p>So - you agree that many people want a ref syntax sugar, but then suggest not supporting it in core, and instead encouraging them to each implement their own. Isnâ€™t this going to only lead to more fragmentation? Think CSS-in-JS in the React ecosystem.</p></blockquote><p>ä½ éƒ½è®¤ä¸ºå¾ˆå¤šç”¨æˆ·ä¼šæƒ³è¦refè¯­æ³•ç³–äº†ï¼Œä½†æ˜¯å´å»ºè®®ä¸è¦åœ¨æ ¸å¿ƒåŒ…ä¸­æ”¯æŒå®ƒï¼Œè€Œæ˜¯é¼“åŠ±ä»–ä»¬å„è‡ªçš„å®ç°ã€‚è¿™ä¸æ˜¯ä¼šå¯¼è‡´æ›´å¤šç¢ç‰‡åŒ–çš„ä¿¡æ¯å—ï¼Ÿæ¯”å¦‚Reactç”Ÿæ€ä¸­çš„CSS-in-JSã€‚</p><blockquote><p>I think the <code>$</code> is very confusingâ€¦ you need to KNOW a function requires an actual ref and you need to understand that you are dealing with a sugared ref and in that case you need to prefix it with <code>$</code>, but not in other cases when you need to pass a value.ï¼ˆå¼•ç”¨è¯„è®ºï¼‰</p></blockquote><blockquote><p>You literally summed it up in a single sentence. I can also make it even simpler: <code>$foo</code> to <code>foo</code> is like <code>foo</code> to <code>foo.value</code>. Is it really that confusing? With TypeScript (assuming the IDE support is done), if an external function expects <code>Ref&lt;any&gt;</code>, youâ€™ll get an error passing a <code>ref:</code> binding without the <code>$</code>.</p></blockquote><p>ä½ ç”¨äº†ä¸€å¥è¯æ¥æ€»ç»“ï¼Œé‚£æˆ‘ä¹Ÿå¯ä»¥ç®€å•åœ°è¯´ï¼š<code>$foo</code>å¯¹äº<code>foo</code>å°±åƒ<code>foo</code>å¯¹äº<code>foo.value</code>ã€‚è¿™çœŸçš„å¾ˆä»¤äººå›°æƒ‘å—ï¼Ÿä½¿ç”¨TypeScriptï¼ˆå‡å®šIDEæ”¯æŒå·²ç»å®ç°ï¼‰ï¼Œå¦‚æœä¸€ä¸ªå¤–éƒ¨çš„å‡½æ•°æ¥æ”¶äº†<code>Ref&lt;any&gt;</code>ç±»å‹çš„å‚æ•°ï¼Œä¼ å…¥ä¸€ä¸ªä¸åŠ <code>$</code>å‰ç¼€çš„çš„<code>ref:</code>ç»‘å®šçš„å˜é‡å°†ä¼šæŠ¥é”™ã€‚</p><blockquote><p>Iâ€™m convinced this will cause a lot of problems with many usersï¼ˆå¼•ç”¨è¯„è®ºï¼‰</p></blockquote><blockquote><p>What exact, concrete problems can this lead to? Forgetting to add the <code>$</code> when they should? Note that even without the sugar we already have the problem of forgetting <code>.value</code> when you should and the latter is much more likely to happen. Specifically, even with TS, <code>foo</code> can still sometimes be type-valid where <code>foo.value</code> is actually expected (e.g. in a ternary expression <code>foo ? bar : baz</code> where <code>foo</code> is <code>Ref&lt;boolean&gt;</code>), but with ref sugar itâ€™s <strong>always</strong> going to result in a type error if you forget the <code>$</code> prefix.</p></blockquote><p>ç²¾ç¡®çš„è®²è¿™åˆ°åº•ä¼šå¯¼è‡´ä»€ä¹ˆå…·ä½“çš„é—®é¢˜ï¼Ÿå½“éœ€è¦æ·»åŠ <code>$</code>çš„æ—¶å€™å¿˜è®°äº†ï¼Ÿæ³¨æ„å³ä½¿ä¸ä½¿ç”¨è¯­æ³•ç³–ï¼Œä»ç„¶ä¼šå­˜åœ¨å¿˜è®°æ·»åŠ <code>.value</code>è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”åè€…æ›´å¯èƒ½å‘ç”Ÿã€‚ç‰¹åˆ«å¯¹äºTSï¼ŒæŸäº›æ—¶å€™æœŸå¾…ä¼ å…¥<code>foo.value</code>çš„åœ°æ–¹ä½¿ç”¨äº†<code>foo</code>ï¼Œä½†æ­¤æ—¶ç±»å‹åˆæ³•ï¼ˆæ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼<code>foo ? bar : baz</code>ä¸­<code>foo</code>çš„ç±»å‹ä¸º<code>Ref&lt;boolean&gt;</code>ï¼‰,ä½†å¦‚æœä½¿ç”¨è¯­æ³•ç³–ï¼Œå¦‚æœå¿˜è®°æ·»åŠ <code>$</code>é‚£ä¹ˆæ€»æ˜¯ä¼šå¯¼è‡´ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚</p><blockquote><p>why donâ€™t we just say to the users that donâ€™t like the verbosity of the composition API: use the Options API?ï¼ˆå¼•ç”¨è¯„è®ºï¼‰</p></blockquote><blockquote><p>You are asking users to give up the benefits of Composition API because you donâ€™t like a syntax sugar that makes Composition API less verbose for them. I donâ€™t think that really makes sense.</p></blockquote><p>ä½ è¦ç”¨æˆ·å»æ”¾å¼ƒåŸºäºç»„åˆAPIçš„ä¼˜ç‚¹ï¼Œå› ä¸ºä½ ä¸å–œæ¬¢ä¸€ä¸ªå¯¹äºç”¨æˆ·è€Œè¨€ä½¿å¾—ç»„åˆAPIæ›´åŠ ç®€æ´çš„è¯­æ³•ç³–ã€‚æˆ‘ä¸è®¤ä¸ºè¿™è¯´å¾—é€šã€‚</p><h2 id="_2" tabindex="-1">2 <a class="header-anchor" href="#_2">ğŸ”—</a></h2><blockquote><p><code>&lt;script setup&gt;</code> now directly exposes top level bindings to template ï¼ˆå¼•ç”¨RFCçš„è¯ï¼‰</p></blockquote><blockquote><p>What would we do for intermediate variables?</p></blockquote><p>å¦‚ä½•å¤„ç†ä¸€äº›ä¸­é—´å˜é‡</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> store</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> inject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">my-store</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> stateICareAbout</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> store</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">state</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">myState</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> addState</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">newState</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  store</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">add</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">newState</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><blockquote><p>This would expose <code>store</code> to the template even though i donâ€™t really need it to. But is that actually a problem?</p></blockquote><p>ä¸Šé¢çš„ä»£ç æš´éœ²äº†<code>store</code>å˜é‡ç»™æ¨¡æ¿ï¼Œå³ä½¿æˆ‘çœŸçš„ä¸éœ€è¦<code>store</code>è¿™ä¸ªå˜é‡ã€‚ä½†ï¼Œè¿™ç®—æ˜¯ä¸€ä¸ªé—®é¢˜å—ï¼Ÿ</p><blockquote><p><strong>On the downside</strong>, it will make the generated code bigger as it makes the object returned by setup larger, and we loose a bit of "clarity" about whatâ€™s being exposed to the template.</p></blockquote><p>ç¼ºç‚¹ï¼šä¼šä½¿å¾—ä»£ç å˜å¾—æ›´å¤šå› ä¸ºé€šè¿‡setupå‡½æ•°è¿”å›çš„å¯¹è±¡å˜å¾—æ›´å¤§äº†ã€‚æˆ‘ä»¬å¤±å»äº†å¦‚ä½•æš´éœ²ç»™æ¨¡æ¿çš„ä¸€ç‚¹æ¸…æ™°æ€§ã€‚</p><blockquote><p><strong>On the upside</strong>, one could argue that explicitly defining what gets exposed to the templates is tedious, and this change would make SFCs act a bit more like JSX in that every(*) variable in <code>&lt;script setup&gt;</code> is automatically in the "scope" of the template.</p></blockquote><p>ä¼˜ç‚¹ï¼šæœ‰äº›äººä¹Ÿå¯ä»¥äº‰è¾©è¯´ï¼Œæ˜ç¡®åœ°å®šä¹‰æš´éœ²ç»™æ¨¡æ¿åœ°å˜é‡è¿™ä¸ªæ“ä½œæ˜¯ä¹å‘³çš„ã€‚è¿™ä¸ªæ”¹å˜ä½¿å¾—å•æ–‡ä»¶ç»„ä»¶çš„è¿ä½œæœ‰ç‚¹åƒJSXï¼Œä»»ä½•å®šä¹‰åœ¨<code>&lt;script setup&gt;</code>é‡Œé¢çš„å˜é‡è‡ªåŠ¨åœ°æˆä¸ºæ¨¡æ¿çš„ä½œç”¨åŸŸã€‚</p><p>(*) except imports of non-vue files, if Iâ€™m right.</p><p>å¦‚æœæˆ‘æƒ³æ²¡é”™çš„è¯ï¼Œä»»ä½•évueæ–‡ä»¶çš„å¯¼å…¥éƒ½ä¼šè¢«æš´éœ²ç»™æ¨¡æ¿ï¼ˆæ³¨ï¼šä¸ªäººè®¤ä¸ºè¿™é‡Œçš„vueæ–‡ä»¶åº”è¯¥æ˜¯æŒ‡vueçš„APIï¼Œæ¯”å¦‚<code>reactive</code>è¿™äº›ä¸ä¼šæš´éœ²ç»™æ¨¡æ¿ï¼‰ã€‚</p><p><strong>å°¤å¤§å›å¤</strong></p><blockquote><p>yes, they are always exposed. Technically, if this is merged, we can also introduce a different template compilation mode where the render function is returned directly from setup. This makes the scoping even more direct and avoids the need of the render proxy.</p></blockquote><p>å¯¹çš„ï¼Œä½ è¯´çš„è¿™äº›æ€»æ˜¯ä¼šè¢«æš´éœ²ç»™æ¨¡æ¿ã€‚æŠ€æœ¯ä¸Šè®²ï¼Œå¦‚æœææ¡ˆåˆå¹¶è¿›æ¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„æ¨¡æ¿ç¼–è¯‘æ¨¡å¼æ¥è®©renderå‡½æ•°ç›´æ¥ä»setupå‡½æ•°è¿”å›ï¼Œè¿™æ ·ä¹Ÿå°±ä¸éœ€è¦renderä»£ç†å¯¹è±¡ã€‚</p><h2 id="_3" tabindex="-1">3 <a class="header-anchor" href="#_3">ğŸ”—</a></h2><blockquote><p>From the proposal:</p></blockquote><p>åœ¨ææ¡ˆä¸­æœ‰</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-text"><span class="line"><span>// if useMyRef() returns a ref, it will be untouched</span></span>
<span class="line"><span>// otherwise it's wrapped into a ref</span></span>
<span class="line"><span>// å¦‚æœuseMyRefå‡½æ•°è¿”å›ä¸€ä¸ªrefç±»å‹å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šè¢«æ“ä½œ</span></span>
<span class="line"><span>// å¦åˆ™å®ƒä¼šè¢«åŒ…è£…æˆä¸€ä¸ªref</span></span></code></pre><blockquote><p>Just to clarify something here: does this mean that given a composable function returning, say, one refs and two functions (e.g. <code>function useTimer(): { time: Ref&lt;number&gt;, start: () =&gt; void, stop: () =&gt; void }</code>), the ref AND also the functions will wrapped in ref? Wrapping in ref essentially has no impact on the one ref thatâ€™s returned. But the functions will also be wrapped in a ref, is that correct?</p></blockquote><p>è¿™é‡Œåº”è¯¥è®²æ¸…æ¥šï¼šæ˜¯æŒ‡ç»„åˆå‡½æ•°çš„è¿”å›å—ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªrefså’Œä¸¤ä¸ªå‡½æ•°ï¼ˆæ¯”å¦‚<code>function useTimer(): { time: Ref&lt;number&gt;, start: () =&gt; void, stop: () =&gt; void }</code>ï¼‰ï¼Œrefå¯¹è±¡å’Œå‡½æ•°éƒ½ä¼šè¢«åŒ…è£…æˆrefå—ï¼ŸåŒ…è£…æˆrefæœ¬è´¨ä¸Šä¸ä¼šå½±å“è¿”å›çš„refå¯¹è±¡å—ï¼Ÿä½†æ˜¯å‡½æ•°ä¹Ÿä¼šè¢«åŒ…è£…æˆä¸€ä¸ªrefå¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æ­£ç¡®çš„å—ï¼Ÿ</p><blockquote><p>example:ï¼ˆä¾‹å­ï¼‰</p></blockquote><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> ({</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> time</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> start</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> stop</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useTimer</span><span style="--s-dark:#666666;--s-light:#999999">())</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34"> </span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// does start and stop get wrapped in a ref?</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// startå‡½æ•°å’Œstopå‡½æ•°ä¼šåŒ…è£…æˆä¸€ä¸ªrefå—ï¼Ÿ</span></span></code></pre><blockquote><p>I know it doesnâ€™t make much of difference in this example (a function getting wrapped doesnâ€™t cause any issue), but it seems a little weird like you could end up with some amount of accidental code bloat or unintended behavior, so wanted to confirm. If it were a problem I guess you would just assign the refs separately.</p></blockquote><p>æˆ‘çŸ¥é“åœ¨è¿™ä¸ªä¾‹å­ä¸­å…¶å®æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼ˆä¸€ä¸ªå‡½æ•°è¢«åŒ…è£…æˆrefä¸ä¼šé€ æˆä»»ä½•é—®é¢˜ï¼‰ã€‚ä½†å®ƒå°±æ˜¯æœ‰ç‚¹å¥‡æ€ªï¼Œå°±æ„Ÿè§‰ä¼šå¾—åˆ°ä¸€äº›è†¨èƒ€æ„å¤–çš„ä»£ç ã€‚æ‰€ä»¥æˆ‘æƒ³ç¡®è®¤ä¸‹ï¼Œå¦‚æœçœŸçš„ç®—é—®é¢˜çš„è¯ï¼Œæˆ‘çŒœæƒ³ä½ ä»¬ä¼šå•ç‹¬åœ°å»åŒ…è£…æˆref</p><p><strong>å°¤å¤§çš„å›å¤</strong></p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> ({</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> time</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> start</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> stop</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useTimer</span><span style="--s-dark:#666666;--s-light:#999999">())</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ï¼ˆå¼•ç”¨ï¼‰</span></span></code></pre><blockquote><p>You are correct, all three will be wrapped in refs, although you can use <code>start()</code> and <code>stop()</code> just fine. It does create a bit of unnecessary overhead, although the overhead should be fairly acceptable (some bench numbers here).</p></blockquote><p>ä½ æ˜¯å¯¹çš„ï¼Œè¿™ä¸‰ä¸ªå¯¹è±¡éƒ½ä¼šè¢«åŒ…è£…æˆrefç±»å‹ï¼Œå³ä½¿è¿™æ ·ä½ ä¹Ÿå¯ä»¥æ­£å¸¸åœ°ä½¿ç”¨startå’Œstopå‡½æ•°ã€‚å®ƒçš„ç¡®ä¼šç”Ÿæˆä¸€äº›æ²¡å¿…è¦å¼€é”€ï¼Œå³ä½¿è¿™äº›å¼€é”€æ˜¯ç›¸ç­‰å¯ä»¥æ¥å—çš„ã€‚</p><blockquote><p>To avoid the wrapping youâ€™d have to write three lines:</p></blockquote><p>ä¸ºäº†é¿å…åŒ…è£…ä½ å¯ä»¥å†™æˆä¸‹é¢ä¸‰è¡Œ</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> timer</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> useTimer</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> start</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> stop</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> timer</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> ({</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> time</span><span style="--s-dark:#666666;--s-light:#999999"> })</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> timer</span></span></code></pre><blockquote><p>This is a problem Iâ€™ve thought about as well. Maybe we can introduce extra syntax to deal with it but I want to keep it minimal for now.</p></blockquote><p>è¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿæƒ³è¿‡ã€‚å¯èƒ½æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ç§é¢å¤–çš„è¯­æ³•æ¥è§£å†³å®ƒï¼Œä½†ç°åœ¨æˆ‘æƒ³å…ˆæš‚æ—¶æŠŠå®ƒæ”¾åœ¨ä¸€è¾¹ã€‚</p><h1 id="åè®°" tabindex="-1">åè®° <a class="header-anchor" href="#åè®°">ğŸ”—</a></h1><p>ä¸ªäººæ„Ÿè§‰ææ¡ˆå¾ˆæœ‰è¶£ï¼Œæ¯•ç«Ÿæˆ‘ä¹Ÿæ²¡æœ‰åšè¿‡å¤§çš„é¡¹ç›®ï¼Œå¯¹äºéæ ‡å‡†è¯­ä¹‰çš„åŠ å…¥åªèƒ½è¯´å¾ˆæœ‰è¶£</p><p>ä½¿ç”¨äº†æ ‡ç­¾è¯­å¥ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/label" target="_blank" rel="noopener">Labeled Statement</a>ï¼‰æ¥è¡¨ç¤ºVueä¸­ç‰¹å®šçš„è¯­ä¹‰ï¼Œæ ‡ç­¾è¯­å¥æ˜¯JavaScriptä¸€ä¸ªåŸç”Ÿçš„è¯­æ³•ï¼Œä½†æ˜¯åŸºæœ¬ç”¨ä¸åˆ°ã€‚</p><p>è¿™é‡Œä¹Ÿæåˆ°äº†å¦ä¸€ä¸ªå‰ç«¯æ¡†æ¶<code>Svelte</code>ï¼Œè¿™ä¸ªæ¡†æ¶å’ŒVueï¼ŒReactç›¸æ¯”ï¼Œæœ€å¤§çš„ä¸åŒå°±æ˜¯æ²¡æœ‰è™šæ‹Ÿdomï¼Œç¼–å†™çš„ä»£ç ä¼šç”Ÿæˆç›´æ¥æ“ä½œdomçš„ä»£ç ã€‚æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å‡å°‘äº†è¿è¡Œæ—¶ä¾èµ–åº“çš„ä½“ç§¯ï¼ˆåŸºæœ¬å¯ä»¥ä¸ä¾èµ–ï¼‰</p><p><code>&lt;script setup&gt;</code>å‡å°‘äº†æ ·æ¿ä»£ç çš„ç¼–å†™ï¼Œæ›´åŠ çš„ä¸“æ³¨äºç»„åˆå‡½æ•°é€»è¾‘çš„ç¼–å†™ï¼Œä¸è¿‡å¦‚ä½•å£°æ˜propså’Œå…¶ä»–çš„é…ç½®æ„Ÿè§‰æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸å¥½å¤„ç†ï¼ˆä¹Ÿä¸èƒ½è¯´æ˜¯éš¾å¤„ç†ï¼ŒRFCä¸­æåˆ°ç›´æ¥å¯¼å‡ºä¸€ä¸ªå¯¹è±¡æ¥å£°æ˜propsï¼Œä¸è¿‡æ„Ÿè§‰åˆå›åˆ°äº†ä¹‹å‰çš„æ ·å­â€¦ï¼‰ï¼Œå¾ˆæœŸå¾…å¯ä»¥è§£å†³è¿™æ–¹é¢çš„é—®é¢˜</p><p>ç°åœ¨Vueä¹Ÿå¼€å§‹ç”±å¾ˆå¤šçš„æ–¹å¼æ¥ç¼–å†™ä¸€ä¸ªç»„ä»¶äº†ï¼ŒVue2æœ€æ™®é€šçš„åŸºäºé…ç½®çš„ç»„ä»¶ï¼ŒVue3åŸºäºç»„åˆAPIçš„ç»„ä»¶ï¼ŒåŸºäºç±»ç»„ä»¶ï¼Œè¿˜å¯ä»¥åŸºäºJSXç»„ä»¶ï¼Œæ„Ÿè§‰å¼€å§‹æœ‰ç‚¹Reactçš„å‘³é“ï¼Œè¿™ä¹ˆå¤šæ–¹å¼æ„Ÿè§‰å¯¹å¼€å‘è€…å…¶å®ä¸æ˜¯ç‰¹åˆ«çš„å‹å¥½</p><p>å¦‚æœVue3å¯ä»¥å¤§åŠ›æ¨å¹¿ç»„åˆAPIç»„ä»¶ï¼Œé€æ­¥åœ°å‡å°‘å¯¹é…ç½®å¼ç»„ä»¶çš„æ”¯æŒï¼Œåœ¨æŸä¸ªç‰ˆæœ¬å®Œå…¨æ”¾å¼ƒï¼Œæˆ‘è§‰å¾—æ˜¯éå¸¸éœ€è¦çš„ä¸€æ­¥</p><p>å½“ç„¶ä¸Šé¢çº¯å±æˆ‘çš„yyï¼Œå½“ä½œä¹å­å°±å®Œäº‹</p><p>TS/IDEå·¥å…·çš„æ”¯æŒä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä½†æˆ‘æ„Ÿè§‰é—®é¢˜ä¸å¤§ï¼Œèƒ½ç”¨ä»£ç å®ç°çš„ä¸œè¥¿é—®é¢˜éƒ½ä¸ä¼šå¾ˆå¤§ï¼Œå¤§çš„é—®é¢˜æ˜¯å¦‚ä½•å†³å®šVueä¹‹åçš„æ•´ä½“èµ°å‘ï¼Œåˆ°åº•æ˜¯ç™¾èŠ±é½æ”¾ï¼Œè¿˜æ˜¯ä¸€æç‹¬ç§€ï¼Ÿ</p><p>æˆ‘éå¸¸æœŸå¾…Vueçš„åç»­å‘å±•ï¼Œå¼€æºç¤¾åŒºçš„åŠ›é‡å¯èƒ½æ²¡æœ‰å…¬å¸æ”¯æŒçš„åŠ›é‡å¤§ï¼Œä½†æ˜¯ä¸åŒäººçš„æƒ³æ³•ç¢°æ’åœ¨ä¸€èµ·ï¼Œæ€»èƒ½å‡ºç°åˆ«å…·ä¸€æ ¼çš„æƒ³æ³•~</p><p>ä½œä¸ºä¸€ä¸ªåˆæ­¥è¿›å…¥è½¯ä»¶å¼€å‘çš„å¼€å‘è€…ï¼Œæˆ‘å¾ˆæ•¬ä½©æ¡†æ¶å¼€å‘è€…~</p><p>ï¼ˆè¯„è®ºä¼šé€æ­¥åœ°ç¿»è¯‘ï¼‰</p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#Vue</div><div>#JavaScript</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/adaf14f3e5d5" class="" truncate="" title="Promiseä¸Šçš„ä¸€äº›å·¥å…·å‡½æ•°çš„å®ç°"><i class="i-mi:chevron-left" mr-1=""></i><span>Promiseä¸Šçš„ä¸€äº›å·¥å…·å‡½æ•°çš„å®ç°</span></a><a href="/269d28640b0a" class="" ml-auto="" truncate="" title="è½®æ’­å›¾çš„ç®€å•å®ç°flexç‰ˆ"><span>è½®æ’­å›¾çš„ç®€å•å®ç°flexç‰ˆ</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-f3312cf8="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-f3312cf8=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-f3312cf8=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-f3312cf8=""></i></div><div flex="~ col grow" gap-2="" lg:gap-4="" data-v-f3312cf8=""><textarea disabled="" placeholder="ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç•™ä¸‹è¯„è®ºè¡Œä¸è¡Œ" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" lg:p-4="" data-v-f3312cf8=""></textarea><div flex="" items-start="" data-v-f3312cf8=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-f3312cf8="">æ”¯æŒ Markdown è¯­æ³•</a><div ml-auto="" data-v-f3312cf8=""></div><!----><button class="mujika-button" data-v-f3312cf8="" data-v-15330f5f=""><!--[--><!--]--><!--[-->ç‚¹å‡»ç™»å½•<!--]--></button></div></div></div><!--]--></div></div><!----><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">æ–‡ç« ç›®å½•</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-d1d7a153=""><div flex="" items-center="" data-v-d1d7a153=""><span data-v-d1d7a153="">Power by&nbsp;</span><i class="i-logos:vue" data-v-d1d7a153=""></i><span data-v-d1d7a153="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-d1d7a153=""></i></div><div text-center="" data-v-d1d7a153=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-d1d7a153="">CC BY-NC-SA 4.0 </a>2021 - PRESENT Â© Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-d1d7a153="">å¦‚æœæˆ‘å’Œç‹—ä¸€æ ·æœ‰å°¾å·´çš„è¯ï¼Œä¸€å®šä¼šè—ä¸ä½è¿™ä»½å–œæ‚¦ï¼Œè€Œå°¾å·´ä¸€ç›´æ‘‡ä¸ªä¸åœå§ã€‚</div></footer></div></div></body></html>