<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>记一次对StarUML-3.2.2的解包</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-C7bQa6bS.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-C8PKLJNY.css"><link rel="modulepreload" crossorigin="" href="/assets/记一次对StarUML-3-2-2的解包-3io6i_eI.js"><meta property="og:title" content="记一次对StarUML-3.2.2的解包"><meta name="twitter:title" content="记一次对StarUML-3.2.2的解包"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="恋の歌的logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="自动" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="日间" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="夜间" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">记一次对StarUML-3.2.2的解包</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">发表于</span><span pl-1="">2020-06-12 09:17</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">更新于</span><span pl-1="">2023-02-13 18:28</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">分类于</span><!--[--><a pl-1="" href="/category/编程">编程</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">总字数</span><span pl-1="">1.6K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">阅读时长 ≈</span><span pl-1="">6 分钟</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><h1 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言">🔗</a></h1><p>感觉很久没写帖子了…<br>老是把上学期的实训还没有做完当借口感觉也不是很行<br>索性就随便写写吧<br>（项目还没有做完，cao！）</p><h1 id="准备" tabindex="-1">准备 <a class="header-anchor" href="#准备">🔗</a></h1><p>上系统分析与设计的课需要用到一个StartUML的软件<br>虽然老师已经提供了完整的工具了<br>但是人嘛，总是喜新厌旧的<br>不是最新版这手就不舒服…<br>直接上官网下载了最新版的<br>高高兴兴的替换<br>What the f**k？ 直接黑屏</p><p>不行，上网找找看看有没有新的解决方法<br>emmm，找了一会，找到了好东西</p><blockquote><p>吾爱论坛的一个帖子: <a href="https://www.52pojie.cn/thread-796683-1-1.html" target="_blank" rel="noopener">另一种 StarUML 3.x 完美**的思路</a></p></blockquote><p>感觉能行，<s>是我最擅长的js</s> 直接开搞</p><blockquote><p>StartXML官网：<a href="http://staruml.io/" target="_blank" rel="noopener">StarUML 3</a></p></blockquote><p>这次使用的版本为最新版，版本号为3.2.2<br>除此之外需要node环境，需要npm的一个asar的一个包<br>这个就不细讲，因为我也不懂emmm…</p><h1 id="过程" tabindex="-1">过程 <a class="header-anchor" href="#过程">🔗</a></h1><p>看完吾爱那个帖子还是蛮吃惊的<br>这应用好像是Electron的…<br>简单讲就是套了个谷歌浏览器的桌面应用</p><p>ok那开始，先把最新的app.asar文件解包出来<br><code>asar extract app.asar app</code><br>extract解包，app.asar为需要解包的文件 app为解包的目录</p><p>解包出来<br>emmm，挺熟悉的…</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/03/05/LsURBaNWz4lFMgb.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/03/05/LsURBaNWz4lFMgb.png" alt=""></a></p><p>马不停蹄，直接奔着<code>about-dialog.js</code>文件去<br>在<code>src/dialogs</code>文件下<br>在这个文件下的<code>showDialog</code>函数下果然找到了这一段代码</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/03/05/L4WdDYT1XAPgHFq.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/03/05/L4WdDYT1XAPgHFq.png" alt=""></a></p><p>这段代码判断根据凭证管理器返回的状态来给模态框设置内容</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">app</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">licenseManager</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">getStatus</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>所以现在首要的是找到app这个变量<br>这个变量有着licenseManager的实例<br>ctrl这个变量发现有两处存在这个变量<br>分别是<code>src/main-process/application.js</code>和 <code>src/index.js</code>下</p><p>其中<code>application.js</code>文件的代码段为</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/03/05/S5toYwOJPWmjNXc.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/03/05/S5toYwOJPWmjNXc.png" alt=""></a></p><p>metadataManager？<br>很明显不是我们的licenseManager<br>直接不管<br>看<code>src/index.js</code>文件</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/03/05/f1OrbdWgNDUnIBT.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/03/05/f1OrbdWgNDUnIBT.png" alt=""></a></p><p><code>new AppContxt()</code> 按照字面意思应该是app的上下文<br>应该是这个不会错<br>点进去发现是一个类<br><code>ctrl+f</code>搜索licenseManager<br>果然在38行发现了引入的凭证管理器</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/03/05/vgUYwrQ2OIaMjxd.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/03/05/vgUYwrQ2OIaMjxd.png" alt=""></a></p><p>ok定位到<code>src/enginer/license-manager.js</code>这个文件<br>继续<code>ctrl+f</code>搜索getStatus<br>找到代码，是LicenseManager的一个方法<br>这个方法返回了一个定义在文件中的变量<code>status</code></p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/03/05/1A7zcp9NBlyXdEL.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/03/05/1A7zcp9NBlyXdEL.png" alt=""></a></p><p>根据前面我们知道，当status为<code>true</code>，就会往模态框渲染已注册的内容了<br>所以继续搜索status<br>发现一个<code>setStatus</code>函数<br>这个函数不在类中<br>（截图好累，直接贴代码吧….）</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">/**</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * Set Registration Status</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * This function is out of LicenseManager class for the security reason</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * (To disable changing License status by API)</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">private</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">param</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">boolean</span><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newStat</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> * </span><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#4D9375;--s-light:#1E754F">return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> */</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> setStatus</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">licenseManager</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newStat</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">status</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> !==</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newStat</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        status</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newStat</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        licenseManager</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">emit</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">statusChanged</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> newStat</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>注释也给出了没写在类方法中的原因</p><blockquote><p>To disable changing License status by API<br>译过来就是：防止通过api的方式去改变凭证</p></blockquote><p>也就是不想让license管理器对象直接设置status状态<br>这也反过来证明这个status状态确实决定注册的状态<br>（有点心虚的味道…）</p><p>这里还可以发现设置状态会广播一个<code>statusChanged</code>的事件 <code>licenseManager.emit('statusChanged', newStat)</code> 状态根据传进来的newStat决定</p><p>接下来看到底谁调用了<code>setStatus</code>这个函数了<br>搜索发现<code>checkLicenseValidity</code>函数和<code>register</code>函数都调用了</p><p>怎么有两个函数调用…<br>看了看方法，找到猫腻<br>类中有一个方法<code>appReady</code><br>代码是这样的</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">class</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> LicenseManager</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#80A665;--s-light:#59873A"> EventEmitter</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...  </span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    appReady</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">        this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">checkLicenseValidity</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>看方法名就知道了，在应用准备的时候调用这个函数<br>那八九不离十是<code>checkLicenseValidity</code>这个函数了<br>而且<code>register</code>函数的注释也让我更加确定</p><blockquote><p>Check the license key in server and store it as license.key file in local 通过服务器检查凭证并将它以license.key文件进行储存</p></blockquote><p>不难分析，刚安装的软件肯定是没有注册的<br>需要通过键入密钥来激活<br>也就是这几种情况</p><ul><li>开启app - 有本地文件 - 进行检验 - 显示检验状态</li><li>开启app - 没有本地文件 - 显示未注册</li><li>开启app - 没有本地文件 - 输入密钥 - 成功 - 生成文件方便下次启动的验证</li></ul><p>当然我们手头是没有密钥的，所以<code>register</code>函数关系不大<br>目的是在启动检测的时候假装存在检验文件， 并检测成功</p><p>观察<code>checkLicenseValidity</code>函数，它调用了<code>validate</code>函数进行验证<br>但是<code>validate</code>函数其实已经不重要了<br>为啥呢？<br>因为<code>validate</code>函数没有调用<code>setStatus</code>这个函数了<br>也就是注册状态的变化和<code>validate</code>函数块无关了<br>跟<code>validate</code>函数执行的对应回调有关<br>也就是<code>checkLicenseValidity</code>函数中的代码</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">class</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> LicenseManager</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#80A665;--s-light:#59873A"> EventEmitter</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...  </span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    checkLicenseValidity</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">        this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">validate</span><span style="--s-dark:#666666;--s-light:#999999">().</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">            setStatus</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        },</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">            setStatus</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> false</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">            UnregisteredDialog</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">showDialog</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>这里可以看到成功就设置状态为true<br>失败设置状态为false并展示一个未注册的展示框</p><p>OK大体上摸清楚了<br>只要把代码这个函数的代码改为</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">class</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> LicenseManager</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#80A665;--s-light:#59873A"> EventEmitter</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...  </span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    checkLicenseValidity</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#C99076;--s-light:#A65E2B">        this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">validate</span><span style="--s-dark:#666666;--s-light:#999999">().</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">            setStatus</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        },</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">            // 失败也设置未注册成功</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">            setStatus</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">            // 失败不展示失败的模态框</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">            // UnregisteredDialog.showDialog()</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>其实大部分工作都已经完成了<br>接下来回到最开始的if判断</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">if</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">app</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">licenseManager</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">getStatus</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> ===</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    var</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> info</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> app</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">licenseManager</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">getLicenseInfo</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    var</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> licenseTypeName</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Unknown</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">    switch</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">info</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">licenseType</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        case</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">PS</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">            licenseTypeName</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Personal</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            break</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        case</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">CO</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">            licenseTypeName</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Commercial</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            break</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        case</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ED</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">            licenseTypeName</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Educational</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            break</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        case</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">CR</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">            licenseTypeName</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Classroom</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">            break</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    $license</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">html</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Licensed to </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> info</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">name</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    $licenseType</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">html</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">licenseTypeName</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> License</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    $quantity</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">html</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">info</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">quantity</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> User(s)</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> else</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    $license</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">html</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">UNREGISTERED</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>判断成功后会获取凭证的信息<br>在LicenseManager类中也可以找到这个方法<br>也就是只要构造出符合结构的对象就可以了<br>也可以直接在方法体里面改<br>我的话通过返回的对象来改<br>也就是</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">class</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> LicenseManager</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#80A665;--s-light:#59873A"> EventEmitter</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...  </span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    getLicenseInfo</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">        // 不返回lincenseInfo了</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> licenseInfo</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">        //这里获取密钥所包含的信息，具体可以看validate函数，里面有对密钥的解析，也就是json格式</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">        return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">            name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">17软件工程</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">            product</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">系统分析与设计</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">            licenseType</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">PS</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">            quantity</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">INDEX</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">            timestamp</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">1583395020</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">            licenseKey</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">仅供学习，请勿用于商业用途</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">            crackedAuthor</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Dedicatus545</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        };</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>到这里其实基本就完成了<br>最后就是重新打包这个文件<br><code>asar pack app app.asar</code><br>替换之后就完成了</p><p>附上一张截图</p><p><a data-fancybox="doc-gallery" href="https://i.loli.net/2020/03/05/3uXfOKYQwC59s6r.png" target="_blank" rel="noopener noreferrer"><img src="https://i.loli.net/2020/03/05/3uXfOKYQwC59s6r.png" alt=""></a></p><p>仅供学习使用，请勿使用于商业用途。</p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#JavaScript</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/781ed0772306" class="" truncate="" title="Promise A+规范（译）"><i class="i-mi:chevron-left" mr-1=""></i><span>Promise A+规范（译）</span></a><a href="/5882a36e807b" class="" ml-auto="" truncate="" title="Spring中Bean的配置方式"><span>Spring中Bean的配置方式</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-557c65bc="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-557c65bc=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-557c65bc=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-557c65bc=""></i></div><div flex="~ col grow" gap-2="" lg:gap-4="" data-v-557c65bc=""><textarea disabled="" placeholder="万水千山总是情，留下评论行不行" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" h-4em="" lg:p-4="" lg:h-8em="" data-v-557c65bc=""></textarea><div flex="" items-start="" data-v-557c65bc=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-557c65bc="">支持 Markdown 语法</a><div ml-auto="" data-v-557c65bc=""></div><!----><button class="mujika-button" data-v-557c65bc="" data-v-15330f5f=""><!--[--><!--]--><!--[-->点击登录<!--]--></button></div></div></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-557c65bc="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" items-center="" justify-center="" data-v-557c65bc="">哦呢该，如果没有评论的话，瓦达西...</div><!----><!--]--></div></div><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">文章目录</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-be8724f6=""><div flex="" items-center="" data-v-be8724f6=""><span data-v-be8724f6="">由&nbsp;</span><i class="i-logos:vue" data-v-be8724f6=""></i><span data-v-be8724f6="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-be8724f6=""></i><span data-v-be8724f6="">&nbsp;驱动</span></div><div text-center="" data-v-be8724f6=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-be8724f6="">CC BY-NC-SA 4.0 </a>2021 - PRESENT © Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-be8724f6="">如果我和狗一样有尾巴的话，一定会藏不住这份喜悦，而尾巴一直摇个不停吧。 - 《秒速五厘米》</div></footer></div></div></body></html>