<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>记录使用 electron 的一次经历</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-u6mH9xpQ.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-afYcuv6x.css"><link rel="modulepreload" crossorigin="" href="/assets/记录使用-electron-的一次经历-jBPA_wX_.js"><meta property="og:title" content="记录使用 electron 的一次经历"><meta name="twitter:title" content="记录使用 electron 的一次经历"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="恋の歌的logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="自动" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="日间" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="夜间" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">记录使用 electron 的一次经历</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">发表于</span><span pl-1="">2024-11-06 18:26</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">更新于</span><span pl-1="">2024-11-28 15:11</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">分类于</span><!--[--><a pl-1="" href="/category/编程">编程</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">总字数</span><span pl-1="">3.8K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">阅读时长 ≈</span><span pl-1="">14 分钟</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><h1 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言">🔗</a></h1><p>记录使用 electron 的一次经历。</p><p>已经快一个月没有写帖子了，时间过的好快，转眼就又到年末了。</p><p>一号才从老家回到广州，歇了差不多一个月，这段时间也是用 electron + vue 开发了一个桌面软件。</p><p>项目 github 地址：<a href="https://github.com/Dedicatus546/jm-desktop" target="_blank" rel="noopener">jm-desktop</a></p><p>这篇帖子就记录下这一个月的过程。</p><h1 id="正文" tabindex="-1">正文 <a class="header-anchor" href="#正文">🔗</a></h1><h2 id="前期准备" tabindex="-1">前期准备 <a class="header-anchor" href="#前期准备">🔗</a></h2><p>首先，在编写之前，分析了接口加密以及图片编码的原理，这部分在下面两篇帖子中。</p><ul><li><a href="https://prohibitorum.top/202da2aab6d1" target="_blank" rel="noopener">记一次分析某漫接口密钥</a></li><li><a href="https://prohibitorum.top/d5936495bfca" target="_blank" rel="noopener">记一次分析某漫的图片</a></li></ul><h2 id="技术选型" tabindex="-1">技术选型 <a class="header-anchor" href="#技术选型">🔗</a></h2><p>Web 菜鸡，什么 Qt 、 winui 都不会，只能用 electron 来做套壳应用，这对我来说上手最快，并且可以快速实现需要的功能。</p><p>最开始的时候选择了 electron + react + ant-design ，写到一半发现 hold 不住 react ，写的太别扭了，果断换成了 electron + vue + ant-design-vue ，再写到一半发现 ant-design-vue 写出来像一个后台管理系统，并且社区维护不积极，果断转到 vuetify 上。</p><p>所以最后的技术栈就是 electron + vue ，组件库选择了 vuetify 。以及一些杂七杂八的库。</p><h2 id="需求" tabindex="-1">需求 <a class="header-anchor" href="#需求">🔗</a></h2><p>对于一个第三方的漫画 APP ，核心的功能我觉得就两个，一个是搜索、一个是浏览，细分下来就是：</p><ul><li>搜索页</li><li>漫画详情页</li><li>漫画阅读页</li></ul><p>其他都是甜头，比如什么首页，每周推荐，评论，甚至登录（除非需要登录才能查看）等等。</p><p>所以当时基本上是先实现这些核心的模块。</p><h2 id="相关资源" tabindex="-1">相关资源 <a class="header-anchor" href="#相关资源">🔗</a></h2><h3 id="项目模板" tabindex="-1">项目模板 <a class="header-anchor" href="#项目模板">🔗</a></h3><p>使用 electron + vue ，自己搭环境就太慢了（<s>并不是我不会</s>），直接使用下面这个模板。</p><p>项目地址： <a href="https://github.com/electron-vite/electron-vite-vue" target="_blank" rel="noopener">electron-vite-vue</a></p><p>electron-vite 这个组织开源了多个项目，包括和 vue 或者 react 集成的模板，以及开箱即用的 vite 插件，省去了自己搭建目录，对于我这个体量的项目完全够用了。</p><p>使用 electron-vite-vue 还有一个好处就是 electron 主进程的代码直接可以使用 TypeScript ，太棒了。</p><h3 id="组件库" tabindex="-1">组件库 <a class="header-anchor" href="#组件库">🔗</a></h3><p>这里选用了 <a href="https://vuetifyjs.com/zh-Hans/getting-started/installation/#section-5b8988c5" target="_blank" rel="noopener">vuetify</a> ，它是一个基于 material 的组件库，组件全面（不过 material 感觉和国内的审美水土不服，看多了国内的 app ，再看谷歌系的总感觉到了另一个次元）。</p><p>配合 <a href="https://github.com/unplugin/unplugin-vue-components" target="_blank" rel="noopener">unplugin-vue-components</a> 插件完成自动导入，省略很多 import 语句 。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// vite.config.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> Vuetify3Resolver</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">unplugin-vue-components/resolvers</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> component</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">unplugin-vue-components/vite</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#80A665;--s-light:#59873A"> defineConfig</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  plugins</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    component</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      resolvers</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#80A665;--s-light:#59873A">Vuetify3Resolver</span><span style="--s-dark:#666666;--s-light:#999999">()],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>启动之后会生成 <code>components.d.ts</code> 文件，注意要将它加入到 TypeScript 中，这样可以得到模板中的类型提示。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-json"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// tsconfig.json</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">{</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">  "</span><span style="--s-dark:#B8A965;--s-light:#998418">include</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">    "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">src/**/*.ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">    "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">src/**/*.tsx</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">    "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">src/**/*.vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">    "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">electron</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">    "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">auto-imports.d.ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">    "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">components.d.ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>PS：之前在使用 ant-design-vue 的时候，发现了一个 bug ，但是提交到了 issue 上还没修（虽然我也不确定到底是 bug 还是特性），果然还是得有官方的团队的组件库才比较可信…</p><p>这里贴上 issue 地址：<a href="https://github.com/vueComponent/ant-design-vue/issues/7875" target="_blank" rel="noopener">the args of notification.useNotification does not work</a> 。</p><p>也不知道要多久才能处理这个 issue …</p><h3 id="原子-css" tabindex="-1">原子 css <a class="header-anchor" href="#原子-css">🔗</a></h3><p>这里使用了 <a href="https://unocss.dev/guide/" target="_blank" rel="noopener">unocss</a> 来生成 css 类，主要是使用一些工具类，使用较多的是 flex 相关的。</p><p>首先要在 vite 中添加 unocss 插件。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// vite.config.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> unocss</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">unocss/vite</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#80A665;--s-light:#59873A"> defineConfig</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  plugins</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    unocss</span><span style="--s-dark:#666666;--s-light:#999999">(),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>然后额外创建一个 <code>uno.config.ts</code> 文件。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// uno.config.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> defineConfig</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> presetWind</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">unocss</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#80A665;--s-light:#59873A"> defineConfig</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  presets</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#80A665;--s-light:#59873A">presetWind</span><span style="--s-dark:#666666;--s-light:#999999">()],</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  rules</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    [</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">      "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">app-region-drag</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      {</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">        "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">-webkit-app-region</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">drag</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    ],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    [</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">      "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">app-region-nodrag</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      {</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">        "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">-webkit-app-region</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">no-drag</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    ],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>这里我们配置了 tailwind 规则，以及多生成了两个类，主要是来快速处理头部部分是否能够拖动的情况。</p><p>最后在 <code>main.ts</code> 中导入 <code>uno.css</code> 即可</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// src/main.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">virtual:uno.css</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ...</span></span></code></pre><h3 id="接口请求" tabindex="-1">接口请求 <a class="header-anchor" href="#接口请求">🔗</a></h3><p>以往基本上都是用 axios 的，这次用了 <a href="https://alova.js.org/zh-CN/" target="_blank" rel="noopener">alova</a> ，它附带的功能更多，而且内置了 useRequest 、 usePagination 的组合式 api ，大大减少了很多样板代码，很棒，以及提供了接口缓存，这样子在某些接口上开启缓存，可以减少接口调用次数，切换页面的体验上升很多。</p><p>alova 和 axios 在某种情况下还是很像的，都是创建一个请求实例，用这个实例来发起 Get 、Post 等请求。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// src/apis/http.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> xhrRequestAdapter</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">@alova/adapter-xhr</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> createAlova</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">alova</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> vueHook</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">alova/vue</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">http</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> createAlova</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  statesHook</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">vueHook</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  requestAdapter</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#80A665;--s-light:#59873A">xhrRequestAdapter</span><span style="--s-dark:#666666;--s-light:#999999">(),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  baseURL</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">/api</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  beforeRequest</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">method</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  responded</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">    async</span><span style="--s-dark:#80A665;--s-light:#59873A"> onSuccess</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">response</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">method</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>这里 <code>onSuccess</code> 就和 axios 中的拦截器差不多， <code>beforeRequest</code> 在请求前添加一些全局的请求头，注意这里使用了 <code>xhrRequestAdapter</code> ，即基于 XMLHttpRequest 封装的适配器，由于 fetch 适配器不支持获取上传下载进度，而功能里面有下载漫画，所以需要使用 <code>xhrRequestAdapter</code> 。 <code>vueHook</code> 则让 alova 能够在 setup 中使用组合式的 api ，这里用的最多的就是 <code>useRequest</code> 和 <code>usePagination</code> ，特别是 <code>usePagination</code> 相当的方便，很多的列表页都只要一个 <code>usePagination</code> 就能拿到大部分的状态。</p><p>接着我们只需要编写相应的业务请求即可，比如：</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// src/apis/ajax.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> const </span><span style="--s-dark:#80A665;--s-light:#59873A">loginApi</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">username</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> password</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">formData</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new </span><span style="--s-dark:#80A665;--s-light:#59873A">FormData</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  formData</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">append</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">username</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> username</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  formData</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">append</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">password</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> password</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  return</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> http</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">Post</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    RespWrapper</span><span style="--s-dark:#666666;--s-light:#999999">&lt;{</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      uid</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      username</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      email</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      avatar</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      jCoin</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      level</span><span style="--s-dark:#666666;--s-light:#999999">: [</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">];</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      currentExp</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      nextLevelExp</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      collectCount</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      maxCollectCount</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }&gt;,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    RespWrapper</span><span style="--s-dark:#666666;--s-light:#999999">&lt;{</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      uid</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      username</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      email</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      emailverified</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      photo</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      fname</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      gender</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      message</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      coin</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      album_favorites</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      s</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      level_name</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      level</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      nextLevelExp</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      exp</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      expPercent</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      badges</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">[];</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      album_favorites_max</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">number</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      ad_free</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">boolean</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      ad_free_before</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      charge</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      jar</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &gt;(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">login</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> formData</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    transform</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        code</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">code</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        data</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          uid</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">Number</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">parseInt</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">uid</span><span style="--s-dark:#666666;--s-light:#999999">),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          username</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">username</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          email</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">email</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          avatar</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">photo</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          jCoin</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">coin</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          level</span><span style="--s-dark:#666666;--s-light:#999999">: [</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">level</span><span style="--s-dark:#666666;--s-light:#999999">, </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">level_name</span><span style="--s-dark:#666666;--s-light:#999999">],</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          currentExp</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">Number</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">parseInt</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">exp</span><span style="--s-dark:#666666;--s-light:#999999">),</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          nextLevelExp</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">nextLevelExp</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          collectCount</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">album_favorites</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          maxCollectCount</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">album_favorites_max</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">        },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      };</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  });</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">};</span></span></code></pre><p>这里有两个注意的点</p><p>一个是封装的时候不要添加 async ，即 <code>loginApi</code> 不要加 async ，不然 setup 内传入 <code>useRequest</code> 和 <code>usePagination</code> 会提示类型错误，原因是 <code>http.Post</code> 返回的是一个 <code>Method</code> 类型，它是一个类 Promise 而不是 Promise ，如果我们直接调用 <code>loginApi('username', 'password')</code> 是不会发起请求的，只有 <code>loginApi('username', 'password').then()</code> 才会。</p><p>另一个是 <code>http.Post</code> 的两个泛型分别是转换后类型以及转换前类型，如果接口需要进行数据转化的话，填写这两个类型可以在 <code>transform</code> 内获得良好的类型提示，如果不需要转化则直接编写第一个泛型即可。</p><p>在 setup 中，使用 <code>usePagination</code> 可以获取绝大部分的状态：</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> setup</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> lang</span><span style="--s-dark:#666666;--s-light:#999999">=</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ts</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> usePagination</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">alova/client</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> getComicListApi</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">@/apis</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34"> </span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  total</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">        // 总条数</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  page</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">         // 当前页码</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  pageSize</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">     // 每页大小</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  pageCount</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // 有多少页</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  data</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">         // 列表数据</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  send</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">         // 发起请求函数</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  loading</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">       // 加载状态</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> usePagination</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">page</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    getComicListApi</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">      page</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      content</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> formState</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">content</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      order</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> formState</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">order</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // 默认起始页和页大小</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    initialPage</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    initialPageSize</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 80</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // 这里 data 和 total 就是返回 data 和 total 所拿到的值</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    data</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">content</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    total</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">res</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> res</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">total</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // 这里可以设置额外的参数，这样 formState.order 变化时会直接重新发起请求</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    watchingStates</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> formState</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">order</span><span style="--s-dark:#666666;--s-light:#999999">],</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><h3 id="主进程的-ioc" tabindex="-1">主进程的 ioc <a class="header-anchor" href="#主进程的-ioc">🔗</a></h3><p>既然是自己写的项目，那就得玩玩一些平时用不上的东西。</p><p>所以这次我在项目里面使用了微软的依赖注入库 <a href="https://github.com/microsoft/tsyringe" target="_blank" rel="noopener">tsyringe</a> 。</p><p>这是一个轻量的 IOC 库，用法也很简单，和 spring 很相似。</p><p>首先我们要在 <code>tsconfig.json</code> 内开启装饰器支持。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-json"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">{</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">  "</span><span style="--s-dark:#B8A965;--s-light:#998418">compilerOptions</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">    "</span><span style="--s-dark:#B8A965;--s-light:#998418">experimentalDecorators</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">    "</span><span style="--s-dark:#B8A965;--s-light:#998418">emitDecoratorMetadata</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>接着我们还要安装一个 <code>reflect-metadata</code> ，它是一个对 Reflect 的一个扩展，可以让对象存储元数据，在入口处直接导入即可。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// electron/main.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">reflect-metadata</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ...</span></span></code></pre><p>接着我们给模块加上 <code>@singleton</code> 装饰器</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> singleton</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">tsyringe</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#80A665;--s-light:#59873A">singleton</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> class</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> PathService</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>这里使用 <code>singleton</code> 而不是 <code>injectable</code> 的原因是 <code>injectable</code> 每次注入都会生成一个新的对象，而 <code>singleton</code> 只会有一个对象。</p><p>要注意这样只是注册了这个类，如果我们直接运行容器内是不会有这个类的实例的，如果想要让类初始化实例，则需要调用另一个 API 。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// electron/main.ts</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> container</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">tsyringe</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> PathService</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">./modules/path</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// 初始化</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">instance</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> container</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">resolve</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">PathService</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span></code></pre><p>所以整个 electron 侧的逻辑就是在 <code>electron/modules</code> 下编写模块，然后在 <code>electron/main.ts</code> 调用 win 模块来初始化整个应用，不过这里目前还有一些问题，就是某些模块并不会和 win 模块存在依赖关系，通常只会通过 ipcMain 来监听一些事件然后处理，这里用的一个方法是注入但不使用</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> inject</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> singleton</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">tsyringe</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> DbService</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">../db</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">@</span><span style="--s-dark:#80A665;--s-light:#59873A">singleton</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">export</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> class</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WinService</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  //...</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  constructor</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // @ts-expect-error inject dbService</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    @</span><span style="--s-dark:#80A665;--s-light:#59873A">inject</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">DbService</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> private</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> dbService</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">DbService</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  )</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p>这里要加这个注释，不然 TypeScript 会报错。</p><p>或许这里改成扫描 <code>electron/modules</code> 下的模块并且直接 <code>container.resolve</code> 会更好？🤔</p><h3 id="better-sqlite3" tabindex="-1">better-sqlite3 <a class="header-anchor" href="#better-sqlite3">🔗</a></h3><p>在编写下载功能的时候，需要一个轻量的数据库，这里选用了 sqlite 。</p><p>这里提一嘴这个是可能在开发或者打包会报错，提示 node（或其他） 版本不正确问题。</p><p>这时需要使用执行 <code>electron-builder install-app-deps</code> 来讲依赖重新编译为当前环境的版本</p><p>可以在 <code>package.json</code> 添加 <code>postinstall</code> 来让 <code>pnpm i</code> 完成后触发</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-json"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">{</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">  "</span><span style="--s-dark:#B8A965;--s-light:#998418">scripts</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // ...</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">    "</span><span style="--s-dark:#B8A965;--s-light:#998418">postinstall</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">electron-builder install-app-deps</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><h3 id="快速引入字体" tabindex="-1">快速引入字体 <a class="header-anchor" href="#快速引入字体">🔗</a></h3><p>这里可以使用 <a href="https://github.com/fontsource/fontsource" target="_blank" rel="noopener">Fontsource</a> 。</p><p>这个仓库收录了开源可商用的字体，可以在<a href="https://fontsource.org/?query=roboto" target="_blank" rel="noopener">此处</a>搜索相应的字体。</p><p>导入也非常简单，安装对应的字体文件，然后导入即可。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-bash"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">pnpm</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> install</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> @fontsource/roboto</span></span></code></pre><p>引入：</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// src/main.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">@fontsource/roboto</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span></code></pre><p>然后在需要的地方使用即可。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-css"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">body</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  font-family</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">Roboto</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C99076;--s-light:#A65E2B"> sans-serif</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><h3 id="express-代理接口" tabindex="-1">Express 代理接口 <a class="header-anchor" href="#express-代理接口">🔗</a></h3><p>在生产环境下，应用会在主进程启动一个 Express 实例，来代理相关的接口。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// 核心代码</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">app</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> Express</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">app</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">use</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">  "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">/api</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  createProxyMiddleware</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    target</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">config</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">target</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    changeOrigin</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    secure</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">false</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    pathRewrite</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">      "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">^/api</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">""</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">);</span></span></code></pre><p>由于接口在大陆并不总是能使用，所以我们需要为这个代理启用一个“梯子”</p><p>做法就是配置它的 <code>agnet</code> 属性。</p><p>先安装 <code>https-proxy-agent</code> ，表明我们想代理一个 https 域名（这里要根据需要选择 <code>http-proxy-agent</code> 或者 <code>https-proxy-agent</code> ）。</p><p>使用很简单，如下：</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> HttpsProxyAgent</span><span style="--s-dark:#666666;--s-light:#999999"> }</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">https-proxy-agent</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// 核心代码</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">app</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> Express</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">app</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">use</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">  "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">/api</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  createProxyMiddleware</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    target</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">config</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">target</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    agent</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#CB7676;--s-light:#AB5959">new</span><span style="--s-dark:#80A665;--s-light:#59873A"> HttpsProxyAgent</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#C98A7D;--s-light:#B56959">http://localhost:10809</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    changeOrigin</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">true</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    secure</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4D9375;--s-light:#1E754F">false</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    pathRewrite</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#C98A7D77;--s-light:#B5695977">      "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">^/api</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">""</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }),</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">);</span></span></code></pre><p>这里的 <code>http://localhost:10809</code> 就是代理服务的域名，由于我们使用的是 <a href="https://github.com/2dust/v2rayN" target="_blank" rel="noopener">v2rayN</a> ，所以这里默认就是 <code>http://localhost:10809</code> 。</p><p>至于代理的这些信息，就通过渲染进程的用户填写后拿到。</p><h3 id="渲染进程使用代理" tabindex="-1">渲染进程使用代理 <a class="header-anchor" href="#渲染进程使用代理">🔗</a></h3><p>除了 Express ，在渲染进程中我们需要访问第三方的图片，在网络不好的时候，我们希望使用代理进行加速，这里需要导入 electron 的 <code>session</code> ，然后使用 <a href="https://www.electronjs.org/docs/latest/api/structures/proxy-config" target="_blank" rel="noopener">setProxy</a> 这个方法。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-javascript"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">import</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  session</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> from</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">electron</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">session</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">defaultSession</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">setProxy</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // 默认就为 fixed_servers </span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // 需要设置 proxyRules 才能生效</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  mode</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">fixed_servers</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  proxyRules</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">http://localhost:10809</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><p>这样设置之后渲染进程的请求就会走这个代理。</p><h3 id="缩放" tabindex="-1">缩放 <a class="header-anchor" href="#缩放">🔗</a></h3><p>electron 提供给了我们一个 <code>win.webContents.setZoomFactor(zoomFactor)</code> 来设置缩放因子</p><p>但是要注意，这个功能默认是关闭的，直接调用这个方法是没法改变的，这里需要先调用 <code>win.webContents.setVisualZoomLevelLimits(1, 3)</code> 后再调用 <code>win.webContents.setZoomFactor(zoomFactor)</code> 才能成功缩放，这里当时卡了很久…</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// 必须先调用 setVisualZoomLevelLimits 解除缩放限制</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">win</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">webContents</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">setVisualZoomLevelLimits</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 3</span><span style="--s-dark:#666666;--s-light:#999999">).</span><span style="--s-dark:#80A665;--s-light:#59873A">then</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  win</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">webContents</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">setZoomFactor</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">zoomFactor</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">});</span></span></code></pre><h3 id="记录用户窗口位置" tabindex="-1">记录用户窗口位置 <a class="header-anchor" href="#记录用户窗口位置">🔗</a></h3><p>核心的 API 是 <code>win.getBounds()</code> 可以获取窗口当前的位置和大小，我们只需在退出前将信息保存在本地，然后下次启动前读取这个信息设置位置和大小即可。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// 保存</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">rect</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> win</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">getBounds</span><span style="--s-dark:#666666;--s-light:#999999">();</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">writeToLocal</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">rect</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// 读取</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">rect</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> getFromLocal</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">bounds</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">);</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">win</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#C99076;--s-light:#A65E2B">this</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">win</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> new </span><span style="--s-dark:#80A665;--s-light:#59873A">BrowserWindow</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // ...</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  x</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">rect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">x</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  y</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">rect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">y</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  width</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">rect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">width</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  height</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">rect</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">height</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}));</span></span></code></pre><h3 id="使用工作流" tabindex="-1">使用工作流 <a class="header-anchor" href="#使用工作流">🔗</a></h3><p>因为仓库是在 github 上开源的，所以可以使用工作流来帮我们打多个环境的包。</p><p>在本项目中，有两个工作流，一个是监听 tag 推送然后根据 tag 打包，一个是手动触发的最新打包。</p><p>监听 tag 只需要如下配置：</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-yml"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">on</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  push</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    tags</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      -</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">v*.*.*</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  # 只在版本标签推送时触发</span></span></code></pre><p>这里我们使用 <code>npm version major|minor|patch</code> 命令来更新版本，这个命令会生成一个提交，在这个提交上面标上一个 tag 。</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2024/11/12/20241112213139986.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2024/11/12/20241112213139986.avif" alt=""></a></p><p>接着我们 <code>git push &amp;&amp; git push origin v1.9.0</code> 来把这个 tag 提交到远程就可以触发上面的工作流了。</p><p>手动触发的则需要使用如下配置</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-yml"><span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">on</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  workflow_dispatch</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span></code></pre><p>这样在 Actions 页面就有一个按钮可以启动工作流了。</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2024/11/12/20241112213514897.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2024/11/12/20241112213514897.avif" alt=""></a></p><p>一般使用工作流的时候，基本上是在 linux 上跑的，但是 electron 的打包是需要在对应系统上打对应系统的包的，即 linux 只能打 linux 的包，而 windows 只能打 windows 的包，所以我们需要配置一下，让工作流跑两个环境，核心就是下面这个配置。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-yml"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">jobs</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  build</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Build ${{ matrix.os }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    runs-on</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> ${{ matrix.os }}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    strategy</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      matrix</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        os</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ubuntu-latest</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> windows-latest</span><span style="--s-dark:#666666;--s-light:#999999">]</span></span></code></pre><p>这样子就会有两个任务在跑。</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2024/11/12/20241112213813927.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2024/11/12/20241112213813927.avif" alt=""></a></p><p>然后某些步骤如果需要指定只在某个环境跑，可以在步骤上用一个 if 语法，比如如果要缓存 pnpm 的包的话，在 window 上的路径和 linux 上的路径不一样，所以需要两个 step 。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-yml"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">jobs</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  build</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Build ${{ matrix.os }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    runs-on</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> ${{ matrix.os }}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    strategy</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      matrix</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        os</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ubuntu-latest</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> windows-latest</span><span style="--s-dark:#666666;--s-light:#999999">]</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    steps</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      -</span><span style="--s-dark:#B8A965;--s-light:#998418"> name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Cache Linux pnpm</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">        # 只在 linux 上执行这个步骤</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        if</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> matrix.os == 'ubuntu-latest'</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        uses</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> actions/cache@v4</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        with</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          path</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> ~/.local/share/pnpm/store</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          key</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> pnpm-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          restore-keys</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> |</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">            pnpm-${{ runner.os }}-</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">      </span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      -</span><span style="--s-dark:#B8A965;--s-light:#998418"> name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Cache Windows pnpm</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">        # 只在 windows 上执行这个步骤</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        if</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> matrix.os == 'windows-latest'</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        uses</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> actions/cache@v4</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        with</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          path</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> D:\.pnpm-store</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          key</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> pnpm-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          restore-keys</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> |</span></span>
<span class="line"><span style="--s-dark:#C98A7D;--s-light:#B56959">            pnpm-${{ runner.os }}-</span></span></code></pre><p>最后，如果是基于 tag 的推送的，可以借助 electron-builder 自动提交到 release 上。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-yml"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">jobs</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  build</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Build ${{ matrix.os }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    runs-on</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> ${{ matrix.os }}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    strategy</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      matrix</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        os</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ubuntu-latest</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> windows-latest</span><span style="--s-dark:#666666;--s-light:#999999">]</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    steps</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      # ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      -</span><span style="--s-dark:#B8A965;--s-light:#998418"> name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Build Electron App</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        env</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          GH_TOKEN</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> ${{ secrets.GH_TOKEN }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        run</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> pnpm run build</span></span></code></pre><p>这里记得要注入 <code>GH_TOKEN</code> ，这样才能推送成功，<code>pnpm run build</code> 实际上运行了 <code>vite build &amp;&amp; electron-builder --publish always</code> 这里自动推送就是 <code>--publish always</code> 起作用。</p><p>而如果是基于最新的打包，则需要指定 <code>--publish</code> 为 <code>never</code> ，然后借助工作流 Artifacts 暂存文件，将打包后的文件上传到这里即可，这里需要使用 <code>actions/upload-artifact</code> 。</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-yml"><span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">jobs</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">  build</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Build ${{ matrix.os }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    runs-on</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> ${{ matrix.os }}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    strategy</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">      matrix</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        os</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#C98A7D;--s-light:#B56959">ubuntu-latest</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> windows-latest</span><span style="--s-dark:#666666;--s-light:#999999">]</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    steps</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">      # ...</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      -</span><span style="--s-dark:#B8A965;--s-light:#998418"> name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Upload Linux Artifacts</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        if</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> matrix.os == 'ubuntu-latest'</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        uses</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> actions/upload-artifact@v4</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        with</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          # 通过 github.sha 来区分文件</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> linux-release-assets-${{ github.sha }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          path</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> release/*/jm-desktop-Linux-*.zip</span></span>
<span class="line"><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">  </span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      -</span><span style="--s-dark:#B8A965;--s-light:#998418"> name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> Upload Windows Artifacts</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        if</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> matrix.os == 'windows-latest'</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        uses</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> actions/upload-artifact@v4</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        with</span><span style="--s-dark:#666666;--s-light:#999999">:</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">          # 通过 github.sha 来区分文件</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          name</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> windows-release-assets-${{ github.sha }}</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">          path</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D;--s-light:#B56959"> release/*/jm-desktop-Windows-*.zip</span></span></code></pre><h1 id="后记" tabindex="-1">后记 <a class="header-anchor" href="#后记">🔗</a></h1><p>虽然启动慢了点，但是功能上还是相当完整的，自己还是非常开心能够完成这个项目。</p><p><s>虽然在不起眼的地方有很多 bug 。</s></p><p><s>在修了在修了，新建 fix 分支。</s></p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#electron</div><div>#vue</div><div>#react</div><div>#vuetify</div><div>#ant-design-vue</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/f87197598d02" class="" truncate="" title="TypeScript 5.7（译）"><i class="i-mi:chevron-left" mr-1=""></i><span>TypeScript 5.7（译）</span></a><a href="/d5936495bfca" class="" ml-auto="" truncate="" title="记一次分析某漫的图片"><span>记一次分析某漫的图片</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-93b0ae89="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-93b0ae89=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-93b0ae89=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-93b0ae89=""></i></div><div flex="~ col grow" gap-4="" data-v-93b0ae89=""><textarea disabled="" placeholder="万水千山总是情，留下评论行不行" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" lg:p-4="" data-v-93b0ae89=""></textarea><div flex="" items-start="" justify-between="" data-v-93b0ae89=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-93b0ae89="">支持 Markdown 语法 </a><button class="mujika-git-talk-button" cursor-pointer="" data-v-93b0ae89="">点击登录</button></div></div></div><!--]--></div></div><!----><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">文章目录</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-d1d7a153=""><div flex="" items-center="" data-v-d1d7a153=""><span data-v-d1d7a153="">Power by&nbsp;</span><i class="i-logos:vue" data-v-d1d7a153=""></i><span data-v-d1d7a153="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-d1d7a153=""></i></div><div text-center="" data-v-d1d7a153=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-d1d7a153="">CC BY-NC-SA 4.0 </a>2021 - PRESENT © Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-d1d7a153="">如果我和狗一样有尾巴的话，一定会藏不住这份喜悦，而尾巴一直摇个不停吧。</div></footer></div></div></body></html>