<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>恋の歌</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-CQORsqEe.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-BeLlpy4Q.css"><link rel="modulepreload" crossorigin="" href="/assets/使用-VSCode-远程连接-Docker-容器-Ccx-hVcX.js"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-50c24b4d=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-50c24b4d=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="恋の歌的logo" data-v-50c24b4d=""></a><div flex="" gap-2="" items-center="" lg:gap-4="" data-v-50c24b4d=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-50c24b4d=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="自动" data-v-50c24b4d=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="日间" data-v-50c24b4d=""><!--[--><i class="i-ri:sun-line" data-v-50c24b4d=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="夜间" data-v-50c24b4d=""><!--[--><i class="i-ri:moon-line" data-v-50c24b4d=""></i><!--]--></div><!--]--></div><a href="/archive" class="" data-v-50c24b4d=""><i class="i-mi:archive" data-v-50c24b4d=""></i> 归档</a></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">使用 VSCode 远程连接 Docker 容器</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">发表于</span><span pl-1="">2022-07-18 18:32</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">更新于</span><span pl-1="">2023-02-13 18:28</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">分类于</span><!--[--><a pl-1="" href="/category/编程">编程</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">总字数</span><span pl-1="">1.4K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">阅读时长 ≈</span><span pl-1="">5 分钟</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><h1 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言">🔗</a></h1><p>使用 <code>VSCode</code> 远程连接 <code>Docker</code> 容器</p><p><code>Docker</code> 之前也有听过，但是工作中一直没有场景需要用到，加上我懒，也就没有去学了</p><p>这次需求刚好需要我去跑公司的容器来作为开发环境，所以就趁这次机会来使用 <code>Docker</code></p><h1 id="正文" tabindex="-1">正文 <a class="header-anchor" href="#正文">🔗</a></h1><p><code>Docker</code> 我个人的理解，最大的优势是把执行的环境一起打包了，这在 <code>Docker</code> 中称之为镜像</p><p>在 <code>Docker</code> 还没出现之前，部署的时候我们要通过 <code>SSH</code> 登录到远程的部署环境，然后修改远程的环境配置</p><p>而远程主机的环境可能还部署了其他的应用，不同应用之前可能就会存在冲突</p><p>而 <code>Docker</code> 通过虚拟化出一个子系统来和主机进行隔离，这样在子系统里面的操作不会影响到主机的环境，类似于沙箱</p><p>这样子交付软件的时候就可以交付一个完整的“系统”，然后通过 <code>Docker</code> 直接启动即可，非常方便</p><p>在 <code>windows</code> 上，我们需要安装 <code>Docker Desktop</code> 来管理 <code>Docker</code> 容器</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232253227.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232253227.avif" alt=""></a></p><p>当然，本文主要是将如何通过 <code>VSCode</code> 来连接容器</p><p>我们可以通过两种方式</p><ul><li>通过 <code>Remote SSH</code> 扩展连接（ <code>SSH</code> 方式）</li><li>通过 <code>Remote Container</code> 扩展直接连接</li></ul><p>在这之前，我们需要安装两个插件</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232259826.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232259826.avif" alt=""></a></p><p>当然，如果你的 <code>windows</code> 上有 <code>linux</code> 子系统，那么还可以安装 <code>Remote-WSL</code> 那个插件，也可以直接连接到 <code>WSL</code> 子系统</p><p>如果 <code>windows</code> 上有 <code>WSL</code> 子系统，那么 <code>Docker</code> 会基于 <code>WSL</code> 来虚拟化容器（应该是这样）</p><p>在设置中可以看到对应的提示</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232307452.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232307452.avif" alt=""></a></p><h2 id="remote-ssh-方式" tabindex="-1"><code>Remote SSH</code> 方式 <a class="header-anchor" href="#remote-ssh-方式">🔗</a></h2><p>在安装完 <code>Remote SSH</code> 之后，左侧会有一个小电视的图片，点击然后我们切换到 <code>SSH Targets</code></p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232309045.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232309045.avif" alt=""></a></p><p>点击 <code>+</code> 号，就会弹出一个框让你新建一个 <code>SSH</code> 连接，当然，我们一般是以 <code>root</code> 连接</p><p>所以我们填入 <code>ssh root@localhost -p 8083</code> ，<code>-p</code> 的意思是指定端口</p><p>点击之后会选择保存到哪个配置文件，这里我们选择第一个即可</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232318565.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/23/202207232318565.avif" alt=""></a></p><p>点击之后就会提示保存成功，左侧也会出现我们的新建的连接</p><p>这里我们使用了 <code>8083</code> 作为连接端口，我们需要通过 <code>Docker</code> 映射到容器内的 <code>22</code> 端口（ <code>SSH</code> 的默认端口）</p><p>那你可能会问了，我启动容器的时候忘记映射了怎么办</p><p>没关系，这里有两个办法</p><ul><li>把当前的容器保存为镜像，然后通过这个镜像启动，附加上端口映射的参数</li><li>通过修改容器的配置参数来新增端口映射</li></ul><p>这里我们主要讲第二种</p><p>在 <code>linux</code> 下，我们可以很容易在网上找到容器对应的配置文件夹，在 <code>/var/lib/docker</code> 下</p><p>而在 <code>windows</code> 下，我发现网上并没有帖子指出容器的存放位置，最后还是在其他的 <code>Docker</code> 帖子下面找到的</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241215647.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241215647.avif" alt=""></a></p><p>要怎么确定你的容器是哪一个文件夹呢</p><p>可以打开 <code>Docker Desktop</code> 上看容器的 <code>Name</code> 字段</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241234766.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241234766.avif" alt=""></a></p><p>进入文件夹之后我们可以看到 <code>hostconfig.json</code> 文件，打开它</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241239996.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241239996.avif" alt=""></a></p><p>有个 <code>PortBindings</code> 字段，这个字段保存了端口映射的信息</p><p>我们需要把容器的 <code>22</code> 端口映射到外部的 <code>8083</code> 端口，所以我们要添加下面这一行</p><p>因为 <code>SSH</code> 走的 <code>TCP</code> 协议，所以我们需要指定 <code>22</code> 端口为 <code>TCP</code> 类型</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-json"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">{</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">  "</span><span style="--s-dark:#B8A965;--s-light:#998418">PortBindings</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">    "</span><span style="--s-dark:#B8A965;--s-light:#998418">22/tcp</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#666666;--s-light:#999999"> [</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      {</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">        "</span><span style="--s-dark:#B8A965;--s-light:#998418">HostIp</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> ""</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#B8A96577;--s-light:#99841877">        "</span><span style="--s-dark:#B8A965;--s-light:#998418">HostPort</span><span style="--s-dark:#B8A96577;--s-light:#99841877">"</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> "</span><span style="--s-dark:#C98A7D;--s-light:#B56959">8083</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">"</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    ]</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><p><strong>重要：在修改这个文件之前要完全退出 <code>Docker Desktop</code> ，不然修改会失效！！！</strong></p><p><strong>重要：在修改这个文件之前要完全退出 <code>Docker Desktop</code> ，不然修改会失效！！！</strong></p><p><strong>重要：在修改这个文件之前要完全退出 <code>Docker Desktop</code> ，不然修改会失效！！！</strong></p><p>完成之后我们就可以重新启动容器了，接下来我们进入容器内</p><p>我们要确保容器内运行了 <code>ssh-server</code> 服务，通常情况下，<code>linux</code> 只安装了 <code>ssh-client</code> ，也就是支持本机去连接其他的机器，但是不支持其他的机器连接到本机</p><p>我们需要执行 <code>apt install openssh-server</code> 来安装</p><p>安装完成之后确保服务已经开启，可以使用 <code>/etc/init.d/ssh status</code> 来查看有没有启动</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241256792.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241256792.avif" alt=""></a></p><p>启动我们使用 <code>/etc/init.d/ssh start</code> 即可</p><p>启动的时候我们可能会遇到 <code>sshd: no hostkeys available -- exiting</code> 的错误，我们只需要执行 <code>ssh-keygen -A</code> 生成一个 <code>SSH</code> 的密钥，之后便可以成功启动</p><p>然后我们需要修改 <code>SSH</code> 的配置文件，用 vi 打开 /etc/ssh/ssh_config 文件，加上 <code>PermitRootLogin yes</code> 意思是运行 <code>root</code> 登录，加上 <code>PasswordAuthentication yes</code> 意识是允许通过密码验证</p><p>修改完成保存之后，我们重启 <code>SSH</code> ，命令为 <code>/etc/init.d/ssh restart</code></p><p>然后我们要给 <code>root</code> 设置一个密码，通过 <code>passwd</code> 指令</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241310137.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241310137.avif" alt=""></a></p><p>然后我们就可以通过 <code>VSCode</code> 来连接容器了，点击我们之前保存的 <code>SSH</code> 连接，右侧有个连接图标</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241311221.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241311221.avif" alt=""></a></p><h2 id="remote-container-方式" tabindex="-1"><code>Remote Container</code> 方式 <a class="header-anchor" href="#remote-container-方式">🔗</a></h2><p>这个就相当简单了，我们在小电视 <code>tab</code> 上切换到 <code>Containers</code> ，<code>VSCode</code> 就会列出当前的容器列表</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241313981.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241313981.avif" alt=""></a></p><p>然后我们只需要右键容器，选择 <code>attach in new window</code> 即可打开容器</p><p><a data-fancybox="doc-gallery" href="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241314925.avif" target="_blank" rel="noopener noreferrer"><img src="https://fastly.jsdelivr.net/gh/Dedicatus546/image@main/2022/07/24/202207241314925.avif" alt=""></a></p><h1 id="后记" tabindex="-1">后记 <a class="header-anchor" href="#后记">🔗</a></h1><p>这两种第二种是比较简单的，但是这是 <code>Docker</code> 运行在本机上才能这么搞</p><p>如果容器泡在远程主机上，那么就只能老老实实通过 <code>SSH</code> 来连接了</p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#Docker</div><div>#VSCode</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/b422e873674f" class="" truncate="" title="VSCode 远程调试 Node 程序 Rg 进程 CPU 占用过高问题"><i class="i-mi:chevron-left" mr-1=""></i><span>VSCode 远程调试 Node 程序 Rg 进程 CPU 占用过高问题</span></a><a href="/ddb2cb406b9e" class="" ml-auto="" truncate="" title="在 Angular 中引入 NgRx（Angular-Redux） 全局状态管理库"><span>在 Angular 中引入 NgRx（Angular-Redux） 全局状态管理库</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-81763621="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-81763621=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-81763621=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-81763621=""></i></div><div flex="~ col grow" gap-2="" lg:gap-4="" data-v-81763621=""><textarea disabled="" placeholder="万水千山总是情，留下评论行不行" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" h-4em="" lg:p-4="" lg:h-8em="" data-v-81763621=""></textarea><div flex="" items-start="" data-v-81763621=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-81763621="">支持 Markdown 语法</a><div ml-auto="" data-v-81763621=""></div><!----><button class="mujika-button" data-v-81763621="" data-v-15330f5f=""><!--[--><!--]--><!--[-->点击登录<!--]--></button></div></div></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-81763621="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" items-center="" justify-center="" data-v-81763621="">哦呢该，如果没有评论的话，瓦达西...</div><!----><!--]--></div></div><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">文章目录</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-689781c6=""><div flex="" items-center="" data-v-689781c6=""><span data-v-689781c6="">由&nbsp;</span><i class="i-logos:vue" data-v-689781c6=""></i><span data-v-689781c6="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-689781c6=""></i><span data-v-689781c6="">&nbsp;驱动</span></div><div text-center="" data-v-689781c6=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-689781c6="">CC BY-NC-SA 4.0 </a>2021 - PRESENT © Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-689781c6="">如果我和狗一样有尾巴的话，一定会藏不住这份喜悦，而尾巴一直摇个不停吧。 - 《秒速五厘米》</div></footer></div></div></body></html>