<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/logo.svg"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vue3.0çš„Reactivity-APIsï¼ˆè¯‘ï¼‰</title><script type="importmap">{"imports":{"vue":"https://esm.sh/vue","vue-router":"https://esm.sh/vue-router","pinia":"https://esm.sh/pinia","@vueuse/core":"https://esm.sh/@vueuse/core","@vueuse/components":"https://esm.sh/@vueuse/components","@vueuse/router":"https://esm.sh/@vueuse/router","date-fns":"https://esm.sh/date-fns","nprogress":"https://esm.sh/nprogress","octokit":"https://esm.sh/octokit","pinia-plugin-persistedstate":"https://esm.sh/pinia-plugin-persistedstate","vue-router-better-scroller":"https://esm.sh/vue-router-better-scroller"}}</script><script type="module" async="" crossorigin="" src="/assets/app-kEKefLn2.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-DjlQYv3q.css"><link rel="modulepreload" crossorigin="" href="/assets/Vue3-0çš„Reactivity-APIsï¼ˆè¯‘ï¼‰-BOuiEBct.js"><meta property="og:title" content="Vue3.0çš„Reactivity-APIsï¼ˆè¯‘ï¼‰"><meta name="twitter:title" content="Vue3.0çš„Reactivity-APIsï¼ˆè¯‘ï¼‰"></head><body><div id="app" data-server-rendered="true"><div class="mujika" min-h="100vh" flex="~ col" bg="[--mygo-c-bg-alt]"><header class="mujika-header" flex="~ shrink-0" px-4="" h="70px" bg="[var(--mygo-c-bg)]" items-center="" justify-between="" data-v-c1947e25=""><a href="/" class="" flex="" gap-4="" items-center="" data-v-c1947e25=""><img w="40px" aspect-ratio-square="" src="/logo.svg" alt="æ‹ã®æ­Œçš„logo" data-v-c1947e25=""></a><div data-v-c1947e25=""><div p-1="" flex="" gap-1="" rounded="6px" bg="[var(--mygo-c-bg-alt)]" data-v-c1947e25=""><!--[--><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="bg-[var(--mygo-c-bg)]" title="è‡ªåŠ¨" data-v-c1947e25=""><!--[-->Auto<!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="æ—¥é—´" data-v-c1947e25=""><!--[--><i class="i-ri:sun-line" data-v-c1947e25=""></i><!--]--></div><div leading="[1]" px-2="" py-1="" cursor-pointer="" rounded="6px" class="" title="å¤œé—´" data-v-c1947e25=""><!--[--><i class="i-ri:moon-line" data-v-c1947e25=""></i><!--]--></div><!--]--></div></div></header><main class="mujika-home" flex="grow" mx="auto" min-h="0" p-2="" w-full="" un-2xl:w="[calc(96rem-var(--spacing)*2)]"><div flex="" gap-2="" items-start=""><div flex="~ col grow" gap-2="" min-w-0=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ col" mb-4="" gap-4=""><h1 break-all="" text="34px center">Vue3.0çš„Reactivity-APIsï¼ˆè¯‘ï¼‰</h1></div><div flex="~ col" gap-3="" text="[var(--mygo-c-text-2)]"><div flex="~ wrap" gap-3="" justify-center=""><!----><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar"></i><span un-hidden="" lg:inline="">å‘è¡¨äº</span><span pl-1="">2020-06-12 10:57</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:calendar-check"></i><span un-hidden="" lg:inline="">æ›´æ–°äº</span><span pl-1="">2023-07-26 23:09</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:folder"></i><span un-hidden="" lg:inline="">åˆ†ç±»äº</span><!--[--><a pl-1="" href="/category/ç¿»è¯‘">ç¿»è¯‘</a><!--]--></div></div><div flex="~ wrap" gap-3="" justify-center=""><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:file-word"></i><span un-hidden="" lg:inline="">æ€»å­—æ•°</span><span pl-1="">3.3K</span></div><div flex="" gap-1="" items-center=""><i class="i-fa6-regular:clock"></i><span un-hidden="" lg:inline="">é˜…è¯»æ—¶é•¿ â‰ˆ</span><span pl-1="">12 åˆ†é’Ÿ</span></div></div></div><div class="mujika-doc-content"><!--[--><div class="kan-doc"><h1 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€">ğŸ”—</a></h1><p>Vue3.0çš„APIæ–‡æ¡£</p><blockquote><p><a href="https://vue-composition-api-rfc.netlify.app/api.html" target="_blank" rel="noopener">Vue Composition API</a></p></blockquote><p>æ¥è¯‘ä¸‹Reactivity APIsçš„éƒ¨åˆ†</p><h1 id="æ­£æ–‡" tabindex="-1">æ­£æ–‡ <a class="header-anchor" href="#æ­£æ–‡">ğŸ”—</a></h1><p>è¿™ä¸ªç›®å½•ä¸‹æœ‰å…­ä¸ªAPIï¼Œåˆ†åˆ«æ˜¯</p><ul><li><code>reactive</code></li><li><code>ref</code></li><li><code>computed</code></li><li><code>readonly</code></li><li><code>watchEffect</code></li><li><code>watch</code></li></ul><h2 id="reactive" tabindex="-1"><code>reactive</code> <a class="header-anchor" href="#reactive">ğŸ”—</a></h2><p>Takes an object and returns a reactive proxy of the original. This is equivalent to 2.xâ€™s <code>Vue.observable()</code>.</p><p>æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›å®ƒçš„ä¸€ä¸ªå“åº”å¼ä»£ç†å¯¹è±¡ã€‚æ­¤APIå’Œ2.xç‰ˆæœ¬çš„<code>Vue.observable()</code>ç›¸åŒã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">obj</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">({ </span><span style="--s-dark:#B8A965;--s-light:#998418">count</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999"> })</span></span></code></pre><p>The reactive conversion is â€œdeepâ€: it affects all nested properties. In the ES2015 Proxy based implementation, the returned proxy is not equal to the original object. It is recommended to work exclusively with the reactive proxy and avoid relying on the original object.</p><p>å“åº”å¼çš„è½¬åŒ–æ˜¯â€æ·±å±‚æ¬¡â€çš„ï¼šå®ƒä¼šå½±å“å…¨éƒ¨çš„åµŒå¥—å±æ€§ã€‚åœ¨ES2015Proxyçš„å®ç°ä¸‹ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡å’Œæºå¯¹è±¡ä¸ç›¸ç­‰ã€‚æ¨èç›´æ¥æ“ä½œå“åº”å¼ä»£ç†å¯¹è±¡ï¼Œé¿å…ä¾èµ–æºå¯¹è±¡ã€‚</p><ul><li>Typingï¼ˆç±»å‹å®šä¹‰ï¼‰</li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> object</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">raw</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span></span></code></pre><h2 id="ref" tabindex="-1"><code>ref</code> <a class="header-anchor" href="#ref">ğŸ”—</a></h2><p>Takes an inner value and returns a reactive and mutable ref object. The ref object has a single property <code>.value</code> that points to the inner value.</p><p>æ¥æ”¶ä¸€ä¸ªå†…éƒ¨å€¼ï¼Œè¿”å›ä¸€ä¸ªå“åº”å¼ä¸”å¯å˜çš„refå¯¹è±¡ï¼Œrefå¯¹è±¡æœ‰ä¸€ä¸ªå•ä¸€çš„å±æ€§<code>.value</code>ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘æ¥æ”¶çš„å†…éƒ¨å€¼ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 0</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 1</span></span></code></pre><p>If an object is assigned as a refâ€™s value, the object is made deeply reactive by the reactive method.</p><p>å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«åˆ†é…ä¸ºä¸€ä¸ªrefçš„valueï¼Œè¿™ä¸ªå¯¹è±¡ä¼šé€šè¿‡reactiveæ–¹æ³•å»ºç«‹æ·±å±‚æ¬¡çš„å“åº”å¼ã€‚</p><ul><li><p>Access in Templatesï¼ˆåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼‰</p><p>When a ref is returned as a property on the render context (the object returned from <code>setup()</code>) and accessed in the template, it automatically unwraps to the inner value. There is no need to append <code>.value</code> in the template:</p><p>å½“ä¸€ä¸ªrefå¯¹è±¡åœ¨æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­ä»¥ä¸€ä¸ªå±æ€§è¿”å›ï¼ˆè¿™ä¸ªè¿”å›æŒ‡<code>setup()</code>è¿”å›çš„å¯¹è±¡ï¼‰å¹¶ä¸”åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åœ°æ‹†å¼€ï¼ŒæŒ‡å‘å†…éƒ¨çš„valueã€‚æ‰€ä»¥ä¸éœ€è¦å†æ¨¡æ¿ä¸­åŠ ä¸Š<code>.value</code>æ¥å–å€¼ï¼š</p></li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  &lt;!-- è¿™é‡Œä¸ç”¨.valueå–å€¼ï¼Œè‡ªåŠ¨å–åˆ°.value --&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ count }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">        count</span><span style="--s-dark:#666666;--s-light:#999999">:</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><ul><li><p>Access in Reactive Objectsï¼ˆåœ¨å“åº”å¼å¯¹è±¡ä¸­ä½¿ç”¨ï¼‰</p><p>When a ref is accessed or mutated as a property of a <code>reactive</code> object, it automatically unwraps to the inner value so it behaves like a normal property:</p><p>å½“ä¸€ä¸ªrefå¯¹è±¡ä½œä¸ºä¸€ä¸ªå“åº”å¼å¯¹è±¡è¢«ä½¿ç”¨å’Œæ”¹å˜æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åœ°æ‹†å¼€ï¼Œå¹¶æŒ‡å‘å†…éƒ¨çš„valueï¼Œæ‰€ä»¥å®ƒè¡Œä¸ºä¸Šå°±åƒä¸€ä¸ªæ™®é€šçš„å±æ€§ï¼š</p></li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">state</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  count</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">state</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 0</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">state</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 1</span></span></code></pre><p>Note that if a new ref is assigned to a property linked to an existing ref, it will replace the old ref:</p><p>æ³¨æ„å¦‚æœä¸€ä¸ªå·²å­˜åœ¨çš„refå±æ€§è¢«åˆ†é…ç»™ä¸€ä¸ªæ–°çš„refå¯¹è±¡æ—¶ï¼Œå®ƒä¼šæ›¿æ¢æ‰æ—§çš„refå¯¹è±¡ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">otherCount</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">2</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">state</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> otherCount</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">state</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 2</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 1</span></span></code></pre><p>Note that ref unwrapping only happens when nested inside a reactive <code>Object</code>. There is no unwrapping performed when the ref is accessed from an <code>Array</code> or a native collection type like <code>Map</code>:</p><p>æ³¨æ„refå¯¹è±¡çš„æ‹†å¼€åªä¼šå½“å‘ç”Ÿåœ¨åµŒå¥—çš„å“åº”å¼å¯¹è±¡ä¸­ï¼Œå½“refå¯¹è±¡ä»ä¸€ä¸ªæ•°ç»„ä¸­æˆ–è€…ä»ä¸€ä¸ªåŸç”Ÿçš„é›†åˆç±»å‹æ¯”å¦‚Mapä¸­è·å–æ—¶ä¸ä¼šè¡¨ç°å‡ºæ‹†å¼€è¿™ä¸€åŠ¨ä½œã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">arr</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">([</span><span style="--s-dark:#80A665;--s-light:#59873A">ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)])</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// need .value here</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// éœ€è¦.valueå–å€¼</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">arr</span><span style="--s-dark:#666666;--s-light:#999999">[</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">].</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">map</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">new </span><span style="--s-dark:#80A665;--s-light:#59873A">Map</span><span style="--s-dark:#666666;--s-light:#999999">([[</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">foo</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)]]))</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// need .value here</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">map</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">get</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">foo</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">).</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><ul><li>Typingï¼ˆç±»å‹ï¼‰</li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">interface</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>Sometimes we may need to specify complex types for a refâ€™s inner value. We can do that succinctly by passing a generics argument when calling ref to override the default inference:</p><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸ºä¸€ä¸ªrefçš„å†…éƒ¨å€¼æŒ‡æ˜å¤æ‚çš„ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨refå‡½æ•°æ—¶é€šè¿‡ä¼ é€’æ³›å‹å‚æ•°æ¥è¦†ç›–é»˜è®¤çš„æ¨æ–­ï¼Œä»è€Œç®€æ´åœ°å®ç°è¿™ä¸ªæ•ˆæœï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// fooå˜é‡å¯ä»¥ä¸ºstringç±»å‹æˆ–è€…numberç±»å‹</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">foo</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999"> |</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> number</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">foo</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // foo's type: Ref&lt;string | number&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">foo</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 123</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok!</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// ä¸‹é¢ä¹Ÿå¯ä»¥ï¼Œtsä¸ä¼šå‡ºç°é”™è¯¯</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">foo</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977"> '</span><span style="--s-dark:#C98A7D;--s-light:#B56959">123</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // ok!</span></span></code></pre><h2 id="computed" tabindex="-1"><code>computed</code> <a class="header-anchor" href="#computed">ğŸ”—</a></h2><p>Takes a getter function and returns an immutable reactive ref object for the returned value from the getter.</p><p>æ¥æ”¶ä¸€ä¸ªgetterå‡½æ•°ï¼Œä¸ºè¿™ä¸ªgetterçš„è¿”å›å€¼åˆ›å»ºä¸€ä¸ªå¯å˜çš„å“åº”å¼refå¯¹è±¡ï¼Œè¿”å›è¿™ä¸ªå“åº”å¼refå¯¹è±¡ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">plusOne</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> + </span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">plusOne</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 2</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">plusOne</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // error é”™è¯¯ï¼ŒåŸå› æ²¡æœ‰setterå‡½æ•°</span></span></code></pre><p>Alternatively, it can take an object with <code>get</code> and <code>set</code> functions to create a writable ref object.</p><p>æˆ–è€…ï¼Œå¯ä»¥æ¥æ”¶<code>get</code>å’Œ<code>set</code>å‡½æ•°ç»„æˆçš„å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå¯å†™çš„refå¯¹è±¡ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">1</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">plusOne</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">({</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  get</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> +</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  set</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#BD976A;--s-light:#B07D48">val</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt; {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> = </span><span style="--s-dark:#BD976A;--s-light:#B07D48">val</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> -</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">plusOne</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 1</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // 0</span></span></code></pre><ul><li>Typingï¼ˆç±»å‹ï¼‰</li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// read-only</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// åªè¯»</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#80A665;--s-light:#59873A">getter</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Readonly</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">Readonly</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;&gt;&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// writable</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// å¯å†™</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> computed</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">options</span><span style="--s-dark:#666666;--s-light:#999999">: {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  get</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  set</span><span style="--s-dark:#666666;--s-light:#999999">: (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><h2 id="readonly" tabindex="-1"><code>readonly</code> <a class="header-anchor" href="#readonly">ğŸ”—</a></h2><p>Takes an object (reactive or plain) or a ref and returns a readonly proxy to the original. A readonly proxy is deep: any nested property accessed will be readonly as well.</p><p>æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼ˆå“åº”å¼å¯¹è±¡æˆ–è€…æ™®é€šçš„å¯¹è±¡ï¼‰æˆ–è€…ä¸€ä¸ªrefå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªåŸå§‹å¯¹è±¡ï¼ˆå³ä¼ å…¥çš„å¯¹è±¡ï¼‰çš„åªè¯»çš„ä»£ç†å¯¹è±¡ã€‚ä¸€ä¸ªåªè¯»çš„ä»£ç†å¯¹è±¡ä¸ºæ·±å±‚æ¬¡çš„ï¼Œä½¿ç”¨ä»»ä½•åµŒå¥—çš„å±æ€§éƒ½å°†è®¾ä¸ºåªè¯»ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">original</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">({ </span><span style="--s-dark:#B8A965;--s-light:#998418">count</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">copy</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> readonly</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">original</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // works for reactivity tracking</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">copy</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// mutating original will trigger watchers relying on the copy</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">original</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// mutating the copy will fail and result in a warning</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">copy</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // warning!</span></span></code></pre><h2 id="watcheffect" tabindex="-1"><code>watchEffect</code> <a class="header-anchor" href="#watcheffect">ğŸ”—</a></h2><p>Run a function immediately while reactively tracking its dependencies, and re-run it whenever the dependencies have changed.</p><p>ç«‹å³æ‰§è¡Œä¸€ä¸ªå‡½æ•°æ¥å“åº”å¼åœ°è¿½è¸ªä¾èµ–ï¼Œæ¯å½“ä¾èµ–å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">))</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// -&gt; logs 0</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">setTimeout</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#CB7676;--s-light:#AB5959">++</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  // -&gt; logs 1</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">},</span><span style="--s-dark:#4C9A91;--s-light:#2F798A"> 100</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><h3 id="stopping-the-watcher-ï¼ˆåœæ­¢è§‚å¯Ÿè€…ï¼‰" tabindex="-1">Stopping the Watcher ï¼ˆåœæ­¢è§‚å¯Ÿè€…ï¼‰ <a class="header-anchor" href="#stopping-the-watcher-ï¼ˆåœæ­¢è§‚å¯Ÿè€…ï¼‰">ğŸ”—</a></h3><p>When <code>watchEffect</code> is called during a componentâ€™s <code>setup()</code> function or lifecycle hooks, the watcher is linked to the componentâ€™s lifecycle, and will be automatically stopped when the component is unmounted.</p><p>å½“<code>watchEffect</code>åœ¨ä¸€ä¸ªç»„ä»¶çš„setupä¸­æˆ–è€…ç”Ÿå‘½å‘¨æœŸçš„é’©å­ä¸­è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªè§‚å¯Ÿè€…ä¼šè¿æ¥åˆ°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¼šåœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœ°åœæ­¢ã€‚</p><p>In other cases, it returns a stop handle which can be called to explicitly stop the watcher:</p><p>åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªç”¨äºåœæ­¢çš„å¤„ç†ç¨‹åºï¼Œè¿™ä¸ªå¤„ç†ç¨‹åºå¯ä»¥è¢«è°ƒç”¨æ¥æ˜¾ç¤ºåœ°åœæ­¢è¿™ä¸ªè§‚å¯Ÿè€…ã€‚</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">stop</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  /* ... */</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// later</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">stop</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span></code></pre><h3 id="side-effect-invalidation-ï¼ˆå‰¯ä½œç”¨å¤±æ•ˆï¼‰" tabindex="-1">Side Effect Invalidation ï¼ˆå‰¯ä½œç”¨å¤±æ•ˆï¼‰ <a class="header-anchor" href="#side-effect-invalidation-ï¼ˆå‰¯ä½œç”¨å¤±æ•ˆï¼‰">ğŸ”—</a></h3><p>Sometimes the watched effect function will perform async side effects that need to be cleaned up when it is invalidated (i.e state changed before the effects can be completed). The effect function receives an <code>onInvalidate</code> function that can be used to register a invalidation callback. The invalidation callback is called when:</p><p>æœ‰æ—¶å€™è¢«è§‚å¯Ÿçš„effectå‡½æ•°ä¼šè¡¨ç°å‡ºå¼‚æ­¥çš„å‰¯ä½œç”¨ï¼Œè¿™ä¸ªå‰¯ä½œç”¨éœ€è¦åœ¨å®ƒå¤±æ•ˆæ—¶è¢«æ¸…ç†ï¼ˆå³åœ¨effectså‡½æ•°ä¹‹å‰å®Œæˆä¹‹å‰stateå·²ç»æ”¹å˜ï¼‰ã€‚effectå‡½æ•°æ¥æ”¶ä¸€ä¸ª<code>onInvalidate</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥æ³¨å†Œä¸€ä¸ªå¤±æ•ˆçš„å›è°ƒã€‚è¿™ä¸ªå¤±æ•ˆçš„å›è°ƒå°†åœ¨ä»¥ä¸‹æƒ…å†µè¢«è°ƒç”¨ï¼š</p><ul><li><p>the effect is about to re-run</p><p>effectå³å°†é‡æ–°æ‰§è¡Œ</p></li><li><p>the watcher is stopped (i.e. when the component is unmounted if <code>watchEffect</code> is used inside <code>setup()</code> or lifecycle hooks)</p><p>è§‚å¯Ÿè€…å·²ç»åœæ­¢ï¼ˆå³å¦‚æœ<code>watchEffect</code>åœ¨<code>setup()</code>å‡½æ•°æˆ–è€…ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ä½¿ç”¨ï¼Œç»„ä»¶è¢«å¸è½½æ—¶ï¼‰</p></li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onInvalidate</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">  const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">token</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> performAsyncOperation</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">id</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  onInvalidate</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // id has changed or watcher is stopped.</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // invalidate previously pending async operation</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    token</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">cancel</span><span style="--s-dark:#666666;--s-light:#999999">()</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><p>We are registering the invalidation callback via a passed-in function instead of returning it from the callback (like React <code>useEffect</code>) because the return value is important for async error handling. It is very common for the effect function to be an async function when performing data fetching:</p><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¼ å…¥çš„å‡½æ•°è€Œä¸æ˜¯ä»å›è°ƒä¸­è¿”å›è¿™ä¸ªå‡½æ•°æ¥æ³¨å†Œä¸€ä¸ªå¤±æ•ˆçš„å›è°ƒï¼ˆè¿™é‡Œçš„ä»è¿”å›å‡½æ•°æ³¨å†Œå¤±æ•ˆå›è°ƒæ˜¯reactçš„åšæ³•ï¼‰ï¼Œæ˜¯å› ä¸ºå¯¹äºå¼‚æ­¥çš„é”™è¯¯å¤„ç†è¿”å›å€¼æ˜¯éå¸¸é‡è¦çš„ã€‚å½“æ‰§è¡Œæ•°æ®è·å–æ—¶ï¼Œeffectå‡½æ•°ä½œä¸ºä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°æ˜¯æ™®éçš„ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">data</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">null</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#CB7676;--s-light:#AB5959">async</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  data</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> await</span><span style="--s-dark:#80A665;--s-light:#59873A"> fetchData</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">props</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">id</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><p>An async function implicitly returns a Promise, but the cleanup function needs to be registered immediately before the Promise resolves. In addition, Vue relies on the returned Promise to automatically handle potential errors in the Promise chain.</p><p>ä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°ä¼šéšå¼åœ°è¿”å›ä¸€ä¸ªPromiseï¼Œä½†æ˜¯æ¸…ç†å‡½æ•°éœ€è¦åœ¨Promiseè§£å†³ä¹‹å‰ç«‹å³æ³¨å†Œã€‚æ­¤å¤–ï¼ŒVueä¾èµ–è¿”å›çš„Promiseå»è‡ªåŠ¨åœ°å¤„ç†ä½äºPromiseé“¾ä¸­æ½œåœ¨çš„é”™è¯¯ã€‚</p><h3 id="effect-flush-timingï¼ˆeffectåˆ·æ–°çš„æ—¶é—´ç‚¹ï¼‰" tabindex="-1">Effect Flush Timingï¼ˆEffectåˆ·æ–°çš„æ—¶é—´ç‚¹ï¼‰ <a class="header-anchor" href="#effect-flush-timingï¼ˆeffectåˆ·æ–°çš„æ—¶é—´ç‚¹ï¼‰">ğŸ”—</a></h3><p>Vueâ€™s reactivity system buffers invalidated effects and flush them asynchronously to avoid unnecessary duplicate invocation when there are many state mutations happening in the same â€œtickâ€. Internally, a componentâ€™s update function is also a watched effect. When a user effect is queued, it is always invoked after all component update effects:</p><p>Vueçš„å“åº”å¼ç³»ç»Ÿç¼“å†²å¤±æ•ˆçš„effectsï¼Œå½“æœ‰å¤šä¸ªçŠ¶æ€å˜åŒ–å‘ç”Ÿåœ¨åŒä¸€ä¸ªâ€tickâ€ä¸­å¼‚æ­¥åœ°åˆ·æ–°å®ƒä»¬æ¥é¿å…ä¸å¿…è¦é‡å¤çš„è°ƒç”¨ã€‚åœ¨å†…éƒ¨ï¼Œä¸€ä¸ªç»„ä»¶çš„æ›´æ–°å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿçš„effectã€‚å½“ä¸€ä¸ªç”¨æˆ·çš„effectè¿›å…¥é˜Ÿåˆ—æ—¶ï¼Œå®ƒæ€»æ˜¯ä¼šåœ¨ç»„ä»¶çš„æ‰€æœ‰æ›´æ–°effectsä¹‹åæ‰§è¡Œï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-html"><span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  &lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#DBD7CAEE;--s-light:#393A34">{{ count }}</span><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">div</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">template</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">  export</span><span style="--s-dark:#4D9375;--s-light:#1E754F"> default</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    setup</span><span style="--s-dark:#666666;--s-light:#999999">()</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">      const</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">      watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        console</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#80A665;--s-light:#59873A">log</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">value</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      })</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      return</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">        count</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">      }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">&lt;/</span><span style="--s-dark:#4D9375;--s-light:#1E754F">script</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span></span></code></pre><p>In this example:</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li><p>The <code>count</code> will be logged synchronously on initial run.</p><p><code>count</code>å˜é‡ä¼šåœ¨åˆå§‹æ‰§è¡Œæ—¶åŒæ­¥åœ°æ‰“å°ã€‚</p></li><li><p>When <code>count</code> is mutated, the callback will be called after the component has updated.</p><p>å½“<code>count</code>è¢«æ”¹å˜æ—¶ï¼Œå›è°ƒä¼šåœ¨ç»„ä»¶è¢«æ›´æ–°ä¹‹åè°ƒç”¨ã€‚</p></li></ul><p>Note the first run is executed before the component is mounted. So if you wish to access the DOM (or template refs) in a watched effect, do it in the mounted hook:</p><p>æ³¨æ„ç¬¬ä¸€æ¬¡runåœ¨ç»„ä»¶è¢«æŒ‚è½½ä¹‹å‰æ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªè§‚å¯Ÿçš„effectä¸­è·å–DOMï¼ˆæˆ–è€…æ¨¡æ¿çš„refsï¼‰æ—¶ï¼Œå¯ä»¥åœ¨<code>onMounted</code>è¿™ä¸ªé’©å­ä¸­è°ƒç”¨<code>watchEffect</code></p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">onMounted</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    // access the DOM or template refs</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  })</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><p>In cases where a watcher effect needs to be re-run synchronously or before component updates, we can pass an additional options object with the <code>flush</code> option (default is <code>&amp;#39;post&amp;#39;</code>):</p><p>æŸäº›æƒ…å†µä¸‹ä¸€ä¸ªè§‚å¯Ÿçš„effectéœ€è¦åŒæ­¥çš„æˆ–è€…åœ¨ç»„ä»¶æ›´æ–°ä¹‹å‰é‡æ–°æ‰§è¡Œï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰<code>flush</code>å‚æ•°çš„é¢å¤–çš„å‚æ•°å¯¹è±¡ï¼ˆ<code>flush</code>é»˜è®¤çš„å€¼ä¸º<code>&amp;#39;post&amp;#39;&amp;#39;</code>ï¼‰</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// fire synchronously</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    /* ... */</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    flush</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">sync</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// fire before component updates</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    /* ... */</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  {</span></span>
<span class="line"><span style="--s-dark:#B8A965;--s-light:#998418">    flush</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">pre</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><h3 id="watcher-debuggingï¼ˆè§‚å¯Ÿè€…è°ƒè¯•ï¼‰" tabindex="-1">Watcher Debuggingï¼ˆè§‚å¯Ÿè€…è°ƒè¯•ï¼‰ <a class="header-anchor" href="#watcher-debuggingï¼ˆè§‚å¯Ÿè€…è°ƒè¯•ï¼‰">ğŸ”—</a></h3><p>The <code>onTrack</code> and <code>onTrigger</code> options can be used to debug a watcherâ€™s behavior.</p><p>ä½¿ç”¨<code>onTrack</code>å’Œ<code>onTrigger</code>å‚æ•°å¯ä»¥è°ƒè¯•ä¸€ä¸ªè§‚å¯Ÿè€…çš„è¡Œä¸ºã€‚</p><ul><li><p><code>onTrack</code> will be called when a reactive property or ref is tracked as a dependency</p><p><code>onTrack</code>å°†ä¼šåœ¨å½“å“åº”å¼å±æ€§æˆ–è€…refå¯¹è±¡ä½œä¸ºä¸€ä¸ªä¾èµ–è¢«æ”¶é›†æ—¶è¢«è°ƒç”¨</p></li><li><p><code>onTrigger</code> will be called when the watcher callback is triggered by the mutation of a dependency</p><p><code>onTrigger</code>å°†ä¼šåœ¨å½“è§‚å¯Ÿè€…å›è°ƒåœ¨ä¸€ä¸ªä¾èµ–æ”¹å˜æ—¶è§¦å‘æ—¶è¢«è°ƒç”¨ã€‚</p></li></ul><p>Both callbacks will receive a debugger event which contains information on the dependency in question. It is recommended to place a <code>debugger</code> statement in these callbacks to interactively inspect the dependency:</p><p>ä¸¤ä¸ªå›è°ƒå‡½æ•°éƒ½ä¼šæ¥æ”¶ä¸€ä¸ªåŒ…å«ç›¸å…³ä¾èµ–ä¿¡æ¯çš„debuggeäº‹ä»¶ã€‚æ¨èä¹¦å†™ä¸€æ¡<code>debugger</code>è¯­å¥åœ¨è¿™äº›å›è°ƒä¸­æ¥äº’åŠ¨å¼åœ°æ£€æŸ¥è¿™äº›ä¾èµ–ï¼š</p><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    /* side effect */</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  },</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  {</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">    onTrigger</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">e</span><span style="--s-dark:#666666;--s-light:#999999">) {</span></span>
<span class="line"><span style="--s-dark:#4D9375;--s-light:#1E754F">      debugger</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">    }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span></span></code></pre><p><code>onTrack</code> and <code>onTrigger</code> only works in development mode.</p><p><code>onTrack</code>å’Œ<code>onTrigger</code>åªèƒ½å·¥ä½œåœ¨å¼€å‘æ¨¡å¼ä¸‹ã€‚</p><ul><li>Typingï¼ˆç±»å‹ï¼‰</li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> watchEffect</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  effect</span><span style="--s-dark:#666666;--s-light:#999999">: (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">onInvalidate</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">InvalidateCbRegistrator</span><span style="--s-dark:#666666;--s-light:#999999">) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  options</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WatchEffectOptions</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> StopHandle</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">interface</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WatchEffectOptions</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  flush</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">pre</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999"> | </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">post</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#666666;--s-light:#999999"> | </span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span><span style="--s-dark:#C98A7D;--s-light:#B56959">sync</span><span style="--s-dark:#C98A7D77;--s-light:#B5695977">'</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  onTrack</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">event</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">DebuggerEvent</span><span style="--s-dark:#666666;--s-light:#999999">) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  onTrigger</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">event</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">DebuggerEvent</span><span style="--s-dark:#666666;--s-light:#999999">) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">interface</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> DebuggerEvent</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  effect</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">ReactiveEffect</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  target</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">any</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  type</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">OperationTypes</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  key</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">string</span><span style="--s-dark:#666666;--s-light:#999999"> | </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">symbol</span><span style="--s-dark:#666666;--s-light:#999999"> | </span><span style="--s-dark:#CB7676;--s-light:#AB5959">undefined</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> InvalidateCbRegistrator</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#80A665;--s-light:#59873A">invalidate</span><span style="--s-dark:#666666;--s-light:#999999">: () =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> void</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> StopHandle</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> void</span></span></code></pre><h2 id="watch" tabindex="-1"><code>watch</code> <a class="header-anchor" href="#watch">ğŸ”—</a></h2><p>The <code>watch</code> API is the exact equivalent of the 2.x <code>this.$watch</code> (and the corresponding <code>watch</code> option). <code>watch</code> requires watching a specific data source, and applies side effects in a separate callback function. It also is lazy by default - i.e. the callback is only called when the watched source has changed.</p><p><code>watch</code>è¿™ä¸ªAPIå’Œ2.xç‰ˆæœ¬çš„<code>this.$watch</code>å‡†ç¡®çš„ç›¸ç­‰ï¼ˆå’Œç›¸åº”çš„<code>watch</code>å‚æ•°ï¼‰ã€‚<code>watch</code>éœ€è¦è§‚å¯Ÿä¸€ä¸ªå…·ä½“çš„æ•°æ®æºï¼Œå¹¶åœ¨ä¸€ä¸ªåˆ†ç¦»çš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œå‰¯ä½œç”¨ã€‚å®ƒä¹Ÿæ˜¯é»˜è®¤æƒ°æ€§çš„ - å³å›è°ƒåªæœ‰åœ¨è§‚å¯Ÿçš„æºè¢«æ”¹å˜æ—¶æ‰ä¼šæ‰§è¡Œã€‚</p><ul><li><p>Compared to <code>watchEffect</code>, <code>watch</code> allows us to:</p><p>å’Œ<code>watchEffect</code>æ¯”è¾ƒï¼Œ<code>watch</code>å…è®¸æˆ‘ä»¬ï¼š</p><pre><code>*   Perform the side effect lazily;
</code></pre><p>æƒ°æ€§åœ°æ‰§è¡Œä¸€ä¸ªå‰¯ä½œç”¨çš„effectï¼›</p><pre><code>*   Be more specific about what state should trigger the watcher to re-run;
</code></pre><p>åœ¨å“ªä¸€ä¸ªçŠ¶æ€åº”è¯¥è§¦å‘è§‚å¯Ÿè€…å»é‡æ–°æ‰§è¡Œè¿™ä¸ªæ–¹é¢æ›´åŠ çš„å…·ä½“ï¼›</p><pre><code>*   Access both the previous and current value of the watched state.
</code></pre><p>å¯ä»¥è·å–è§‚å¯ŸçŠ¶æ€çš„å‰ä¸€ä¸ªå€¼å’Œå½“å‰å€¼ã€‚</p></li><li><p>Watching a Single Source</p><p>è§‚å¯Ÿä¸€ä¸ªå•ç‹¬çš„æº</p><p>A watcher data source can either be a getter function that returns a value, or directly a ref:</p><p>ä¸€ä¸ªè§‚å¯Ÿè€…çš„æ•°æ®æºå¯ä»¥æ˜¯è¿”å›ä¸€ä¸ªå€¼çš„getterå‡½æ•°ï¼Œæˆ–è€…æ—¶ç›´æ¥ä¸€ä¸ªrefå¯¹è±¡ï¼š</p></li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// watching a getter</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">state</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> reactive</span><span style="--s-dark:#666666;--s-light:#999999">({ </span><span style="--s-dark:#B8A965;--s-light:#998418">count</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999"> })</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watch</span><span style="--s-dark:#666666;--s-light:#999999">(</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> state</span><span style="--s-dark:#666666;--s-light:#999999">.</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> prevCount</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">    /* ... */</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  }</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// directly watching a ref</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">const </span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#80A665;--s-light:#59873A"> ref</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#4C9A91;--s-light:#2F798A">0</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watch</span><span style="--s-dark:#666666;--s-light:#999999">(</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#666666;--s-light:#999999"> (</span><span style="--s-dark:#BD976A;--s-light:#B07D48">count</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> prevCount</span><span style="--s-dark:#666666;--s-light:#999999">)</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  /* ... */</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><ul><li><p>Watching Multiple Sources</p><p>è§‚å¯Ÿå¤šä¸ªæº</p><p>A watcher can also watch multiple sources at the same time using an Array:</p><p>ä¸€ä¸ªè§‚å¯Ÿè€…ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„åœ¨åŒä¸€æ—¶é—´è§‚å¯Ÿå¤šä¸ªæºï¼š</p></li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">watch</span><span style="--s-dark:#666666;--s-light:#999999">([</span><span style="--s-dark:#BD976A;--s-light:#B07D48">fooRef</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> barRef</span><span style="--s-dark:#666666;--s-light:#999999">],</span><span style="--s-dark:#666666;--s-light:#999999"> ([</span><span style="--s-dark:#BD976A;--s-light:#B07D48">foo</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> bar</span><span style="--s-dark:#666666;--s-light:#999999">],</span><span style="--s-dark:#666666;--s-light:#999999"> [</span><span style="--s-dark:#BD976A;--s-light:#B07D48">prevFoo</span><span style="--s-dark:#666666;--s-light:#999999">,</span><span style="--s-dark:#BD976A;--s-light:#B07D48"> prevBar</span><span style="--s-dark:#666666;--s-light:#999999">])</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">  /* ... */</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">})</span></span></code></pre><ul><li><p>Shared Behavior with <code>watchEffect</code></p><p>å’Œ<code>watchEffect</code>å…±äº«çš„è¡Œä¸º</p><p><code>watch</code> shares behavior with <code>watchEffect</code> in terms of <a href="">manual stoppage</a>, <a href="">side effect invalidation</a> (with <code>onInvalidate</code> passed to the callback as the 3rd argument instead), <a href="">flush timing</a> and <a href="">debugging</a>.</p><p><code>watch</code>å°±æ‰‹åŠ¨åœæ­¢ï¼Œå‰¯ä½œç”¨å¤±æ•ˆå›è°ƒï¼ˆ<code>onInvalidate</code>ä½œä¸ºå›è°ƒå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’è¿›æ¥ï¼‰ï¼Œåˆ·æ–°æ—¶é—´ç‚¹å’Œè°ƒè¯•æ–¹é¢æ¥è¯´å…·æœ‰å…±äº«çš„è¡Œä¸ºã€‚</p></li><li><p>Typingï¼ˆç±»å‹ï¼‰</p></li></ul><pre class="shiki shiki-themes vitesse-dark vitesse-light" style="--s-dark:#dbd7caee;--s-light:#393a34;--s-dark-bg:#121212;--s-light-bg:#ffffff" tabindex="0"><code class="language-typescript"><span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// wacthing single source</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> watch</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  source</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WatcherSource</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;,</span></span>
<span class="line"><span style="--s-dark:#80A665;--s-light:#59873A">  callback</span><span style="--s-dark:#666666;--s-light:#999999">: (</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    value</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    oldValue</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    onInvalidate</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">InvalidateCbRegistrator</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  options</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WatchOptions</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> StopHandle</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// watching multiple sources</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">function</span><span style="--s-dark:#80A665;--s-light:#59873A"> watch</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WatcherSource</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">unknown</span><span style="--s-dark:#666666;--s-light:#999999">&gt;[]&gt;(</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  sources</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span></span>
<span class="line"><span style="--s-dark:#5DA994;--s-light:#2E8F82">  callback</span><span style="--s-dark:#CB7676;--s-light:#AB5959">:</span><span style="--s-dark:#666666;--s-light:#999999"> (</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    values</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">MapSources</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    oldValues</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">MapSources</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">    onInvalidate</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">InvalidateCbRegistrator</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  ) =&gt; </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">void</span><span style="--s-dark:#666666;--s-light:#999999">,</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  options</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999"> : </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">WatchOptions</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">):</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> StopHandle</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WatcherSource</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> Ref</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> |</span><span style="--s-dark:#666666;--s-light:#999999"> (()</span><span style="--s-dark:#666666;--s-light:#999999"> =&gt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span><span style="--s-dark:#666666;--s-light:#999999">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">type</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> MapSources</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">&gt;</span><span style="--s-dark:#666666;--s-light:#999999"> =</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">  [</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">K</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> in</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> keyof</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> T</span><span style="--s-dark:#666666;--s-light:#999999">]: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">T</span><span style="--s-dark:#666666;--s-light:#999999">[</span><span style="--s-dark:#5DA994;--s-light:#2E8F82">K</span><span style="--s-dark:#666666;--s-light:#999999">] </span><span style="--s-dark:#CB7676;--s-light:#AB5959">extends</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WatcherSource</span><span style="--s-dark:#666666;--s-light:#999999">&lt;</span><span style="--s-dark:#CB7676;--s-light:#AB5959">infer</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> V</span><span style="--s-dark:#666666;--s-light:#999999">&gt; </span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> V</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> :</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> never</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="--s-dark:#758575DD;--s-light:#A0ADA0">// see `watchEffect` typing for shared options</span></span>
<span class="line"><span style="--s-dark:#CB7676;--s-light:#AB5959">interface</span><span style="--s-dark:#5DA994;--s-light:#2E8F82"> WatchOptions</span><span style="--s-dark:#CB7676;--s-light:#AB5959"> extends</span><span style="--s-dark:#80A665;--s-light:#59873A"> WatchEffectOptions</span><span style="--s-dark:#666666;--s-light:#999999"> {</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  immediate</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">boolean</span><span style="--s-dark:#758575DD;--s-light:#A0ADA0"> // default: false</span></span>
<span class="line"><span style="--s-dark:#BD976A;--s-light:#B07D48">  deep</span><span style="--s-dark:#CB7676;--s-light:#AB5959">?</span><span style="--s-dark:#666666;--s-light:#999999">: </span><span style="--s-dark:#5DA994;--s-light:#2E8F82">boolean</span></span>
<span class="line"><span style="--s-dark:#666666;--s-light:#999999">}</span></span></code></pre><h2 id="åè®°" tabindex="-1">åè®° <a class="header-anchor" href="#åè®°">ğŸ”—</a></h2><p>ç»ˆäºç¿»è¯‘å®Œäº†ï¼Œæœ‰ç–‘é—®çš„åœ°æ–¹æ˜¯æˆ‘åœ¨reactivityè¿™ä¸ªåŒ…ä¸­æ²¡æœ‰çœ‹è§<code>watch</code>å’Œ<code>watchEffect</code>è¿™ä¸¤ä¸ªAPIï¼Œä¸è¿‡çœ‹åˆ°äº†åº”è¯¥æ˜¯å®ƒä»¬ä¸¤ä¸ªçš„åŸºç¡€çš„<code>effect</code>APIï¼Œè¿™é˜µå­ä¹Ÿåœ¨çœ‹è¿™ä¸ªåŒ…çš„æºç ï¼Œä¹Ÿæ˜¯çœ‹æ‡‚äº†ä¸€äº›ã€‚</p><p>çœŸçš„æ˜¯å¾ˆå¥‡æ€ªï¼Œæ˜æ˜æ¯ä¸€è¡Œä»£ç åŸºæœ¬çœ‹å¾—æ‡‚ï¼Œä½†æ˜¯è¿åœ¨ä¸€èµ·å°±æ˜¯ä¸€å¤´é›¾æ°´â€¦</p></div><!--]--></div><div flex="~ wrap" text="[var(--mygo-c-text-2)]" mt-8="" gap-4="" justify-center=""><!--[--><div>#JavaScript</div><div>#Vue</div><!--]--></div><!--]--></div></div><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="~ wrap" gap-4=""><a href="/f070f73fd85c" class="" truncate="" title="Vue3.0Reactivityä¹‹reactive"><i class="i-mi:chevron-left" mr-1=""></i><span>Vue3.0Reactivityä¹‹reactive</span></a><a href="/c77fd97768be" class="" ml-auto="" truncate="" title="Vue3.0å°é²œä½“éªŒ"><span>Vue3.0å°é²œä½“éªŒ</span><i class="i-mi:chevron-right" ml-1=""></i></a></div><!--]--></div></div><!--[--><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" data-v-f3312cf8="" data-v-7ac4adc5=""><div class="p-4 lg:p-8" data-v-7ac4adc5=""><!--[--><div flex="" gap-4="" items-start="" data-v-f3312cf8=""><div flex="~ shrink-0" bg="[var(--mygo-c-bg-alt)]" rounded-6px="" w-60px="" aspect-ratio-square="" items-center="" justify-center="" data-v-f3312cf8=""><i text-40px="" text="[#999]" class="i-fa6-regular:user" data-v-f3312cf8=""></i></div><div flex="~ col grow" gap-2="" lg:gap-4="" data-v-f3312cf8=""><textarea disabled="" placeholder="ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç•™ä¸‹è¯„è®ºè¡Œä¸è¡Œ" class="mujika-git-talk-textarea" un-disabled:cursor-not-allowed="" p-2="" outline-0="" lg:p-4="" data-v-f3312cf8=""></textarea><div flex="" items-start="" data-v-f3312cf8=""><a target="_blank" href="https://guides.github.com/features/mastering-markdown/" data-v-f3312cf8="">æ”¯æŒ Markdown è¯­æ³•</a><div ml-auto="" data-v-f3312cf8=""></div><!----><button class="mujika-button" data-v-f3312cf8="" data-v-15330f5f=""><!--[--><!--]--><!--[-->ç‚¹å‡»ç™»å½•<!--]--></button></div></div></div><!--]--></div></div><!----><!--]--></div><aside class="mujika-aside" w="280px" flex="~ col shrink-0" top-2="" sticky="" max-h="[calc(100vh-var(--spacing)*4)]" un-hidden="" lg:block=""><div class="mujika-card mujika-card--hover mujika-card--border" w-full="" overflow-auto="" flex="~ col" gap-4="" data-v-7ac4adc5=""><!--[--><div p="4 b-0" flex-shrink-0="">æ–‡ç« ç›®å½•</div><div p="4 t-0" flex-grow="" min-h-0="" overflow-y-auto=""><!----></div><!--]--></div></aside><!--teleport start--><!--teleport end--></div></main><footer class="mujika-footer" px-4="" py-6="" bg="[var(--mygo-c-bg)]" flex="~ col shrink-0" gap-2="" items-center="" data-v-d1d7a153=""><div flex="" items-center="" data-v-d1d7a153=""><span data-v-d1d7a153="">Power by&nbsp;</span><i class="i-logos:vue" data-v-d1d7a153=""></i><span data-v-d1d7a153="">&nbsp;+&nbsp;</span><i class="i-logos:vitejs" data-v-d1d7a153=""></i></div><div text-center="" data-v-d1d7a153=""><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-d1d7a153="">CC BY-NC-SA 4.0 </a>2021 - PRESENT Â© Dedicatus545</div><div text="[var(--mygo-c-text-2)]" text-center="" data-v-d1d7a153="">å¦‚æœæˆ‘å’Œç‹—ä¸€æ ·æœ‰å°¾å·´çš„è¯ï¼Œä¸€å®šä¼šè—ä¸ä½è¿™ä»½å–œæ‚¦ï¼Œè€Œå°¾å·´ä¸€ç›´æ‘‡ä¸ªä¸åœå§ã€‚</div></footer></div></div></body></html>